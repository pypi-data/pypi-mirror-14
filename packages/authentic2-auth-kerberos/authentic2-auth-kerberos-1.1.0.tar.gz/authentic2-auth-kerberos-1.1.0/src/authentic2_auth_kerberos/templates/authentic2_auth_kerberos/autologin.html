{% load staticfiles %}
{% if not user.is_authenticated %}
<div id="kerberos-autologin">
  Autologin...
  <script src="{% static "js/autologin.js" %}" type="text/javascript">
  </script>
  <script type="text/javascript">
    autologin('{% url 'kerberos-login' %}', function (ok) {
      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
      }
      var el = document.getElementById('kerberos-autologin')
      if (ok) {
        var next = getQueryVariable('next');
        if (next) {
           window.location = next;
        } else {
           window.location = '/';
        }
        el.innerHtml = 'Logged in, reloading...';
      } else {
        el.parentNode.removeChild(el);
      }
    });
  </script>
</div>
{% endif %}
