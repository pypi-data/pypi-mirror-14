

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Provision a Static Node &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="../index.html"/>
        <link rel="up" title="ZTPServer Cookbook" href="../cookbook.html"/>
        <link rel="next" title="Provision a Dynamic Node" href="dynamicNodes.html"/>
        <link rel="prev" title="Hello World - A Simple Provisioning Example" href="helloWorld.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../cookbook.html">ZTPServer Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. Whatâ€™s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../cookbook.html">ZTPServer Cookbook</a> &raquo;</li>
      
    <li>Provision a Static Node</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/cookbook/staticNodes.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="provision-a-static-node">
<h1>Provision a Static Node<a class="headerlink" href="#provision-a-static-node" title="Permalink to this headline">Â¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#add-a-static-node-entry" id="id17">Add a Static Node Entry</a></li>
<li><a class="reference internal" href="#create-a-startup-config-file" id="id18">Create a Startup-Config File</a></li>
<li><a class="reference internal" href="#create-a-pattern-topology-validation-enabled" id="id19">Create a Pattern (Topology Validation enabled)</a></li>
<li><a class="reference internal" href="#create-a-definition-file" id="id20">Create a Definition File</a></li>
<li><a class="reference internal" href="#create-an-attributes-file" id="id21">Create an Attributes File</a></li>
<li><a class="reference internal" href="#symlink-to-a-generic-definition" id="id22">Symlink to a Generic Definition</a></li>
</ul>
</div>
<div class="section" id="add-a-static-node-entry">
<h2><a class="toc-backref" href="#id17">Add a Static Node Entry</a><a class="headerlink" href="#add-a-static-node-entry" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">Â¶</a></h3>
<p>I want to provision my switch based upon its System ID (System MAC Address
or Serial Number).</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">Â¶</a></h3>
<p>Log into your (v)EOS node to get its System ID. If it&#8217;s in ZTP Mode, just log in
with username <tt class="docutils literal"><span class="pre">admin</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">switch-name&gt; show version</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Copy down the System ID (System MAC Address or Serial Number).</p>
</div>
<p>Let&#8217;s create a node directory for this device:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Move to the nodes directory, where all node information is stored
admin@ztpserver:~# cd nodes

# Create a directory using the MAC Address you found earlier
admin@ztpserver:~# mkdir &lt;SYSTEM_ID&gt;
</pre></div>
</div>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">Â¶</a></h3>
<p>A node is considered to be statically provisioned when a directory with its
System ID is already located in the <tt class="docutils literal"><span class="pre">nodes/</span></tt> directory.</p>
<p>Note that the System ID can be the node&#8217;s System MAC Address or its Serial Number.</p>
<p>Just adding this directory is not enough to provision the node. The remaining
recipes will finish off the task.  To successfully provision a node
statically, you will need to create:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">startup-config</span></tt></li>
<li><tt class="docutils literal"><span class="pre">pattern</span></tt> file - if Topology Validation is enabled</li>
<li><tt class="docutils literal"><span class="pre">definition</span></tt> - if you choose to apply other actions during provisioning</li>
</ul>
<p>and place them in <tt class="docutils literal"><span class="pre">[data_root]/nodes/&lt;SYSTEM_ID&gt;</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Confirm your ZTPServer Configuration will identify a node based upon
the desired System ID by checking /etc/ztpserver/ztpserver.conf and
check the value of <tt class="docutils literal"><span class="pre">identifier</span></tt></p>
</div>
</div>
</div>
<div class="section" id="create-a-startup-config-file">
<h2><a class="toc-backref" href="#id18">Create a Startup-Config File</a><a class="headerlink" href="#create-a-startup-config-file" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id1">
<h3>Objective<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>I want the node to receive a startup-config during provisioning.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>Create a file named <tt class="docutils literal"><span class="pre">startup-config</span></tt> in <tt class="docutils literal"><span class="pre">[data_root]/nodes/&lt;SYSTEM_ID&gt;/</span></tt>.</p>
<blockquote>
<div><p># Go to your data_root - by default it&#8217;s /usr/share/ztpserver
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd /usr/share/ztpserver</p>
<p># Move to the node directory you created above.
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd nodes/&lt;SYSTEM_ID&gt;</p>
<p># Create/edit the startup-config file
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# vi startup-config</p>
</div></blockquote>
<p>Place the desired configuration into the startup-config. Here&#8217;s an example. Please
change values where you see fit:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">!</span>
<span class="go">hostname test-node-1</span>
<span class="go">ip name-server vrf default &lt;DNS-SERVER-IP&gt;</span>
<span class="go">!</span>
<span class="go">ntp server &lt;NTP-SERVER-IP&gt;</span>
<span class="go">!</span>
<span class="go">username admin privilege 15 role network-admin secret admin</span>
<span class="go">!</span>
<span class="go">interface Management1</span>
<span class="go"> ip address &lt;MGMT-IP-ADDRESS&gt;/&lt;SUBNET&gt;</span>
<span class="go">!</span>
<span class="go">ip access-list open</span>
<span class="go"> 10 permit ip any any</span>
<span class="go">!</span>
<span class="go">ip route 0.0.0.0/0 &lt;DEFAULT-GW&gt;</span>
<span class="go">!</span>
<span class="go">ip routing</span>
<span class="go">!</span>
<span class="go">management api http-commands</span>
<span class="go"> no shutdown</span>
<span class="go">!</span>
<span class="go">banner login</span>
<span class="go">Welcome to $(hostname)!</span>
<span class="go">This switch has been provisioned using the ZTPServer from Arista Networks</span>
<span class="go">Docs: http://ztpserver.readthedocs.org/</span>
<span class="go">Source Code: https://github.com/arista-eosplus/ztpserver</span>
<span class="go">EOF</span>
<span class="go">!</span>
<span class="go">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Explanation<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>A startup-config file is required when you statically provision a node.  The format
of the startup-config is the same as you are used to, which can be found on your
switch at <a class="reference external" href="file:startup-config">file:startup-config</a> (/mnt/flash/startup-config)</p>
</div>
</div>
<div class="section" id="create-a-pattern-topology-validation-enabled">
<h2><a class="toc-backref" href="#id19">Create a Pattern (Topology Validation enabled)</a><a class="headerlink" href="#create-a-pattern-topology-validation-enabled" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id4">
<h3>Objective<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>I have created a static node directory and Topology Validation is
enabled, so I would like to make sure everything is wired up correctly before
provisioning a node.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">YAML syntax can be a pain sometimes. The indentation is done with
spaces and not tabs.</p>
</div>
</div>
<div class="section" id="id5">
<h3>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<p>Create a file named <tt class="docutils literal"><span class="pre">pattern</span></tt> in <tt class="docutils literal"><span class="pre">[data_root]/nodes/&lt;SYSTEM_ID&gt;/</span></tt>
and define the LLDP associations.</p>
<blockquote>
<div><p># Go to your data_root - by default it&#8217;s /usr/share/ztpserver
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd /usr/share/ztpserver</p>
<p># Move to the node directory you created above.
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd nodes/&lt;SYSTEM_ID&gt;</p>
<p># Create/edit the pattern file
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# vi pattern</p>
</div></blockquote>
<p><strong>Example 1:</strong> Match any neighbor</p>
<p>This pattern essentially disables Topology Validation.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Match anything</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any:any</span>
</pre></div>
</div>
<p><strong>Example 2:</strong> Match any interface on a specific neighbor</p>
<p>This pattern says, the node being provisioned must be connected to a neighbor
with hostname <tt class="docutils literal"><span class="pre">pod1-spine1</span></tt> but it can be connected to any peer interface.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Anything on pod1-spine1</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pod1-spine1:any</span>
</pre></div>
</div>
<p><strong>Example 3:</strong> Match specific interface on a specific neighbor</p>
<p>This pattern says, the node being provisioned must be connected to a neighbor
with hostname <tt class="docutils literal"><span class="pre">pod1-spine1</span></tt> on Ethernet1.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Anything on pod1-spine1</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pod1-spine1:Ethernet1</span>
</pre></div>
</div>
<p><strong>Example 4:</strong> Make sure I&#8217;m not connected to a node</p>
<p>This pattern is the same as Example #2, but we add another check to make sure the
node being provisioned is not connected to any spines in <tt class="docutils literal"><span class="pre">pod2</span></tt>.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Not connected to anything in pod2</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pod1-spine1:any</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">regex(&#39;pod2-spine\d+&#39;):none</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">none</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">regex(&#39;pod2-spine\d+&#39;):any</span> <span class="c1">#equivalent to line above</span>
</pre></div>
</div>
<p><strong>Example 5:</strong> Using variables in the pattern</p>
<p>This pattern is similar to what you&#8217;ve seen above except we use variables
to make things easier.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Not connected to any spine in pod2</span>
<span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">not_pod2</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">regex(&#39;pod2-spine\d+&#39;)</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pod1-spine1:any</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$not_pod2:none</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Explanation<a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<p>Pattern files are YAML-based and are the underpinnings of Topology Validation.
A node will not be successfully provisioned if it cannot pass all of the interface
tests contained within the pattern file. The examples above are just a small
sample of the complex associations you can create. Take a look at the
<a class="reference external" href="http://ztpserver.readthedocs.org/en/master/config.html#dynamic-provisioning-neighbordb">neighbordb</a>
section to learn more.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">YAML can be a pain, and invalid YAML syntax will cause provisioning to
fail.  You can make sure your syntax is correct by using a tool like
<a class="reference external" href="http://www.yamllint.com">YAMLlint</a></p>
</div>
</div>
</div>
<div class="section" id="create-a-definition-file">
<h2><a class="toc-backref" href="#id20">Create a Definition File</a><a class="headerlink" href="#create-a-definition-file" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id7">
<h3>Objective<a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>Aside from sending the node a startup-config, I&#8217;d like to upgrade the node to
a specific v(EOS) version.</p>
</div>
<div class="section" id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<p>These types of system changes are accomplished via the <tt class="docutils literal"><span class="pre">definition</span></tt> file.  The
definition is a YAML-based file with a section for each action that you
want to execute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Learn more about <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/config.html#actions">Actions</a>.</p>
</div>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Create an images directory
admin@ztpserver:~# mkdir -p files/images

# SCP your SWI into the images directory, name it whatever you like
admin@ztpserver:~# scp admin@otherhost:/tmp/vEOS.swi files/images/vEOS_4.14.5F.swi
</pre></div>
</div>
<p>Now let&#8217;s create a definition that performs the <tt class="docutils literal"><span class="pre">install_image</span></tt> action:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Move to the specific node directory that you created earlier
admin@ztpserver:~# cd nodes/&lt;SYSTEM_ID&gt;

# Create a definition file
admin@ztpserver:~# vi definition
</pre></div>
</div>
<p>Add the following lines to your definition, changing values where needed:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_image</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/images/vEOS_4.14.5F.swi</span>
      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.14.5F</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">4.14.5F&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Explanation<a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>The definition is where we list all of the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/config.html#actions">actions</a>
we want the node to execute during the provisioning process. In this case we are
hosting the SWI on the ZTPServer, so we just define the <tt class="docutils literal"><span class="pre">url</span></tt> in relation
to the <tt class="docutils literal"><span class="pre">data_root</span></tt>. We could change the <tt class="docutils literal"><span class="pre">url</span></tt> to point to another server
altogether - the choice is yours. The benefit in hosting the file on the
ZTPServer is that we perform an extra checksum step to validate the integrity of
the file.</p>
<p>In practice, the node requests its definition during the provisioning process. It
sees that it&#8217;s supposed to perform the <tt class="docutils literal"><span class="pre">install_image</span></tt> action, so it
requests the <tt class="docutils literal"><span class="pre">install_image</span></tt> python script. It then performs an HTTP GET for
the <tt class="docutils literal"><span class="pre">url</span></tt>.  Once it has these locally, it executes the
<tt class="docutils literal"><span class="pre">install_image</span></tt> <a class="reference external" href="https://github.com/arista-eosplus/ztpserver/blob/develop/actions/install_image">script</a>.</p>
</div>
</div>
<div class="section" id="create-an-attributes-file">
<h2><a class="toc-backref" href="#id21">Create an Attributes File</a><a class="headerlink" href="#create-an-attributes-file" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id11">
<h3>Objective<a class="headerlink" href="#id11" title="Permalink to this headline">Â¶</a></h3>
<p>I want to use variables in my definition and abstract the values to a unique file.
These variables will be sent down to the node during provisioning and be used while
the node is executing the actions listed in the definition.</p>
</div>
<div class="section" id="id12">
<h3>Solution<a class="headerlink" href="#id12" title="Permalink to this headline">Â¶</a></h3>
<p>Create a file named <tt class="docutils literal"><span class="pre">attributes</span></tt> in <tt class="docutils literal"><span class="pre">[data_root]/nodes/&lt;SYSTEM_ID&gt;/</span></tt>.</p>
<blockquote>
<div><p># Go to your data_root - by default it&#8217;s /usr/share/ztpserver
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd /usr/share/ztpserver</p>
<p># Move to the node directory you created above.
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# cd nodes/&lt;SYSTEM_ID&gt;</p>
<p># Move to the node directory you created above.
<a class="reference external" href="mailto:admin&#37;&#52;&#48;ztpserver">admin<span>&#64;</span>ztpserver</a>:~# vi attributes</p>
</div></blockquote>
<p>Here&#8217;s the different type of ways to define the attributes:</p>
<p><strong>Example 1:</strong> A simple key/value pair</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">ntp_server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ntp.example.com</span>
<span class="l-Scalar-Plain">dns_server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ns1.example.com</span>
</pre></div>
</div>
<p><strong>Example 2:</strong> key/dictionary</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">system_config</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">ntp</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ntp.example.com</span>
  <span class="l-Scalar-Plain">dns</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ns1.example.com</span>
</pre></div>
</div>
<p><strong>Example 3:</strong> key/list (note the hyphens)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">dns_servers</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ns1.example.com</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ns2.example.com</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ns3.example.com</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ns4.example.com</span>
</pre></div>
</div>
<p><strong>Example 4:</strong> Referencing another variable</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">ntp_server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ntp.example.com</span>
<span class="l-Scalar-Plain">other_var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$ntp_server</span>
</pre></div>
</div>
<p>Borrowing from the definition recipe above, we can replace some values with
variables from the attributes file:</p>
<p><strong>nodes/&lt;SYSTEM_ID&gt;/definition</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_image</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_url</span>
      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_version</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_name</span>
</pre></div>
</div>
<p>and the <strong>nodes/&lt;SYSTEM_ID&gt;/attributes</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">swi_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/images/vEOS_4.14.5F.swi</span>
<span class="l-Scalar-Plain">swi_version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.14.5F</span>
<span class="l-Scalar-Plain">swi_name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">4.14.5F&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>Explanation<a class="headerlink" href="#id13" title="Permalink to this headline">Â¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">attributes</span></tt> file is optional.  The variables that are contained within it
are sent to the node during provisioning. In the final example above you can see
how the attributes file and definition work in concert. Note that the ZTPServer
performs variable substitution when the node requests the definition via
GET /nodes/&lt;SYSTEM_ID&gt;. By removing the static values from the definition, we can
use the same definition for multiple nodes (using symlink) and just create unique
attributes files in the node&#8217;s directory.</p>
<p>It&#8217;s important to note that these variables can exist in different places and
accomplish the same task.  In this recipe we created a unique attributes file,
which lives in the node&#8217;s directory. You can also put these attributes directly
into the definition file like the example below.</p>
<p><strong>Example: At the global scope of the definition</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_image</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_url</span>
      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_version</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_name</span>
<span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">swi_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/images/vEOS_4.14.5F.swi</span>
  <span class="l-Scalar-Plain">swi_version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.14.5F</span>
  <span class="l-Scalar-Plain">swi_name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">4.14.5F&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="symlink-to-a-generic-definition">
<h2><a class="toc-backref" href="#id22">Symlink to a Generic Definition</a><a class="headerlink" href="#symlink-to-a-generic-definition" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id14">
<h3>Objective<a class="headerlink" href="#id14" title="Permalink to this headline">Â¶</a></h3>
<p>I&#8217;d like to use the same definition for multiple static node directories without
manually updating each one.</p>
</div>
<div class="section" id="id15">
<h3>Solution<a class="headerlink" href="#id15" title="Permalink to this headline">Â¶</a></h3>
<p>Create one definition in the <tt class="docutils literal"><span class="pre">[data_root]/definitions</span></tt> folder and create a symlink
to the specific <tt class="docutils literal"><span class="pre">[data_root]/nodes/&lt;SYSTEM_ID&gt;/</span></tt> folder.</p>
<p><strong>``[data_root]/definitions/static_node_definition</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_image</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_url</span>
      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_version</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$swi_name</span>
</pre></div>
</div>
<p>and the <strong>nodes/&lt;SYSTEM_ID&gt;/attributes</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">swi_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/images/vEOS_4.14.5F.swi</span>
<span class="l-Scalar-Plain">swi_version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.14.5F</span>
<span class="l-Scalar-Plain">swi_name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">4.14.5F&quot;</span>
</pre></div>
</div>
<p>then create the symlink</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your node&#39;s unique directory
admin@ztpserver:~# cd /usr/share/ztpserver/nodes/&lt;SYSTEM_ID&gt;

# Create the symlink
admin@ztpserver:~# ln -s /usr/share/ztpserver/definitions/static_node_definition ./definition
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h3>Explanation<a class="headerlink" href="#id16" title="Permalink to this headline">Â¶</a></h3>
<p>The steps above let you reuse a single definition file for many static nodes. Note
that the variables are located in the attributes file in the <tt class="docutils literal"><span class="pre">nodes/&lt;SYSTEM_ID&gt;/</span></tt>
folder.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dynamicNodes.html" class="btn btn-neutral float-right" title="Provision a Dynamic Node"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="helloWorld.html" class="btn btn-neutral" title="Hello World - A Simple Provisioning Example"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>