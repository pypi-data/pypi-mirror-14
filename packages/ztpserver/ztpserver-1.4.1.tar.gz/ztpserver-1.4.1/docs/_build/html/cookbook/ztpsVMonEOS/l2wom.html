

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ZTPServer VM on EOS in a L2WOM &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="../../index.html"/>
        <link rel="up" title="Run ZTPServer as a VM on EOS" href="../ztpsVMonEOS.html"/>
        <link rel="next" title="ZTPServer VM on EOS in a L3WOM" href="l3wom.html"/>
        <link rel="prev" title="ZTPServer VM on EOS in a L2L3WM" href="l2l3wm.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../cookbook.html">ZTPServer Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. Whatâ€™s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../cookbook.html">ZTPServer Cookbook</a> &raquo;</li>
      
          <li><a href="../ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a> &raquo;</li>
      
    <li>ZTPServer VM on EOS in a L2WOM</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/cookbook/ztpsVMonEOS/l2wom.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="ztpserver-vm-on-eos-in-a-l2wom">
<h1>ZTPServer VM on EOS in a L2WOM<a class="headerlink" href="#ztpserver-vm-on-eos-in-a-l2wom" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="files-needed">
<h2>Files Needed<a class="headerlink" href="#files-needed" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ztps.vmdk</span></tt>     : the VM disk image for the ZTPServer VM</li>
<li><tt class="docutils literal"><span class="pre">startup-config</span></tt>: a text file (with no extension)</li>
<li><tt class="docutils literal"><span class="pre">ztps.sh</span></tt>       : a bash shell script</li>
<li><tt class="docutils literal"><span class="pre">ztps.xml</span></tt>      : an xml file</li>
<li><tt class="docutils literal"><span class="pre">fullrecover</span></tt>   : an empty text file (with no extension)</li>
<li><tt class="docutils literal"><span class="pre">boot-config</span></tt>   : a text file (with no extension); contains a single line: <tt class="docutils literal"><span class="pre">SWI=flash:EOS.swi</span></tt></li>
<li><tt class="docutils literal"><span class="pre">EOS.swi</span></tt>       : download an EOS image and rename it to <tt class="docutils literal"><span class="pre">EOS.swi</span></tt></li>
</ul>
</div>
<div class="section" id="ztps-vmdk">
<h2>ztps.vmdk<a class="headerlink" href="#ztps-vmdk" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">Â¶</a></h3>
<p>I want to create a ZTPServer vmdk file to use on EOS.</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">Â¶</a></h3>
<dl class="docutils">
<dt>The ZTPServer vmdk file can be created using either methods below:</dt>
<dd><ol class="first last arabic simple">
<li>Automatically Create a Full-Featured ZTPServer: <a class="reference external" href="https://github.com/arista-eosplus/packer-ZTPServer">https://github.com/arista-eosplus/packer-ZTPServer</a></li>
<li>Create your own VM and install ZTPServer as intructed in the &#8220;Installation&#8221; section</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">Â¶</a></h3>
<p>The turnkey solution detailed on the github will create a full featured ztps.vmdk by executing a single command.  The vmdk created using this method comes with certain parameters pre-defined (i.e. domain-name, root user credential, IP address, etc).  If desired, you can change these parameters by logging into the VM after it&#8217;s created.</p>
<p>The second method requires more manual work compare to the first method, but may be more suitable if you already have a VM build to your needs and simply want to add ZTPServer to it.</p>
</div>
</div>
<div class="section" id="startup-config">
<h2>startup-config<a class="headerlink" href="#startup-config" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id1">
<h3>Objective<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>I need to prepare a startup-config for the first SPINE switch to enable ZTPServer.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>Essential parts of the configuration:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">event-handler</span> <span class="pre">ztps</span></tt>    : used to start the shell script <tt class="docutils literal"><span class="pre">ztps.sh</span></tt></li>
<li><tt class="docutils literal"><span class="pre">virtual-machine</span> <span class="pre">ztps</span></tt>  : used to start the ZTPServer VM on EOS</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span class="go">interface Vlan1</span>
<span class="go">  ip address 192.168.1.10/24</span>

<span class="go">event-handler ztps</span>
<span class="go">  trigger on-boot</span>
<span class="go">  action bash /mnt/flash/ztps.sh &amp;</span>
<span class="go">  delay 300</span>

<span class="go">virtual-machine ztps</span>
<span class="go">  config-file flash:/ztps.xml</span>
<span class="go">  enable</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Explanation<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">event-handler</span> <span class="pre">ztps</span></tt> is triggered on-boot to kickstart the shell script <tt class="docutils literal"><span class="pre">ztps.sh</span></tt>.  There is a delay of 300 seconds before the script will be executed, to make sure all the necessary systems are in place before we run the script.  For details of the script please see the <tt class="docutils literal"><span class="pre">ztps.sh</span></tt> section.</p>
<p>External systems will connect to the VM via Vlan1 (other VLANs can be used as well).  The host switch will connect to the VM via the Linux bridge (See <tt class="docutils literal"><span class="pre">ztps.sh</span></tt>).  Therefore in this scenario we will need to have 2 interfaces on the ZTPServer VM.</p>
<p>For details of the shell script <tt class="docutils literal"><span class="pre">ztps.sh</span></tt> please refer to the corresponding section below.</p>
</div>
</div>
<div class="section" id="ztps-sh">
<h2>ztps.sh<a class="headerlink" href="#ztps-sh" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id4">
<h3>Objective<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>I want to create a shell script to set up all the necessary environment for ZTPServer when the switch boots up.</p>
</div>
<div class="section" id="id5">
<h3>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span>!/bin/bash
<span class="gp">#</span> This script is used with the event-handler so that on-boot, we will create linux bridge,
<span class="gp">#</span><span class="nb">enable </span>ip.forwarding, restart the ZTPS VM, and start DHCPD
<span class="go">logger -t &quot;ZTPS&quot; -p local0.info &quot;Starting the process for ZTPS VM deployment&quot;</span>

<span class="gp">#</span> Create Linux Bridge
<span class="go">sudo brctl addbr br0</span>
<span class="go">sudo ifconfig br0 up</span>
<span class="go">sudo ifconfig br0 172.16.130.254/24</span>

<span class="go">logger -t &quot;ZTPS&quot; -p local0.info &quot;Linux Bridge created&quot;</span>

<span class="gp">#</span>Now lets restart the  ZTPS VM
<span class="go">sudo echo -e &quot;enable\nconfigure terminal\nvirtual-machine ztps restart\n&quot; | FastCli -M -e -p 15</span>

<span class="go">logger -t &quot;ZTPS&quot; -p local0.info &quot;ZTPS VM restarted&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Explanation<a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<p>In order to enable connectivity to the VM locally (from the host switch), a Linux bridge interface needs to be created and assigned an IP in the same subnet as one of the interfaces on the VM.</p>
<p>The ZTPServer VM needs to be restarted after the switch boots up.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ZTPServer VM needs to have its default gateway pointed to the default gateway of Vlan1 (or your choice of VLAN).</p>
</div>
</div>
</div>
<div class="section" id="ztps-xml">
<h2>ztps.xml<a class="headerlink" href="#ztps-xml" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id7">
<h3>Objective<a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>I want to prepare a KVM custom xml file to enable a VM on EOS.</p>
</div>
<div class="section" id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<p>Key parts of the xml file to pay attention to:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&lt;domain</span> <span class="pre">type='kvm'</span> <span class="pre">id='1'&gt;</span></tt>          : id needs to be unique (if more than 1 VM)</li>
<li><tt class="docutils literal"><span class="pre">&lt;driver</span> <span class="pre">name='qemu'</span> <span class="pre">type='vmdk'/&gt;</span></tt>   : make sure the type is <tt class="docutils literal"><span class="pre">vmdk</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&lt;source</span> <span class="pre">file='/mnt/usb1/ztps.vmdk'/&gt;</span></tt>: make sure the path is correct</li>
<li><strong>Interface definition section</strong>        :<ul>
<li>MAC address in the xml need to match the MAC address of the interfaces on the ZTPServer VM.</li>
<li>The first interface type is direct and is mapped to vlan1.  This is the interface that will be used for other switches to reach the VM.</li>
<li>The second interface type is bridge and is using Linux bridge.  This interface is solely used for local host switch to VM connectivity.</li>
</ul>
</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;domain type=&#39;kvm&#39; id=&#39;1&#39;&gt;</span>
<span class="go">  &lt;name&gt;ztps&lt;/name&gt;</span>
<span class="go">  &lt;memory&gt;1048576&lt;/memory&gt;</span>
<span class="go">  &lt;currentMemory&gt;1048576&lt;/currentMemory&gt;</span>
<span class="go">  &lt;vcpu&gt;1&lt;/vcpu&gt;</span>
<span class="go">  &lt;os&gt;</span>
<span class="go">    &lt;type arch=&#39;x86_64&#39; machine=&#39;pc-i440fx-1.4&#39;&gt;hvm&lt;/type&gt;</span>
<span class="go">    &lt;boot dev=&#39;hd&#39;/&gt;</span>
<span class="go">  &lt;/os&gt;</span>
<span class="go">  &lt;features&gt;</span>
<span class="go">    &lt;acpi/&gt;</span>
<span class="go">    &lt;apic/&gt;</span>
<span class="go">    &lt;pae/&gt;</span>
<span class="go">  &lt;/features&gt;</span>
<span class="go">  &lt;clock offset=&#39;utc&#39;/&gt;</span>
<span class="go">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</span>
<span class="go">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</span>
<span class="go">  &lt;on_crash&gt;restart&lt;/on_crash&gt;</span>
<span class="go">  &lt;devices&gt;</span>
<span class="go">    &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;</span>
<span class="go">    &lt;disk type=&#39;file&#39; device=&#39;disk&#39;&gt;</span>
<span class="go">      &lt;driver name=&#39;qemu&#39; type=&#39;vmdk&#39;/&gt;</span>
<span class="go">      &lt;source file=&#39;/mnt/usb1/ztps.vmdk&#39;/&gt;</span>
<span class="go">      &lt;target dev=&#39;hda&#39; bus=&#39;ide&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;ide0-0-0&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;drive&#39; controller=&#39;0&#39; bus=&#39;0&#39; unit=&#39;0&#39;/&gt;</span>
<span class="go">    &lt;/disk&gt;</span>
<span class="go">    &lt;controller type=&#39;ide&#39; index=&#39;0&#39;&gt;</span>
<span class="go">      &lt;alias name=&#39;ide0&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x01&#39; function=&#39;0x1&#39;/&gt;</span>
<span class="go">    &lt;/controller&gt;</span>
<span class="go">    &lt;interface type=&#39;direct&#39;&gt;</span>
<span class="go">      &lt;mac address=&#39;08:00:27:bc:d7:38&#39;/&gt;</span>
<span class="go">      &lt;source dev=&#39;vlan1&#39; mode=&#39;bridge&#39;/&gt;</span>
<span class="go">      &lt;target dev=&#39;macvtap0&#39;/&gt;</span>
<span class="go">      &lt;model type=&#39;e1000&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;net0&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;</span>
<span class="go">    &lt;/interface&gt;</span>
<span class="go">    &lt;interface type=&#39;bridge&#39;&gt;</span>
<span class="go">      &lt;mac address=&#39;08:00:27:85:0c:f8&#39;/&gt;</span>
<span class="go">      &lt;source bridge=&#39;br0&#39;/&gt;</span>
<span class="go">      &lt;target dev=&#39;macvtap1&#39;/&gt;</span>
<span class="go">      &lt;model type=&#39;e1000&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;net1&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x04&#39; function=&#39;0x0&#39;/&gt;</span>
<span class="go">    &lt;/interface&gt;</span>
<span class="go">    &lt;serial type=&#39;pty&#39;&gt;</span>
<span class="go">      &lt;source path=&#39;/dev/pts/5&#39;/&gt;</span>
<span class="go">      &lt;target port=&#39;0&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;serial0&#39;/&gt;</span>
<span class="go">    &lt;/serial&gt;</span>
<span class="go">    &lt;console type=&#39;pty&#39; tty=&#39;/dev/pts/5&#39;&gt;</span>
<span class="go">      &lt;source path=&#39;/dev/pts/5&#39;/&gt;</span>
<span class="go">      &lt;target type=&#39;serial&#39; port=&#39;0&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;serial0&#39;/&gt;</span>
<span class="go">    &lt;/console&gt;</span>
<span class="go">    &lt;input type=&#39;tablet&#39; bus=&#39;usb&#39;&gt;</span>
<span class="go">      &lt;alias name=&#39;input0&#39;/&gt;</span>
<span class="go">    &lt;/input&gt;</span>
<span class="go">    &lt;input type=&#39;mouse&#39; bus=&#39;ps2&#39;/&gt;</span>
<span class="go">    &lt;graphics type=&#39;vnc&#39; port=&#39;5900&#39; autoport=&#39;no&#39; listen=&#39;0.0.0.0&#39;/&gt;</span>
<span class="go">    &lt;video&gt;</span>
<span class="go">      &lt;model type=&#39;vga&#39; vram=&#39;8192&#39; heads=&#39;1&#39;/&gt;</span>
<span class="go">      &lt;alias name=&#39;video0&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x02&#39; function=&#39;0x0&#39;/&gt;</span>
<span class="go">    &lt;/video&gt;</span>
<span class="go">    &lt;memballoon model=&#39;virtio&#39;&gt;</span>
<span class="go">      &lt;alias name=&#39;balloon0&#39;/&gt;</span>
<span class="go">      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x05&#39; function=&#39;0x0&#39;/&gt;</span>
<span class="go">    &lt;/memballoon&gt;</span>
<span class="go">  &lt;/devices&gt;</span>
<span class="go">&lt;/domain&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Explanation<a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>The interface definition section defines how the interface(s) of the VM should be initialized.  Since the vmdk already has interfaces defined/initialized, we have to use the same MAC address in the KVM definition file.</p>
<p>In the first interface definition we use <tt class="docutils literal"><span class="pre">interface</span> <span class="pre">type='direct'</span></tt>.  In this configuration we map the first interface of the VM to the <tt class="docutils literal"><span class="pre">vlan1</span></tt> interface directly, enabling connectivity to the VM from external of the host switch.  However, <tt class="docutils literal"><span class="pre">interface</span> <span class="pre">type='direct'</span></tt> does not allow for host switch to VM connectivity, therefore we need to define a second interface with <tt class="docutils literal"><span class="pre">interface</span> <span class="pre">type='bridge'</span></tt> and map that to the Linux bridge for this puspose.</p>
<p>The reason we could not just bridge Vlan1 with the Linux bridge (and therefore just use one interface to enable both local and external connectivity) is because when we enslave an interface to br0, that interface cannot have an IP address on it, otherwise the connectivity would break.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="l3wom.html" class="btn btn-neutral float-right" title="ZTPServer VM on EOS in a L3WOM"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="l2l3wm.html" class="btn btn-neutral" title="ZTPServer VM on EOS in a L2L3WM"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>