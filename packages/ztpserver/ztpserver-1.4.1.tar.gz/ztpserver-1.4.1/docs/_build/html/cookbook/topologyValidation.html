

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Topology Validation &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="../index.html"/>
        <link rel="up" title="ZTPServer Cookbook" href="../cookbook.html"/>
        <link rel="next" title="Definitions" href="definitions.html"/>
        <link rel="prev" title="Provision a Dynamic Node" href="dynamicNodes.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../cookbook.html">ZTPServer Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. What’s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../cookbook.html">ZTPServer Cookbook</a> &raquo;</li>
      
    <li>Topology Validation</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/cookbook/topologyValidation.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="topology-validation">
<span id="tv-reference-label"></span><h1>Topology Validation<a class="headerlink" href="#topology-validation" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#enable-disable-topology-validation" id="id16">Enable/Disable Topology Validation</a></li>
<li><a class="reference internal" href="#allow-any-neighbor" id="id17">Allow Any Neighbor</a></li>
<li><a class="reference internal" href="#match-pattern-with-exact-string" id="id18">Match Pattern with Exact String</a></li>
<li><a class="reference internal" href="#match-pattern-using-a-regular-expression" id="id19">Match Pattern Using a Regular Expression</a></li>
<li><a class="reference internal" href="#match-pattern-that-includes-a-string" id="id20">Match Pattern That Includes a String</a></li>
<li><a class="reference internal" href="#match-pattern-that-excludes-a-string" id="id21">Match Pattern That Excludes a String</a></li>
</ul>
</div>
<div class="section" id="enable-disable-topology-validation">
<h2><a class="toc-backref" href="#id16">Enable/Disable Topology Validation</a><a class="headerlink" href="#enable-disable-topology-validation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h3>
<p>Topology Validation uses LLDP Neighbor information to make sure you have everything
wired up correctly. Topology Validation is enabled/disabled in the main <tt class="docutils literal"><span class="pre">ztpserver.conf</span></tt>
configuration file.</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h3>
<p>Open up the global ZTPServer configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> vi /etc/ztpserver/ztpserver.conf
</pre></div>
</div>
<p>Look for the line <tt class="docutils literal"><span class="pre">disable_topology_validation</span></tt></p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> To disable Topology Validation
<span class="go">disable_topology_validation = True</span>

<span class="gp">#</span>To <span class="nb">enable </span>Topology Validation
<span class="go">disable_topology_validation = False</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> If using Apache WSGI
<span class="gp">admin@ztpserver:~#</span> service apache2 restart

<span class="gp">#</span> If running in Standalone Mode, stop ztps
<span class="gp">admin@ztpserver:~#</span> pkill ztps

<span class="gp">#</span> Then start it again
<span class="gp">admin@ztpserver:~#</span> ztps
</pre></div>
</div>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h3>
<p>This configuration option enables/disables Topology Validation. This feature
is extremely powerful and can help you confirm all of your nodes are wired up
correctly. See the recipes below to learn more about the flexibility of
Topology Validation.</p>
</div>
</div>
<div class="section" id="allow-any-neighbor">
<h2><a class="toc-backref" href="#id17">Allow Any Neighbor</a><a class="headerlink" href="#allow-any-neighbor" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Objective<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>I want to provision a node without knowing anything about it. I just want it to
receive a default configuration.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>You can accomplish this by using neighbordb. Neighbordb contains associations
between LLDP neighbor patterns and definitions. So if we use a pattern that
matches anything, we can use it to assign a simple, default definition.</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Modify your neighbordb
admin@ztpserver:~# vi neighbordb
</pre></div>
</div>
<p>Add the following lines to your definition, changing values where needed:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Default Pattern</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">default</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any:any</span>
</pre></div>
</div>
<p>If you happen to be provisioning a node in isolation and the node does not have
any neighbors, use the following pattern:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Default Pattern</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">default</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">none</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">none:none</span>
</pre></div>
</div>
<p>Then add a definition to <tt class="docutils literal"><span class="pre">[data_root]/definitions/default</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the sections on Definitions and Actions to learn more.</p>
</div>
</div>
<div class="section" id="id3">
<h3>Explanation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>By placing this pattern in your neighbordb, the ZTPServer will allow this node
to be provisioned and will assign it the <tt class="docutils literal"><span class="pre">default</span></tt> definition. Use caution when
placing this pattern in your neighbordb as it might allow nodes to receive the
<tt class="docutils literal"><span class="pre">default</span></tt> definition when you intend them to receive another pattern.</p>
</div>
</div>
<div class="section" id="match-pattern-with-exact-string">
<h2><a class="toc-backref" href="#id18">Match Pattern with Exact String</a><a class="headerlink" href="#match-pattern-with-exact-string" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Objective<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>I want my node to be dynamically provisioned based upon a specific LLDP
neighbor association.</p>
</div>
<div class="section" id="id5">
<h3>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Modify your neighbordb:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Modify your neighbordb
admin@ztpserver:~# vi neighbordb
</pre></div>
</div>
<p>Then add the pattern that includes the required match.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora for pod1</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ethernet1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dc1-pod1-spine1:Ethernet1</span>
</pre></div>
</div>
<p>This pattern says that the node being provisioned must have a connection between
its Ethernet1 and dc1-pod1-spine1&#8217;s Ethernet1.</p>
</div>
<div class="section" id="id6">
<h3>Explanation<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>In this recipe we use neighbordb to link a pattern with a definition. When a node
executes the bootstrap script it will send the ZTPServer some information about
itself. The ZTPServer will not find any existing directory with the node&#8217;s
System-ID (System MAC or Serial Number depending upon your configuration) so it
next checks neighbordb to try and find a match. The ZTPServer will analyze
the nodes LLDP neighbors, find the match in neighbordb and then apply the <tt class="docutils literal"><span class="pre">tora</span></tt>
definition.</p>
</div>
</div>
<div class="section" id="match-pattern-using-a-regular-expression">
<h2><a class="toc-backref" href="#id19">Match Pattern Using a Regular Expression</a><a class="headerlink" href="#match-pattern-using-a-regular-expression" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Objective<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>I want my node to be dynamically provisioned and I&#8217;d like to match certain
neighbors using regex.</p>
</div>
<div class="section" id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Modify your neighbordb:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Modify your neighbordb
admin@ztpserver:~# vi neighbordb
</pre></div>
</div>
<p>Then add the pattern that includes the required match.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora for pod1</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ethernet1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">regex(&#39;dc1-pod1-spine\D+&#39;):Ethernet1</span>
</pre></div>
</div>
<p>This pattern says that the node being provisioned must have a connection between
its Ethernet1 and any dc1-pod1-spines Ethernet1.</p>
</div>
<div class="section" id="id9">
<h3>Explanation<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>In this recipe we use neighbordb to link a pattern with a definition. When a node
executes the bootstrap script it will send the ZTPServer some information about
itself. The ZTPServer will not find any existing directory with the node&#8217;s
System-ID (System MAC or Serial Number depending upon your configuration) so it
next checks neighbordb to try and find a match. The ZTPServer will analyze
the nodes LLDP neighbors, find the match in neighbordb and then apply the <tt class="docutils literal"><span class="pre">tora</span></tt>
definition.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are a few different functions that you can use other than <tt class="docutils literal"><span class="pre">regex()</span></tt>.
Check out this <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/config.html#variables">section</a>
to learn more.</p>
</div>
</div>
</div>
<div class="section" id="match-pattern-that-includes-a-string">
<h2><a class="toc-backref" href="#id20">Match Pattern That Includes a String</a><a class="headerlink" href="#match-pattern-that-includes-a-string" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>Objective<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>I want my node to be dynamically provisioned and I&#8217;d like to match certain
neighbors as long as the neighbor hostname includes a certain string.</p>
</div>
<div class="section" id="id11">
<h3>Solution<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Modify your neighbordb:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Modify your neighbordb
admin@ztpserver:~# vi neighbordb
</pre></div>
</div>
<p>Then add the pattern that includes the required match.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora for pod1</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ethernet1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">includes(&#39;dc1-pod1&#39;):Ethernet1</span>
</pre></div>
</div>
<p>This pattern says that the node being provisioned must have a connection between
its Ethernet1 and any hostname that includes <tt class="docutils literal"><span class="pre">dc1-pod1</span></tt> Ethernet1.</p>
</div>
<div class="section" id="id12">
<h3>Explanation<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>In this recipe we use neighbordb to link a pattern with a definition. When a node
executes the bootstrap script it will send the ZTPServer some information about
itself. The ZTPServer will not find any existing directory with the node&#8217;s
System-ID (System MAC or Serial Number depending upon your configuration) so it
next checks neighbordb to try and find a match. The ZTPServer will analyze
the nodes LLDP neighbors, find the match in neighbordb and then apply the <tt class="docutils literal"><span class="pre">tora</span></tt>
definition.</p>
</div>
</div>
<div class="section" id="match-pattern-that-excludes-a-string">
<h2><a class="toc-backref" href="#id21">Match Pattern That Excludes a String</a><a class="headerlink" href="#match-pattern-that-excludes-a-string" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id13">
<h3>Objective<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>I want my node to be dynamically provisioned and I&#8217;d like to match certain
neighbors as long as the neighbor hostname excludes a certain string.</p>
</div>
<div class="section" id="id14">
<h3>Solution<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Using the <tt class="docutils literal"><span class="pre">excludes()</span></tt> function allows you to match the inverse of the
<tt class="docutils literal"><span class="pre">includes()</span></tt> function.</p>
<p>Modify your neighbordb:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Modify your neighbordb
admin@ztpserver:~# vi neighbordb
</pre></div>
</div>
<p>Then add the pattern that includes the required match.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora for pod1</span>
    <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tora</span>
    <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ethernet1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">includes(&#39;dc1-pod1&#39;):Ethernet1</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">excludes(&#39;spine&#39;):Ethernet50</span>
</pre></div>
</div>
<p>This pattern says that the node being provisioned must have a connection between
its Ethernet1 and any hostname that includes <tt class="docutils literal"><span class="pre">dc1-pod1</span></tt> Ethernet1.</p>
</div>
<div class="section" id="id15">
<h3>Explanation<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>In this recipe we use neighbordb to link a pattern with a definition. When a node
executes the bootstrap script it will send the ZTPServer some information about
itself. The ZTPServer will not find any existing directory with the node&#8217;s
System-ID (System MAC or Serial Number depending upon your configuration) so it
next checks neighbordb to try and find a match. The ZTPServer will analyze
the nodes LLDP neighbors, find the match in neighbordb and then apply the <tt class="docutils literal"><span class="pre">tora</span></tt>
definition.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="definitions.html" class="btn btn-neutral float-right" title="Definitions"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dynamicNodes.html" class="btn btn-neutral" title="Provision a Dynamic Node"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>