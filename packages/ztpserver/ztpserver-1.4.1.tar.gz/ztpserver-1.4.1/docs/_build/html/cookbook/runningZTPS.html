

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running the ZTPServer &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="../index.html"/>
        <link rel="up" title="ZTPServer Cookbook" href="../cookbook.html"/>
        <link rel="next" title="Hello World - A Simple Provisioning Example" href="helloWorld.html"/>
        <link rel="prev" title="ZTPServer Configuration" href="configuration.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../cookbook.html">ZTPServer Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. What’s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../cookbook.html">ZTPServer Cookbook</a> &raquo;</li>
      
    <li>Running the ZTPServer</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/cookbook/runningZTPS.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="running-the-ztpserver">
<h1>Running the ZTPServer<a class="headerlink" href="#running-the-ztpserver" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#standalone-change-the-ztpserver-interface" id="id19">Standalone - Change the ZTPServer Interface</a></li>
<li><a class="reference internal" href="#standalone-run-ztpserver-on-a-specific-port" id="id20">Standalone - Run ZTPServer on a Specific Port</a></li>
<li><a class="reference internal" href="#standalone-run-ztpserver-in-a-sub-directory" id="id21">Standalone - Run ZTPServer in a Sub-directory</a></li>
<li><a class="reference internal" href="#apache-run-ztpserver-on-a-specific-port" id="id22">Apache - Run ZTPServer on a Specific Port</a></li>
<li><a class="reference internal" href="#apache-run-ztpserver-in-a-sub-directory" id="id23">Apache - Run ZTPServer in a Sub-directory</a></li>
<li><a class="reference internal" href="#change-ztpserver-file-ownership" id="id24">Change ZTPServer File Ownership</a></li>
<li><a class="reference internal" href="#apache-configure-selinux-permissions" id="id25">Apache - Configure SELinux Permissions</a></li>
</ul>
</div>
<div class="section" id="standalone-change-the-ztpserver-interface">
<h2><a class="toc-backref" href="#id19">Standalone - Change the ZTPServer Interface</a><a class="headerlink" href="#standalone-change-the-ztpserver-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h3>
<p>I only want the ZTPServer process to listen on a specific network interface.</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h3>
<p>Open up the global ZTPServer configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> vi /etc/ztpserver/ztpserver.conf
</pre></div>
</div>
<p>Look for the line <tt class="docutils literal"><span class="pre">interface</span></tt> in the [server] group.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> To listen on all interfaces
<span class="go">interface = 0.0.0.0</span>

<span class="gp">#</span> To listen on a specific interface
<span class="go">interface = 192.0.2.100</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> If running in Standalone Mode, stop ztps
<span class="gp">admin@ztpserver:~#</span> pkill ztps

<span class="gp">#</span> Then start it again
<span class="gp">admin@ztpserver:~#</span> ztps &amp;
</pre></div>
</div>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h3>
<p>This recipe helps you define a specific interface for the ZTPServer to listen on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure the <tt class="docutils literal"><span class="pre">interface</span></tt> coincides with the <tt class="docutils literal"><span class="pre">server_url</span></tt> value in
the configuration file.</p>
</div>
</div>
</div>
<div class="section" id="standalone-run-ztpserver-on-a-specific-port">
<h2><a class="toc-backref" href="#id20">Standalone - Run ZTPServer on a Specific Port</a><a class="headerlink" href="#standalone-run-ztpserver-on-a-specific-port" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Objective<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>I want to define which port the ZTPServer listens on.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Open up the global ZTPServer configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> vi /etc/ztpserver/ztpserver.conf
</pre></div>
</div>
<p>Look for the line <tt class="docutils literal"><span class="pre">port</span></tt> in the [server] group.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Choose a port of your liking
<span class="go">port = 8080</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> If running in Standalone Mode, stop ztps
<span class="gp">admin@ztpserver:~#</span> pkill ztps

<span class="gp">#</span> Then start it again
<span class="gp">admin@ztpserver:~#</span> ztps &amp;
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Explanation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>This recipe helps you define a specific port for the ZTPServer to listen on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure the <tt class="docutils literal"><span class="pre">port</span></tt> coincides with the <tt class="docutils literal"><span class="pre">server_url</span></tt> value in
the configuration file.</p>
</div>
</div>
</div>
<div class="section" id="standalone-run-ztpserver-in-a-sub-directory">
<h2><a class="toc-backref" href="#id21">Standalone - Run ZTPServer in a Sub-directory</a><a class="headerlink" href="#standalone-run-ztpserver-in-a-sub-directory" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Objective<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>I don&#8217;t want to run the ZTPServer at the root of my domain, I want it in a
sub-directory.</p>
</div>
<div class="section" id="id5">
<h3>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Open up the global ZTPServer configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> vi /etc/ztpserver/ztpserver.conf
</pre></div>
</div>
<p>Look for the line <tt class="docutils literal"><span class="pre">server_url</span></tt> in the [default] group.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Choose a subdirectory
<span class="go">server_url = http://ztpserver:8080/not/in/root/anymore</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> If running in Standalone Mode, stop ztps
<span class="gp">admin@ztpserver:~#</span> pkill ztps

<span class="gp">#</span> Then start it again
<span class="gp">admin@ztpserver:~#</span> ztps &amp;
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Explanation<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">server_url</span></tt> key defines where the REST API lives. You do not need to
change any of your file locations to affect change. Simply change the key above.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can confirm the change by doing a simple
<tt class="docutils literal"><span class="pre">wget</span> <span class="pre">http://server:port/new/directory/path/bootstrap</span></tt> to retrieve
the bootstrap script.</p>
</div>
</div>
</div>
<div class="section" id="apache-run-ztpserver-on-a-specific-port">
<h2><a class="toc-backref" href="#id22">Apache - Run ZTPServer on a Specific Port</a><a class="headerlink" href="#apache-run-ztpserver-on-a-specific-port" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Objective<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>I&#8217;m running ZTPServer as a WSGI with Apache and want to change what port it
listens on.</p>
</div>
<div class="section" id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Apache configurations can vary widely, and the ZTPServer has no control over this,
so view this simply as a suggestion.</p>
<p>Open up your Apache configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Apache
<span class="gp">admin@ztpserver:~#</span> vi /etc/apache2/sites-enabled/ztpserver.conf

<span class="gp">#</span> HTTPd
<span class="gp">admin@ztpserver:~#</span> vi /etc/httpd/conf.d/ztpserver.conf
</pre></div>
</div>
<p>Change the <tt class="docutils literal"><span class="pre">Listen</span></tt> and <tt class="docutils literal"><span class="pre">VirtualHost</span></tt> values to the desired port.</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="nb">LoadModule</span> wsgi_module modules/mod_wsgi.so
<span class="nb">Listen</span> <span class="m">8080</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">*:8080</span><span class="nt">&gt;</span>

    <span class="nb">WSGIDaemonProcess</span> ztpserver <span class="k">user</span>=www-data <span class="k">group</span>=www-data threads=50
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/etc/ztpserver/ztpserver.wsgi</span>
    <span class="c"># Required for RHEL</span>
    <span class="c">#WSGISocketPrefix /var/run/wsgi</span>

    <span class="nt">&lt;Location</span> <span class="s">/</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> ztpserver
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}

        <span class="c"># For Apache &lt;= 2.2, use Order and Allow</span>
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
        <span class="c"># For Apache &gt;= 2.4, Allow is replaced by Require</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
    <span class="nt">&lt;/Location&gt;</span>

    <span class="c"># Override default logging locations for Apache</span>
    <span class="c">#ErrorLog /path/to/ztpserver_error.log</span>
    <span class="c">#CustomLog /path/to/ztpserver_access.log</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Restart Apache
<span class="gp">admin@ztpserver:~#</span> service apache2 restart
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Explanation<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>When you run ZTPServer as a WSGI under Apache or like server, the interface
and port that are used for listening for HTTP requests are controlled by the
web server. The config snippet above shows how this might be done with Apache,
but note that variations might arise in your own environment.</p>
</div>
</div>
<div class="section" id="apache-run-ztpserver-in-a-sub-directory">
<h2><a class="toc-backref" href="#id23">Apache - Run ZTPServer in a Sub-directory</a><a class="headerlink" href="#apache-run-ztpserver-in-a-sub-directory" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>Objective<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>I&#8217;m running ZTPServer as a WSGI with Apache and I want to change the path that
the REST API resides.</p>
</div>
<div class="section" id="id11">
<h3>Solution<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>WSGI-compliant webserver configurations can vary widely, so here&#8217;s a sample of
how this is done with Apache.</p>
<p>Open up the global ZTPServer configuration file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> vi /etc/ztpserver/ztpserver.conf
</pre></div>
</div>
<p>Look for the line <tt class="docutils literal"><span class="pre">server_url</span></tt> in the [default] group.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Choose a subdirectory
<span class="go">server_url = http://ztpserver:8080/not/in/root/anymore</span>
</pre></div>
</div>
<p>You might think that you have to change your Apache conf to move this to a
sub-directory, but you don&#8217;t. Your config should look like the block below.
Note the <tt class="docutils literal"><span class="pre">&lt;Location</span> <span class="pre">/&gt;</span></tt>.</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="nb">LoadModule</span> wsgi_module modules/mod_wsgi.so
<span class="nb">Listen</span> <span class="m">8080</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">*:8080</span><span class="nt">&gt;</span>

    <span class="nb">WSGIDaemonProcess</span> ztpserver <span class="k">user</span>=www-data <span class="k">group</span>=www-data threads=50
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/etc/ztpserver/ztpserver.wsgi</span>
    <span class="c"># Required for RHEL</span>
    <span class="c">#WSGISocketPrefix /var/run/wsgi</span>

    <span class="nt">&lt;Location</span> <span class="s">/</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> ztpserver
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}

        <span class="c"># For Apache &lt;= 2.2, use Order and Allow</span>
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
        <span class="c"># For Apache &gt;= 2.4, Allow is replaced by Require</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
    <span class="nt">&lt;/Location&gt;</span>

    <span class="c"># Override default logging locations for Apache</span>
    <span class="c">#ErrorLog /path/to/ztpserver_error.log</span>
    <span class="c">#CustomLog /path/to/ztpserver_access.log</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Restart the ztps process:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Restart Apache
<span class="gp">admin@ztpserver:~#</span> service apache2 restart
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>Explanation<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>It might seem counter-intuitive but the Apache configuration should use the
<tt class="docutils literal"><span class="pre">Location</span></tt> directive to point at root. The desired change to the path is done
by the ZTPServer <tt class="docutils literal"><span class="pre">server_url</span></tt> configuration value in <tt class="docutils literal"><span class="pre">/etc/ztpserver/ztpserver.conf</span></tt>.</p>
</div>
</div>
<div class="section" id="change-ztpserver-file-ownership">
<h2><a class="toc-backref" href="#id24">Change ZTPServer File Ownership</a><a class="headerlink" href="#change-ztpserver-file-ownership" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id13">
<h3>Objective<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>I&#8217;d like all of the ZTPServer provisioning files to be owned by a particular
user/group.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is most often needed when running the ZTPServer WSGI App and the
apache user is unable to read/write to <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt>.</p>
</div>
</div>
<div class="section" id="id14">
<h3>Solution<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">admin@ztpserver:~#</span> chown -R myUser:myGroup /usr/share/ztpserver
<span class="gp">admin@ztpserver:~#</span> chmod -R ug+rw /usr/share/ztpserver
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>Explanation<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>The shell commands listed above set ownership and permissions for the default
data_root location <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt>. Be mindful that if you are running
the ZTPServer WSGI App, the mod_wsgi daemon user must be able to read/write to
these files.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When running the ZTPServer WSGI App, you should also check the
ownership and permission of <tt class="docutils literal"><span class="pre">/etc/ztpserver/ztpserver.wsgi</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="apache-configure-selinux-permissions">
<h2><a class="toc-backref" href="#id25">Apache - Configure SELinux Permissions</a><a class="headerlink" href="#apache-configure-selinux-permissions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id16">
<h3>Objective<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>My server has SELinux enabled and I&#8217;d like to set the ZTPServer file type so
that Apache can read/write files in the data_root.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is most often needed when running the ZTPServer WSGI App and the
apache user is unable to read/write to <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt>.</p>
</div>
</div>
<div class="section" id="id17">
<h3>Solution<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> For Fedora - httpd
<span class="gp">admin@ztpserver:~#</span> chcon -Rv --type<span class="o">=</span>httpd_sys_script_rw_t /usr/share/ztpserver

<span class="gp">#</span> For Ubuntu - Apache
<span class="gp">admin@ztpserver:~#</span> chcon -R -h system_u:object_r:httpd_sys_script_rw_t /usr/share/ztpserver
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h3>Explanation<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>The shell commands listed above set the SELinux file attributes so that Apache
can read/write to the files. This is often the case since <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt>
is not in the normal operating directory <tt class="docutils literal"><span class="pre">/var/www/</span></tt>.  Note that the commands
above are suggestions and you might consider tweaking them to suit your own
environment.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="helloWorld.html" class="btn btn-neutral float-right" title="Hello World - A Simple Provisioning Example"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral" title="ZTPServer Configuration"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>