

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Actions &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="../index.html"/>
        <link rel="up" title="ZTPServer Cookbook" href="../cookbook.html"/>
        <link rel="next" title="Resource Pools" href="resourcePools.html"/>
        <link rel="prev" title="Definitions" href="definitions.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../cookbook.html">ZTPServer Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. What’s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../cookbook.html">ZTPServer Cookbook</a> &raquo;</li>
      
    <li>Actions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/cookbook/actions.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="actions">
<h1>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#add-a-configuration-block-to-a-node" id="id17">Add a Configuration Block to a Node</a></li>
<li><a class="reference internal" href="#add-configuration-to-a-node-using-variables" id="id18">Add Configuration to a Node Using Variables</a></li>
<li><a class="reference internal" href="#replace-entire-startup-config-during-provisioning" id="id19">Replace Entire Startup-Config During Provisioning</a></li>
<li><a class="reference internal" href="#copy-a-file-to-a-node-during-provisioning" id="id20">Copy a File to a Node During Provisioning</a></li>
<li><a class="reference internal" href="#install-a-specific-eos-image" id="id21">Install a Specific EOS Image</a></li>
<li><a class="reference internal" href="#install-an-extension" id="id22">Install an Extension</a></li>
</ul>
</div>
<div class="section" id="add-a-configuration-block-to-a-node">
<h2><a class="toc-backref" href="#id17">Add a Configuration Block to a Node</a><a class="headerlink" href="#add-a-configuration-block-to-a-node" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h3>
<p>In order to keep your provisioning data modular, you may want to break apart
configuration blocks into small code blocks. You can use the <tt class="docutils literal"><span class="pre">add_config</span></tt>
action to place a block on code on the node.</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h3>
<p><strong>Example 1: Add a static block of configuration to your node</strong></p>
<p>First, create a template file with the desired configuration.</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Make sure you have a directory for templates
admin@ztpserver:~# mkdir -p files/templates

# Create a static config block
admin@ztpserver:~# vi files/templates/east-dns.template
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">!</span>
<span class="go">ip name-server vrf default east.ns1.example.com</span>
<span class="go">!</span>
</pre></div>
</div>
<p>Then add the <tt class="docutils literal"><span class="pre">add_config</span></tt> action to your definition:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">add_config</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/templates/east-dns.template</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Add</span><span class="nv"> </span><span class="s">East</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Server&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h3>
<p>Here we defined a simple action that adds configuration to the node during
provisioning. The <tt class="docutils literal"><span class="pre">url</span></tt> in this case is relative to <tt class="docutils literal"><span class="pre">[data_root]</span></tt>/url. It&#8217;s
important to realize that the ZTPServer does not compile these configuration
blocks into a startup-config and then send a single file to the node.  Rather,
the node executes each action independently, building the configuration in a
module fashion. If you are interested in performing variable substitution in your
templates to make them more flexible, see the next recipe.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please see the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.add_config">add_config</a>
documentation for more details.</p>
</div>
</div>
</div>
<div class="section" id="add-configuration-to-a-node-using-variables">
<h2><a class="toc-backref" href="#id18">Add Configuration to a Node Using Variables</a><a class="headerlink" href="#add-configuration-to-a-node-using-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Objective<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>I want to keep my templates flexible by using variables. In some cases, I&#8217;d like
to assign a variable from a resource pool.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>First, create a template file with the desired configuration. In this recipe let&#8217;s
configure interface Management1.</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Make sure you have a directory for templates
admin@ztpserver:~# mkdir -p files/templates

# Create a static config block
admin@ztpserver:~# vi files/templates/ma1.template
</pre></div>
</div>
<p>Paste this config into the template:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">!</span>
<span class="go">interface Management1</span>
<span class="go">  ip address $ipaddress</span>
<span class="go">  no shutdown</span>
<span class="go">!</span>
</pre></div>
</div>
<p>Then add the <tt class="docutils literal"><span class="pre">add_config</span></tt> action to your definition:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">add_config</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/templates/ma1.template</span>
      <span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">ipaddress</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">allocate(&quot;mgmt_subnet&quot;)</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Configure</span><span class="nv"> </span><span class="s">Ma1&quot;</span>
</pre></div>
</div>
<p>Then create a resource pool called mgmt_subnet:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Create a resource pool
<span class="gp">admin@ztpserver:~#</span> vi resources/mgmt_subnet
</pre></div>
</div>
<p>Paste the following into <tt class="docutils literal"><span class="pre">mgmt_subnet</span></tt>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">192.0.2.10/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
<span class="l-Scalar-Plain">192.0.2.11/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
<span class="l-Scalar-Plain">192.0.2.12/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
<span class="l-Scalar-Plain">192.0.2.13/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Explanation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>This recipe ties a few different concepts together. From a high-level, the definition
contains an action, <tt class="docutils literal"><span class="pre">add_config</span></tt>, which references a configuration block, <tt class="docutils literal"><span class="pre">ma1.template</span></tt>.
Further, we use a variable, <tt class="docutils literal"><span class="pre">$ipaddress</span></tt> in the template file so that the template
can be used for all nodes being provisioned.  The final piece is the use of the
<tt class="docutils literal"><span class="pre">allocate()</span></tt> plugin, which dynamically assigns a key from the associated
file-based resource pool.</p>
<p>In practice, when a node requests its definition the ZTPServer will execute the
<tt class="docutils literal"><span class="pre">allocate(&quot;mgmt_subnet&quot;)</span></tt> plugin and assign a key from the pool.
The ZTPServer will then write the SYSTEM_ID as the value, overwriting <tt class="docutils literal"><span class="pre">null</span></tt>.</p>
<p>If you wanted to use the assigned value elsewhere in the definition, simply call
<tt class="docutils literal"><span class="pre">allocate(mgmt_subnet)</span></tt> and the plugin will not assign a new value, rather it
will return the key already assigned. Note that this is an implementation-detail
specific to this particular plugin - other plugins might vary (please read the
associated documentation for each).</p>
<p>The result would look like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">192.0.2.10/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;SYSTEM_ID&gt;</span>
<span class="l-Scalar-Plain">192.0.2.11/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
<span class="l-Scalar-Plain">192.0.2.12/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
<span class="l-Scalar-Plain">192.0.2.13/24</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please see the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.add_config">add_config</a>
documentation for more details.</p>
</div>
</div>
</div>
<div class="section" id="replace-entire-startup-config-during-provisioning">
<h2><a class="toc-backref" href="#id19">Replace Entire Startup-Config During Provisioning</a><a class="headerlink" href="#replace-entire-startup-config-during-provisioning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>Objective<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>I have a complete startup-config that I want to apply during provisioning. I want
to completely replace what&#8217;s already on the node.</p>
</div>
<div class="section" id="id6">
<h3>Solution<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>First, create the startup-config with the desired configuration.</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Make sure you have a directory for templates
admin@ztpserver:~# mkdir -p files/configs

# Create a startup-config
admin@ztpserver:~# vi files/configs/tor-startup-config
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">!</span>
<span class="go">hostname test-node-1</span>
<span class="go">ip name-server vrf default &lt;DNS-SERVER-IP&gt;</span>
<span class="go">!</span>
<span class="go">ntp server &lt;NTP-SERVER-IP&gt;</span>
<span class="go">!</span>
<span class="go">username admin privilege 15 role network-admin secret admin</span>
<span class="go">!</span>
<span class="go">interface Management1</span>
<span class="go"> ip address &lt;MGMT-IP-ADDRESS&gt;/&lt;SUBNET&gt;</span>
<span class="go">!</span>
<span class="go">ip access-list open</span>
<span class="go"> 10 permit ip any any</span>
<span class="go">!</span>
<span class="go">ip route 0.0.0.0/0 &lt;DEFAULT-GW&gt;</span>
<span class="go">!</span>
<span class="go">ip routing</span>
<span class="go">!</span>
<span class="go">management api http-commands</span>
<span class="go"> no shutdown</span>
<span class="go">!</span>
<span class="go">banner login</span>
<span class="go">Welcome to $(hostname)!</span>
<span class="go">This switch has been provisioned using the ZTPServer from Arista Networks</span>
<span class="go">Docs: http://ztpserver.readthedocs.org/</span>
<span class="go">Source Code: https://github.com/arista-eosplus/ztpserver</span>
<span class="go">EOF</span>
<span class="go">!</span>
<span class="go">end</span>
</pre></div>
</div>
<p>Then add the <tt class="docutils literal"><span class="pre">replace_config</span></tt> action to your definition:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">replace_config</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/configs/tor-startup-config</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Replace</span><span class="nv"> </span><span class="s">entire</span><span class="nv"> </span><span class="s">startup-config&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Explanation<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>This action simply replaces the <tt class="docutils literal"><span class="pre">startup-config</span></tt> which lives in <tt class="docutils literal"><span class="pre">/mnt/flash/startup-config</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please see the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.replace_config">replace_config</a>
documentation for more details.</p>
</div>
</div>
</div>
<div class="section" id="copy-a-file-to-a-node-during-provisioning">
<h2><a class="toc-backref" href="#id20">Copy a File to a Node During Provisioning</a><a class="headerlink" href="#copy-a-file-to-a-node-during-provisioning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id8">
<h3>Objective<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>I want to copy a file to the node during the provisioning process and then
set its permissions.</p>
</div>
<div class="section" id="id9">
<h3>Solution<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>In this example we&#8217;ll copy a python script to the node and set its permissions.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">copy_file</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">dst_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/mnt/flash/</span>
      <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">777</span>
      <span class="l-Scalar-Plain">overwrite</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">if-missing</span>
      <span class="l-Scalar-Plain">src_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/automate/bgpautoinf.py</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;automate</span><span class="nv"> </span><span class="s">BGP</span><span class="nv"> </span><span class="s">peer</span><span class="nv"> </span><span class="s">interface</span><span class="nv"> </span><span class="s">config&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Explanation<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Here we add the <tt class="docutils literal"><span class="pre">copy_file</span></tt> action to our definition. The attributes listed in
the action will be passed to the node so that it is able to retrieve the script
from <tt class="docutils literal"><span class="pre">[SERVER_URL]/files/automate/bgpautoinf.py</span></tt>. Since we are using <tt class="docutils literal"><span class="pre">overwrite:</span> <span class="pre">if-missing</span></tt>,
the action will only copy the file to the node if it does not already exist.</p>
<p>You could define the <tt class="docutils literal"><span class="pre">url</span></tt> as any destination the node can reach during provisioning - the
file does not need to exist on the ZTPServer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please see the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.copy_file">copy_file</a>
documentation for more details.</p>
</div>
</div>
</div>
<div class="section" id="install-a-specific-eos-image">
<h2><a class="toc-backref" href="#id21">Install a Specific EOS Image</a><a class="headerlink" href="#install-a-specific-eos-image" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3>Objective<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>I want a specific (v)EOS version to be automatically installed when I provision
my node.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This assumes that you&#8217;ve already downloaded the desired (v)EOS image
from <a class="reference external" href="https://www.arista.com/en/support/software-download">Arista</a>.</p>
</div>
</div>
<div class="section" id="id12">
<h3>Solution<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s create a place on the ZTPServer to host some SWIs:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Create an images directory
admin@ztpserver:~# mkdir -p files/images

# SCP your SWI into the images directory, name it whatever you like
admin@ztpserver:~# scp admin@otherhost:/tmp/vEOS.swi files/images/vEOS_4.14.5F.swi
</pre></div>
</div>
<p>Now let&#8217;s create a definition that performs the <tt class="docutils literal"><span class="pre">install_image</span></tt> action:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Create a definition file
admin@ztpserver:~# vi definitions/tor-definition
</pre></div>
</div>
<p>Add the following lines to your definition, changing values where needed:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_image</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/images/vEOS_4.14.5F.swi</span>
      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.14.5F</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">4.14.5F&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The definition uses YAML syntax</p>
</div>
</div>
<div class="section" id="id13">
<h3>Explanation<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>In this case we are hosting the SWI on the ZTPServer, so we just define the <tt class="docutils literal"><span class="pre">url</span></tt> in relation
to the <tt class="docutils literal"><span class="pre">data_root</span></tt>. We could change the <tt class="docutils literal"><span class="pre">url</span></tt> to point to another server
altogether - the choice is yours. The benefit of hosting the file on the
ZTPServer is that we perform an extra checksum step to validate the integrity of
the file.</p>
<p>In practice, the node requests its definition during the provisioning process. It
sees that it&#8217;s supposed to perform the <tt class="docutils literal"><span class="pre">install_image</span></tt> action, so it
requests the <tt class="docutils literal"><span class="pre">install_image</span></tt> python script. It then performs an HTTP GET for
the <tt class="docutils literal"><span class="pre">url</span></tt>.  Once it has these locally, it executes the
<a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.install_image">install_image</a>
script.</p>
</div>
</div>
<div class="section" id="install-an-extension">
<h2><a class="toc-backref" href="#id22">Install an Extension</a><a class="headerlink" href="#install-an-extension" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>Objective<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>I want to install an extension on my node automatically.</p>
</div>
<div class="section" id="id15">
<h3>Solution<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s create a place on the ZTPServer to host the RPMs:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Create an images directory
admin@ztpserver:~# mkdir -p files/rpms

# SCP your SWI into the images directory, name it whatever you like
admin@ztpserver:~# scp admin@otherhost:/tmp/myRPM.rpm files/rpms/myRPM.rpm
</pre></div>
</div>
<p>Now let&#8217;s create a definition that performs the <tt class="docutils literal"><span class="pre">install_extension</span></tt> action:</p>
<div class="highlight-console"><div class="highlight"><pre># Go to your data_root - by default it&#39;s /usr/share/ztpserver
admin@ztpserver:~# cd /usr/share/ztpserver

# Create a definition file
admin@ztpserver:~# vi definitions/tor-definition
</pre></div>
</div>
<p>Add the following lines to your definition, changing values where needed:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">static node definition</span>
<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install_extension</span>
    <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/rpms/myRPM.rpm</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;Install</span><span class="nv"> </span><span class="s">myRPM</span><span class="nv"> </span><span class="s">extension&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The definition uses YAML syntax</p>
</div>
</div>
<div class="section" id="id16">
<h3>Explanation<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">install_extension</span></tt> will copy the RPM defined in the <tt class="docutils literal"><span class="pre">url</span></tt> parameter and
copy it to the default extension directory, <tt class="docutils literal"><span class="pre">/mnt/flash/.extensions</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please see the <a class="reference external" href="http://ztpserver.readthedocs.org/en/master/actions.html#module-actions.install_extension">install_extension</a>
documentation for more details.</p>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resourcePools.html" class="btn btn-neutral float-right" title="Resource Pools"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="definitions.html" class="btn btn-neutral" title="Definitions"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>