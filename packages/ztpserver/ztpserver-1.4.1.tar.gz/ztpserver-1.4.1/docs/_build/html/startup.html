

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Startup &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="index.html"/>
        <link rel="next" title="Configuration" href="config.html"/>
        <link rel="prev" title="Installation" href="install.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">ZTPServer Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. What’s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Startup</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/startup.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="startup">
<h1>Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#apache-mod-wsgi" id="id1">Apache (mod_wsgi)</a></li>
<li><a class="reference internal" href="#standalone-debug-server" id="id2">Standalone debug server</a></li>
</ul>
</div>
<p><strong>HTTP Server Deployment Options</strong></p>
<p>ZTPServer is a Python WSGI compliant application that can be deployed behind any WSGI web server or run as a standalone application.</p>
<p>After initial startup, any change to <tt class="docutils literal"><span class="pre">ztpserver.conf</span></tt> will require a server restart.   However, all other files are read on-demand, therefore no server restart is required to pick up changes in definitions, neighbordb, resources, etc.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ztps</span></tt> standalone server executable is for demo and testing use ONLY.   It is NOT recommended for production use!</p>
</div>
<div class="section" id="apache-mod-wsgi">
<h2><a class="toc-backref" href="#id1">Apache (mod_wsgi)</a><a class="headerlink" href="#apache-mod-wsgi" title="Permalink to this headline">¶</a></h2>
<p>If using Apache, this section provides instructions for setting up ZTPServer using mod_wsgi. This section assumes the reader is familiar with Apache and has already installed mod_wsgi. For details on how to install mod_wsgi, please see the <a class="reference external" href="https://code.google.com/p/modwsgi/wiki/QuickInstallationGuide">modwsgi Quick Installation Guide</a>.</p>
<p>To enable ZTPServer for an Apache server, we need to add the following WSGI configuration to the Apache config.  A good location might be to create <tt class="docutils literal"><span class="pre">/etc/httpd/conf.d/ztpserver.conf</span></tt> or /etc/apache2/sites-enabled/ztpserver.conf:</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="nb">LoadModule</span> wsgi_module modules/mod_wsgi.so
<span class="nb">Listen</span> <span class="m">8080</span>

<span class="nt">&lt;VirtualHost</span> <span class="s">*:8080</span><span class="nt">&gt;</span>

    <span class="nb">WSGIDaemonProcess</span> ztpserver <span class="k">user</span>=www-data <span class="k">group</span>=www-data threads=50
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/etc/ztpserver/ztpserver.wsgi</span>
    <span class="c"># Required for RHEL</span>
    <span class="c">#WSGISocketPrefix /var/run/wsgi</span>

    <span class="nt">&lt;Location</span> <span class="s">/</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> ztpserver
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}

        <span class="c"># For Apache &lt;= 2.2, use Order and Allow</span>
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
        <span class="c"># For Apache &gt;= 2.4, Allow is replaced by Require</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
    <span class="nt">&lt;/Location&gt;</span>

    <span class="c"># Override default logging locations for Apache</span>
    <span class="c">#ErrorLog /path/to/ztpserver_error.log</span>
    <span class="c">#CustomLog /path/to/ztpserver_access.log</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>WSGIScriptAlias should point to the ztpserver.wsgi file which is installed by default under /etc/ztpserver/ztpserver.wsgi. You will notice that the <tt class="docutils literal"><span class="pre">&lt;Location</span> <span class="pre">/&gt;</span></tt> directive is set to the root directory. This will enable ZTPServer to listen at the base server URL:</p>
<p><tt class="docutils literal"><span class="pre">http://&lt;host_ip&gt;:8080/bootstrap</span></tt></p>
<p>If you would like to run the ZTPServer under a subdirectory, leave the Apache configuration as it is listed above and modify the ZTPServer configuration to include the URL path prefix (<tt class="docutils literal"><span class="pre">/ztpserver</span></tt> in this example).</p>
<p>For example, edit the default configuration file found at <tt class="docutils literal"><span class="pre">/etc/ztpserver/ztpserver.conf</span></tt> by modifying or adding the following line under the [default] section:</p>
<p><tt class="docutils literal"><span class="pre">server_url</span> <span class="pre">=</span> <span class="pre">http://&lt;host_ip&gt;:8080/ztpserver/</span></tt></p>
<p>where /ztpserver/ is the subdirectory you would like the wsgi to listen. Once completed, restart Apache and you should now be able to access your ZTPServer at the specified URL.  To test, simply use curl - for example:</p>
<p><tt class="docutils literal"><span class="pre">curl</span> <span class="pre">http://&lt;host_ip&gt;:8080/ztpserver/bootstrap</span></tt></p>
<p>If everything is configured properly, curl should be able to retrieve the bootstrap script. If there is a problem, all of the ZTPServer log messages should be available under the Apache server error logs.   See the <tt class="docutils literal"><span class="pre">ErrorLog</span></tt> directive in your Apache configuration to determine the location of the error log.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">File Permissions - Apache mod_wsgi will run ztpserver.wsgi as the specified system user in your Apache config.  This use must be able to read/write to the files in <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt> (or whereever you created your data_root.)</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SELinux - Apache will need to read and write to files in <tt class="docutils literal"><span class="pre">/usr/share/ztpserver</span></tt>.  Therefore, you might need to update/assign an SELinux user/role/type to these files.  You can do something like <tt class="docutils literal"><span class="pre">chcon</span> <span class="pre">-R</span> <span class="pre">-h</span> <span class="pre">system_u:object_r:httpd_sys_script_rw_t</span> <span class="pre">/usr/share/ztpserver</span></tt> to accomplish that.</p>
</div>
</div>
<div class="section" id="standalone-debug-server">
<h2><a class="toc-backref" href="#id2">Standalone debug server</a><a class="headerlink" href="#standalone-debug-server" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ZTPServer ships with a single-threaded server that is sufficient for testing or demonstration, only.  It is not recommended for use with more than 10 nodes.</p>
</div>
<p>To start the standalone ZTPServer, exec the ztps binary:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">[root@ztpserver ztpserver]# ztps</span>
<span class="go">INFO: [app:115] Logging started for ztpserver</span>
<span class="go">INFO: [app:116] Using repository /usr/share/ztpserver</span>
<span class="go">Starting server on http://&lt;ip_address&gt;:&lt;port&gt;</span>
</pre></div>
</div>
<p>The following options may be specified when starting the ztps binary:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">-h, --help            show this help message and exit</span>
<span class="go">--version, -v         Displays the version information</span>
<span class="go">--conf CONF, -c CONF  Specifies the configuration file to use</span>
<span class="go">--validate-config, -V</span>
<span class="go">                      Validates config files</span>
<span class="go">--debug               Enables debug output to the STDOUT</span>
<span class="go">--clear-resources, -r</span>
<span class="go">                      Clears all resource files</span>
</pre></div>
</div>
<p>Assuming that the DHCP server is serving DHCP offers which include the path to the ZTPServer bootstrap script in Option 67 and that the EOS nodes can access the bootstrap file over the network, the provisioning process should now be able to automatically start for all the nodes with no startup configuration.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="config.html" class="btn btn-neutral float-right" title="Configuration"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral" title="Installation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>