

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; ZTPServer 1.3.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ZTPServer 1.3.2 documentation" href="index.html"/>
        <link rel="next" title="Examples" href="examples.html"/>
        <link rel="prev" title="Startup" href="startup.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> ZTPServer</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#ztp-intro">ZTP Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#server">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#ztp-client-server-message-flows">ZTP Client-Server Message Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#topology-validation">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#operational-modes">Operational modes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-options">Installation Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#additional-services">Additional services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="startup.html">Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="startup.html#apache-mod-wsgi">Apache (mod_wsgi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="startup.html#standalone-debug-server">Standalone debug server</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-overview">Static provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-startup-config">Static provisioning - startup_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-definition">Static provisioning - definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-attributes">Static provisioning - attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-pattern">Static provisioning - pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-config-handler">Static provisioning - config-handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-provisioning-log">Static provisioning - log</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-provisioning-overview">Dynamic provisioning - overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-provisioning-neighbordb">Dynamic provisioning - neighbordb</a></li>
<li class="toctree-l2"><a class="reference internal" href="#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plugins-for-allocating-resources">Plugins for allocating resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#config-handlers">Config-handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-files">Other files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#global-configuration-file">Global configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#dynamic-neighbordb-or-pattern-file">Dynamic neighbordb or pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#static-neighbordb-and-node-unique-id-pattern-file">Static neighbordb and /node/&lt;unique-id&gt;/pattern file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-dynamic-definition-file">Sample dynamic definition file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-templates">Sample templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-resources">Sample resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#neighbordb-pattern-examples">Neighbordb pattern examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#more-examples">More examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">ZTPServer Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/clientLogging.html">Client-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/serverLogging.html">Server-Side Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/configuration.html">ZTPServer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/runningZTPS.html">Running the ZTPServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/helloWorld.html">Hello World - A Simple Provisioning Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/staticNodes.html">Provision a Static Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/dynamicNodes.html">Provision a Dynamic Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/topologyValidation.html">Topology Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/definitions.html">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/resourcePools.html">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/puppet.html">Puppet Agent - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/ansible.html">Ansible - Bootstrap EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook/ztpsVMonEOS.html">Run ZTPServer as a VM on EOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips and tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-update-my-local-copy-of-ztpserver-from-github">How do I update my local copy of ZTPServer from GitHub?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#my-server-keeps-failing-to-load-my-resource-files-whats-going-on">My server keeps failing to load my resource files. What’s going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-validate-the-format-of-my-config-files">How do I validate the format of my config files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-debug-the-ztp-server-provisioning-process">How do I debug the ZTP Server provisioning process?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-disable-enable-ztp-mode-on-a-switch">How do I disable / enable ZTP mode on a switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-can-i-test-ztpserver-without-having-to-reboot-the-switch-every-time">How can I test ZTPServer without having to reboot the switch every time?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#what-is-the-recommended-test-environment-for-ztpserver">What is the recommended test environment for ZTPServer?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-override-the-default-system-mac-in-veos">How do I override the default system-mac in vEOS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#how-do-i-override-the-default-serial-number-or-system-mac-in-veos">How do I override the default serial number or system-mac in vEOS?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="implementation.html">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Client - Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="support.html#contact">Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#known-caveats">Known caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#releases">Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#roadmap-highlights">Roadmap highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#other-resources">Other Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#before-requesting-support">Before Requesting Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="license.html#third-party">Third party</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ZTPServer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Configuration</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/config.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#global-configuration-file" id="id2">Global configuration file</a></li>
<li><a class="reference internal" href="#bootstrap-configuration" id="id3">Bootstrap configuration</a></li>
<li><a class="reference internal" href="#static-provisioning-overview" id="id4">Static provisioning - overview</a></li>
<li><a class="reference internal" href="#static-provisioning-startup-config" id="id5">Static provisioning - startup_config</a></li>
<li><a class="reference internal" href="#static-provisioning-definition" id="id6">Static provisioning - definition</a></li>
<li><a class="reference internal" href="#static-provisioning-attributes" id="id7">Static provisioning - attributes</a></li>
<li><a class="reference internal" href="#static-provisioning-pattern" id="id8">Static provisioning - pattern</a></li>
<li><a class="reference internal" href="#static-provisioning-config-handler" id="id9">Static provisioning - config-handler</a></li>
<li><a class="reference internal" href="#static-provisioning-log" id="id10">Static provisioning - log</a></li>
<li><a class="reference internal" href="#dynamic-provisioning-overview" id="id11">Dynamic provisioning - overview</a></li>
<li><a class="reference internal" href="#dynamic-provisioning-neighbordb" id="id12">Dynamic provisioning - neighbordb</a><ul>
<li><a class="reference internal" href="#variables" id="id13">variables</a></li>
<li><a class="reference internal" href="#node-unique-id" id="id14">node: unique_id</a></li>
<li><a class="reference internal" href="#interfaces-port-name" id="id15">interfaces: port_name</a></li>
<li><a class="reference internal" href="#system-name-neighbor-port-name" id="id16">system_name:neighbor_port_name</a></li>
<li><a class="reference internal" href="#port-name-system-name-neighbor-port-name" id="id17">port_name: system_name:neighbor_port_name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#definitions" id="id18">Definitions</a></li>
<li><a class="reference internal" href="#actions" id="id19">Actions</a></li>
<li><a class="reference internal" href="#plugins-for-allocating-resources" id="id20">Plugins for allocating resources</a></li>
<li><a class="reference internal" href="#config-handlers" id="id21">Config-handlers</a></li>
<li><a class="reference internal" href="#other-files" id="id22">Other files</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The ZTPServer uses a series of YAML files to provide its various
configuration and databases. Use of the YAML format makes the files
easier to read and makes it easier and more intuitive to add/update
entries (as opposed to other files formats such as JSON, or binary
formats such as SQL).</p>
<p>The ZTPServer components are housed in a single directory defined by the <tt class="docutils literal"><span class="pre">data_root</span></tt> variable in the global configuration file. The directory location will vary depending on the configuration in <tt class="docutils literal"><span class="pre">/etc/ztpserver/ztperserver.conf</span></tt>.</p>
<p>The following directory structure is normally used:</p>
<div class="highlight-ini"><div class="highlight"><pre>[data_root]
    bootstrap/
        bootstrap
        bootstrap.conf
    nodes/
        &lt;unique_id)&gt;/
            startup-config
            definition
            pattern
            config-handler
            .node
            attributes
    actions/
    files/
    definitions/
    resources/
    neighbordb
</pre></div>
</div>
<p>All configuration files can be validated using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">bash</span><span class="p">)</span><span class="c"># ztps --validate</span>
</pre></div>
</div>
</div>
<div class="section" id="global-configuration-file">
<span id="global-configuration"></span><h2><a class="toc-backref" href="#id2">Global configuration file</a><a class="headerlink" href="#global-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The global ZTPServer configuration file can be found at <tt class="docutils literal"><span class="pre">/etc/ztpserver/ztpserver.conf</span></tt>. It uses the INI format (for details, see top section of <a class="reference external" href="https://docs.python.org/2/library/configparser.html">Python configparser</a>).</p>
<p>An alternative location for the global configuration file may be specified by using the <tt class="docutils literal"><span class="pre">--conf</span></tt> command line option:</p>
<p>e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>(bash)# ztps --help
usage: ztpserver [options]

optional arguments:
  -h, --help            show this help message and exit
  --version, -v         Displays the version information
  **--conf CONF, -c CONF  Specifies the configuration file to use**
  --validate-config, -V
                        Validates config files
  --debug               Enables debug output to the STDOUT
  --clear-resources, -r
                        Clears all resource files
(bash)# ztps --conf /var/ztps.conf
</pre></div>
</div>
<p>If the global configuration file is updated, the server must be restarted in order to pick up the new configuration.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[default]</span>

<span class="c1"># Location of all ztps boostrap process data files</span>
<span class="c1"># default= /usr/share/ztpserver</span>
<span class="na">data_root</span><span class="o">=</span><span class="s">&lt;PATH&gt;</span>

<span class="c1"># UID used in the /nodes structure</span>
<span class="c1"># default=serialnum</span>
<span class="na">identifier</span><span class="o">=</span><span class="s">&lt;serialnum | systemmac&gt;</span>

<span class="c1"># Server URL to-be-advertised to clients (via POST replies) during the bootstrap process</span>
<span class="c1"># default=http://ztpserver:8080</span>
<span class="na">server_url</span><span class="o">=</span><span class="s">&lt;URL&gt;</span>

<span class="c1"># Enable local logging</span>
<span class="c1"># default=True</span>
<span class="na">logging</span><span class="o">=</span><span class="s">&lt;True | False&gt;</span>

<span class="c1"># Enable console logging</span>
<span class="c1"># default=True</span>
<span class="na">console_logging</span><span class="o">=</span><span class="s">&lt;True | False&gt;</span>

<span class="c1"># Console logging format</span>
<span class="c1"># default=%(asctime)-15s:%(levelname)s:[%(module)s:%(lineno)d] %(message)s</span>
<span class="na">console_logging_format</span><span class="o">=</span><span class="s">&lt;(Python)logging format&gt;</span>

<span class="c1"># Globally disable topology validation in the bootstrap process</span>
<span class="c1"># default=False</span>
<span class="na">disable_topology_validation</span><span class="o">=</span><span class="s">&lt;True | False&gt;</span>

<span class="k">[server]</span>
<span class="c1"># Note: this section only applies to using the standalone server.  If</span>
<span class="c1"># running under a WSGI server, these values are ignored</span>

<span class="c1"># Interface to which the server will bind to (0:0:0:0 will bind to</span>
<span class="c1"># all available IPv4 addresses on the local machine)</span>
<span class="c1"># default=0.0.0.0</span>
<span class="na">interface</span><span class="o">=</span><span class="s">&lt;IP addr&gt;</span>

<span class="c1"># TCP listening port</span>
<span class="c1"># default=8080</span>
<span class="na">port</span><span class="o">=</span><span class="s">&lt;TCP port&gt;</span>

<span class="k">[bootstrap]</span>
<span class="c1"># Bootstrap filename (file located in &lt;data_root&gt;/bootstrap)</span>
<span class="c1"># default=bootstrap</span>
<span class="na">filename</span><span class="o">=</span><span class="s">&lt;name&gt;</span>

<span class="k">[neighbordb]</span>
<span class="c1"># Neighbordb filename (file located in &lt;data_root&gt;)</span>
<span class="c1"># default=neighbordb</span>
<span class="na">filename</span><span class="o">=</span><span class="s">&lt;name&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Configuration values may be overridden by setting environment variables, if the configuration attribute supports it. This is mainly used for testing and should not be used in production deployments.</p>
</div>
<p>Configuration values that support environment overrides use the <tt class="docutils literal"><span class="pre">environ</span></tt> keyword, as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">runtime</span><span class="o">.</span><span class="n">add_attribute</span><span class="p">(</span><span class="n">StrAttr</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;data_root&#39;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s">&#39;/usr/share/ztpserver&#39;</span><span class="p">,</span>
    <span class="n">environ</span><span class="o">=</span><span class="s">&#39;ZTPS_DEFAULT_DATAROOT&#39;</span>
<span class="p">))</span>
</pre></div>
</div>
<p>In the above example, the <tt class="docutils literal"><span class="pre">data_root</span></tt> value is normally configured in the [default] section as <tt class="docutils literal"><span class="pre">data_root</span></tt>; however, if the environment variable <tt class="docutils literal"><span class="pre">ZTPS_DEFAULT_DATAROOT</span></tt> is defined, it will take precedence.</p>
</div>
<div class="section" id="bootstrap-configuration">
<span id="bootstrap-config"></span><h2><a class="toc-backref" href="#id3">Bootstrap configuration</a><a class="headerlink" href="#bootstrap-configuration" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">[data_root]/bootstrap/</span></tt> contains files that control the bootstrap process of a node.</p>
<ul>
<li><p class="first"><strong>bootstrap</strong> is the base bootstrap script which is going to be served to all clients in order to control the bootstrap process. Before serving the script to the clients, the server replaces any references to $SERVER with the value of <tt class="docutils literal"><span class="pre">server_url</span></tt> in the global configuration file.</p>
</li>
<li><p class="first"><strong>bootstrap.conf</strong> is a configuration file which defines the local logging configuration on the nodes (during the bootstrap process). The file is loaded on on-demand.</p>
<p>e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">destination</span><span class="p-Indicator">:</span> <span class="s">&quot;ztps.ztps-test.com:514&quot;</span>
    <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DEBUG</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">destination</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">file:/tmp/ztps-log</span>
    <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DEBUG</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">destination</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ztps-server:1234</span>
    <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CRITICAL</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">destination</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10.0.1.1:9000</span>
    <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CRITICAL</span>
<span class="l-Scalar-Plain">xmpp</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">domain</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">im.ztps-test.com</span>
  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bootstrap</span>
  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">eosplus</span>
  <span class="l-Scalar-Plain">rooms</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ztps</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ztps-room2</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order for XMPP logging to work, a non-EOS user need to be connected to the room specified in bootstrap.conf, before the ZTP process starts. The room has to be created (by the non-EOS user) before the bootstrap client starts logging the ZTP process via XMPP.</p>
</div>
</div>
<div class="section" id="static-provisioning-overview">
<span id="static-provisioning"></span><h2><a class="toc-backref" href="#id4">Static provisioning - overview</a><a class="headerlink" href="#static-provisioning-overview" title="Permalink to this headline">¶</a></h2>
<p>A node can be statically configured on the server as follows:</p>
<ul class="simple">
<li>create a new directory under <tt class="docutils literal"><span class="pre">[data_root]/nodes</span></tt>, using the system&#8217;s unique_id as the name</li>
<li>create/symlink a <em>startup-config</em> or <em>definition</em> file in the newly-created folder</li>
<li>if topology validation is enabled, also create/symlink a <em>pattern</em> file</li>
<li>optionally, create <em>config-handler</em> script which is run whenever a PUT startup-config request succeeds</li>
</ul>
</div>
<div class="section" id="static-provisioning-startup-config">
<h2><a class="toc-backref" href="#id5">Static provisioning - startup_config</a><a class="headerlink" href="#static-provisioning-startup-config" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">startup-config</span></tt> provides a static startup-configuration for the node. If this file is present in a node’s folder, when the node sends a GET request to <tt class="docutils literal"><span class="pre">/nodes/&lt;unique_id&gt;</span></tt>, the server will respond with a static definition that includes:</p>
<ul class="simple">
<li>a <strong>replace_config</strong> action which will install the configuration file on the switch (see <a class="reference external" href="#actions">actions</a> section below for more on this). This action will be placed <strong>first</strong> in the definition.</li>
<li>all the <strong>actions</strong> from the local <strong>definition</strong> file (see definition section below for more on this) which have the <tt class="docutils literal"><span class="pre">always_execute</span></tt> attribute set to <tt class="docutils literal"><span class="pre">True</span></tt></li>
</ul>
</div>
<div class="section" id="static-provisioning-definition">
<span id="definition"></span><h2><a class="toc-backref" href="#id6">Static provisioning - definition</a><a class="headerlink" href="#static-provisioning-definition" title="Permalink to this headline">¶</a></h2>
<p>The <strong>definition</strong> file contains the set of actions which are going to be
performed during the bootstrap process for a node. The definition file
can be either: <strong>manually created</strong> OR <strong>auto-generated by the server</strong>
when the node matches one of the patterns in <strong>neighbordb</strong> (in this case the
definition file is generated based on the definition file associated
with the matching pattern in <strong>neighbordb</strong>).</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;system name&gt;</span>

<span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;action name&gt;</span>

    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>                     <span class="c1"># attributes at action scope</span>
        <span class="l-Scalar-Plain">always_execute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>        <span class="c1"># optional, default False</span>
        <span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
        <span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>

    <span class="l-Scalar-Plain">onstart</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;msg&gt;</span>                <span class="c1"># message to log before action is executed</span>
    <span class="l-Scalar-Plain">onsuccess</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;msg&gt;</span>                <span class="c1"># message to log if action execution succeeds</span>
    <span class="l-Scalar-Plain">onfailure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;msg&gt;</span>                <span class="c1"># message to log if action execution fails</span>
  <span class="l-Scalar-Plain">...</span>

<span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>                         <span class="c1"># attributes at global scope</span>
    <span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
    <span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
    <span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="static-provisioning-attributes">
<h2><a class="toc-backref" href="#id7">Static provisioning - attributes</a><a class="headerlink" href="#static-provisioning-attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes are either key/value pairs, key/dictionary pairs, key/list pairs or key/reference pairs. They are all sent to the client in order to be passed in as arguments to actions.</p>
<p>Here are a few examples:</p>
<ul>
<li><p class="first">key/value:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_attribute</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my_value</span>
</pre></div>
</div>
</li>
<li><p class="first">key/dictionary</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_dict_attribute</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">key1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">value1</span>
        <span class="l-Scalar-Plain">key2</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
<li><p class="first">key/list:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">list_name</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">my_value1</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">my_value2</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">my_valueN</span>
</pre></div>
</div>
</li>
<li><p class="first">key/reference:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_attribute</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$my_other_attribute</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>key/reference</strong> attributes are identified by the fact that the value starts with the ‘$’ sign, followed by the name of another attribute. They are evaluated before being sent to the client.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_other_attribute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dummy</span>
    <span class="l-Scalar-Plain">my_attribute</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$my_other_attribute</span>
</pre></div>
</div>
<p>will be evaluated to:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_other_attribute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dummy</span>
    <span class="l-Scalar-Plain">my_attribute</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dummy</span>
</pre></div>
</div>
</div></blockquote>
<p>If a reference points to a non-existing attribute, then the variable
substitution will result in a value of <em>None</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only <strong>one level of indirection</strong> is
allowed - if multiple levels of indirection are used, then the data
sent to the client will contain unevaluated key/reference pairs in
the attributes list (which might lead to failures or unexpected
results in the client).</p>
</div>
<p>The values of the attributes can be either strings, numbers, lists, dictionaries, or references to other attributes or plugin references for allocating resources.</p>
<p>Plugins can be used to allocate resources on the server side and then pass the result of the allocation back to the client via the definition. The supported plugins are:</p>
<ul class="simple">
<li><strong>allocate(resource_pool)</strong> - allocates an available resource from a file-based resource pool</li>
<li><strong>sqlite(resource_pool)</strong> - allocates an available resource from a sqlite database</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Plugins can only be referenced with strings as arguments,
currently. See section on <a class="reference external" href="#actions">add_config</a> action for
examples.</p>
</div>
<p>Attributes can be defined in three places:</p>
<blockquote>
<div><ul class="simple">
<li>in the definition, at action scope</li>
<li>in the definition, at global scope</li>
<li>in the node’s attributes file (see below)</li>
</ul>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">attributes</span></tt> is a file which can be used in order to store attributes
associated with the node’s definition. This is especially useful
whenever multiple nodes share the same definition - in that case,
instead of having to edit each node’s definition in order to add the
attributes (at the global or action scope), all nodes can share the same
definition (which might be symlinked to their individual node folder)
and the user only has to create the attributes file for each node. The
<tt class="docutils literal"><span class="pre">attributes</span></tt> file should be a valid key/value YAML file.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
<span class="l-Scalar-Plain">&lt;key&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;value&gt;</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>For key/value, key/list and and key/reference attributes, in case of
conflicts between the three scopes, the following order of precidence rules are
applied to determine the final value to send to the client:</p>
<blockquote>
<div><ol class="arabic simple">
<li>action scope in the definition takes precedence</li>
<li>attributes file comes next</li>
<li>global scope in the definition comes last</li>
</ol>
</div></blockquote>
<p>For key/dict attributes, in case of conflicts between the scopes, the
dictionaries are merged. In the event of dictionary key conflicts, the same
precidence rules from above apply.</p>
</div>
<div class="section" id="static-provisioning-pattern">
<h2><a class="toc-backref" href="#id8">Static provisioning - pattern</a><a class="headerlink" href="#static-provisioning-pattern" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">pattern</span></tt> file a way to validate the node&#8217;s topology during the bootstrap process (if topology validation is enabled). The pattern file can be either:</p>
<blockquote>
<div><ul class="simple">
<li>manually created</li>
<li>auto-generated by the server, when the node matches one of the patterns in <tt class="docutils literal"><span class="pre">neighbordb</span></tt> (the pattern that is matched in <tt class="docutils literal"><span class="pre">neighbordb</span></tt> is, then, written to this file and used for topology validation in subsequent re-runs of the bootstrap process)</li>
</ul>
</div></blockquote>
<p>The format of a pattern is very similar to the format of <tt class="docutils literal"><span class="pre">neighordb</span></tt>
(see <a class="reference external" href="#neighbordb">neighbordb</a> section below):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">&lt;variable_name&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;function&gt;</span>
<span class="nn">...</span>

<span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;single line description of pattern&gt;</span>               <span class="c1"># optional</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;port_name&gt;:&lt;system_name&gt;:&lt;neighbor_port_name&gt;</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;port_name&gt;</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">device</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;system_name&gt;</span>
        <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;neighbor_port_name&gt;</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>If the pattern file is missing when the node makes a GET request for its definition, the server will log a message and return either:</p>
<blockquote>
<div><ul class="simple">
<li>400 (BAD_REQUEST) if topology validation is enabled</li>
<li>200 (OK) if topology validation is disabled</li>
</ul>
</div></blockquote>
<p>If topology validation is enabled globally, the following patterns can be used in order to disable it for a particular node:</p>
<blockquote>
<div><ul class="simple">
<li>match <strong>any</strong> node which has at least one LLDP-capable neighbor:</li>
</ul>
</div></blockquote>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;pattern name&gt;</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">any</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">any:any</span>
</pre></div>
</div>
<p>OR</p>
<blockquote>
<div><ul class="simple">
<li>match <strong>any</strong> node which has no LLDP-capable neighbors:</li>
</ul>
</div></blockquote>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;pattern name&gt;</span>
<span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">none</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">none:none</span>
</pre></div>
</div>
</div>
<div class="section" id="static-provisioning-config-handler">
<h2><a class="toc-backref" href="#id9">Static provisioning - config-handler</a><a class="headerlink" href="#static-provisioning-config-handler" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">config-handler</span></tt> file can be any script which can be executed
on the server. The script will be executed every time a PUT startup-config
request succeeds for the node.</p>
<p>The script can be used for raising alarms, performing checks, submitting
the startup-config file to a revision control system, etc.</p>
</div>
<div class="section" id="static-provisioning-log">
<h2><a class="toc-backref" href="#id10">Static provisioning - log</a><a class="headerlink" href="#static-provisioning-log" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">.node</span></tt> file contains a cached copy of the node’s details that were
received during the POST request the node makes to <tt class="docutils literal"><span class="pre">/nodes</span> <span class="pre">(URI)</span></tt>.
This cache is used to validate the node’s neighbors against the
<tt class="docutils literal"><span class="pre">pattern</span></tt> file, if topology validation is enabled (during the GET
request the node makes in order to retrieve its definition).</p>
<p>The <tt class="docutils literal"><span class="pre">.node</span></tt> is created automatically by the server and should not be edited manually.</p>
<p>Example .node file:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span><span class="nt">&quot;neighbors&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;Management1&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;ztps.ztps-test.com&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;0050.569b.9ba5&quot;</span><span class="p">}</span>
                              <span class="p">],</span>
               <span class="nt">&quot;Ethernet2&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;veos-dc1-pod1-spine1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;0050.569a.9321&quot;</span><span class="p">}</span>
                            <span class="p">]</span>
              <span class="p">},</span>
 <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;vEOS&quot;</span><span class="p">,</span>
 <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;4.13.7M&quot;</span><span class="p">,</span>
 <span class="nt">&quot;systemmac&quot;</span><span class="p">:</span> <span class="s2">&quot;005056b863ac&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-provisioning-overview">
<span id="dynamic-provisioning"></span><h2><a class="toc-backref" href="#id11">Dynamic provisioning - overview</a><a class="headerlink" href="#dynamic-provisioning-overview" title="Permalink to this headline">¶</a></h2>
<p>A node can be dynamically provisioned by creating a matching <tt class="docutils literal"><span class="pre">neighbordb</span></tt> (<tt class="docutils literal"><span class="pre">[data_root]/neighbordb</span></tt>) entry which maps to a definition. The entry can potentially match multiple nodes.
The associated definition should be created in [data_root]/definitions/.</p>
</div>
<div class="section" id="dynamic-provisioning-neighbordb">
<span id="neighbordb"></span><h2><a class="toc-backref" href="#id12">Dynamic provisioning - neighbordb</a><a class="headerlink" href="#dynamic-provisioning-neighbordb" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">neighbordb</span></tt> YAML file defines mappings between patterns
and definitions. If a node is not already configured via a static entry,
then the node’s topology details are attempted to be matched against
the patterns in <tt class="docutils literal"><span class="pre">neighbordb</span></tt>. If a match is successful, then a node
definition will be automatically generated for the node (based on the
mapping in neighbordb).</p>
<p>There are 2 types of patterns supported in neighbordb:
node-specific (containing the <strong>node</strong> attribute, which refers to the
unique_id of the node) and global patterns.</p>
<p>Rules:</p>
<blockquote>
<div><ul class="simple">
<li>if multiple node-specific entries reference the same unique_id, only the first will be in effect - all others will be ignored</li>
<li>if both the <strong>node</strong> and <strong>interfaces</strong> attributes are specified and a node&#8217;s unique_id is a match, but the topology information is not, then the overall match will fail and the global patterns will not be considered</li>
<li>if there is no matching node-specific pattern for a node&#8217;s unique_id, then the server will attempt to match the node against the global patterns (in the order they are specified in <tt class="docutils literal"><span class="pre">neighbordb</span></tt>)</li>
<li>if a node-specific pattern matches, the server will automatically generate an open pattern in the node&#8217;s folder. This pattern will match any device with at least one LLDP-capable neighbor.  Example: <tt class="docutils literal"><span class="pre">any:</span> <span class="pre">any:any</span></tt></li>
</ul>
</div></blockquote>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">variable_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">function</span>
<span class="nn">...</span>
<span class="l-Scalar-Plain">patterns</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;single line description of pattern&gt;</span>
      <span class="l-Scalar-Plain">definition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;defintion_url&gt;</span>
      <span class="l-Scalar-Plain">node</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;unique_id&gt;</span>
      <span class="l-Scalar-Plain">config-handler</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;config-handler&gt;</span>
      <span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">&lt;variable_name&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;function&gt;</span>
      <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;port_name&gt;</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;system_name&gt;:&lt;neighbor_port_name&gt;</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;port_name&gt;</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">device</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;system_name&gt;</span>
            <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;neighbor_port_name&gt;</span>
<span class="nn">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Mandatory attributes: <strong>name</strong>, <strong>definition</strong>, and either <strong>node</strong>, <strong>interfaces</strong> or both.</p>
<p class="last">Optional attributes: <strong>variables</strong>, <strong>config-handler</strong>.</p>
</div>
<div class="section" id="variables">
<h3><a class="toc-backref" href="#id13">variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>The variables can be used to match the remote device and/or port name (<tt class="docutils literal"><span class="pre">&lt;system_name&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;neighbor_port_name&gt;</span></tt> above) for a neighbor. The supported values are:</p>
<dl class="docutils">
<dt><strong>string</strong></dt>
<dd>same as exact(string) from below</dd>
<dt>exact (pattern)</dt>
<dd>defines a pattern that must be matched exactly (Note: this is the default function if another function is not specified)</dd>
<dt>regex (pattern)</dt>
<dd>defines a regex pattern to match the node name against</dd>
<dt>includes (string)</dt>
<dd>defines a string that must be present in system/port name</dd>
<dt>excludes (string)</dt>
<dd>defines a string that must not be present in system/port name</dd>
</dl>
</div>
<div class="section" id="node-unique-id">
<h3><a class="toc-backref" href="#id14">node: unique_id</a><a class="headerlink" href="#node-unique-id" title="Permalink to this headline">¶</a></h3>
<p>Serial number or MAC address, depending on the global &#8216;identifier&#8217; attribute in <strong>ztpserver.conf</strong>.</p>
</div>
<div class="section" id="interfaces-port-name">
<h3><a class="toc-backref" href="#id15">interfaces: port_name</a><a class="headerlink" href="#interfaces-port-name" title="Permalink to this headline">¶</a></h3>
<p>Local interface name - supported values:</p>
<ul class="simple">
<li><strong>Any interface</strong><ul>
<li>any</li>
</ul>
</li>
<li><strong>No interface</strong><ul>
<li>none</li>
</ul>
</li>
<li><strong>Explicit interface</strong><ul>
<li>Ethernet1</li>
<li>Ethernet2/4</li>
<li>Management1</li>
</ul>
</li>
<li><strong>Interface list/range</strong><ul>
<li>Ethernet1-2</li>
<li>Ethernet1,3</li>
<li>Ethernet1-2,3/4</li>
<li>Ethernet1-2,4</li>
<li>Ethernet1-2,4,6</li>
<li>Ethernet1-2,4,6,8-9</li>
<li>Ethernet4,6,8-9</li>
<li>Ethernet10-20</li>
<li>Ethernet1/3-2/4 *</li>
<li>Ethernet3-$ *</li>
<li>Ethernet1/10-$ *</li>
</ul>
</li>
<li><strong>All Interfaces on a Module</strong><ul>
<li>Ethernet1/$ *</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">* Planned for future releases.</p>
</div>
</div>
<div class="section" id="system-name-neighbor-port-name">
<h3><a class="toc-backref" href="#id16">system_name:neighbor_port_name</a><a class="headerlink" href="#system-name-neighbor-port-name" title="Permalink to this headline">¶</a></h3>
<p>Remote system and interface name - supported values (STRING = any string
which does not contain any white spaces):</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">any</span></tt>: interface is connected</li>
<li><tt class="docutils literal"><span class="pre">none</span></tt>: interface is NOT connected</li>
<li><tt class="docutils literal"><span class="pre">&lt;STRING&gt;:&lt;STRING&gt;</span></tt>: interface is connected to specific
device/interface</li>
<li><tt class="docutils literal"><span class="pre">&lt;STRING&gt;</span></tt> (Note: if only the device is configured, then ‘any’ is
implied for the interface. This is equal to <tt class="docutils literal"><span class="pre">&lt;DEVICE&gt;:any</span></tt>):
interface is connected to device</li>
<li><tt class="docutils literal"><span class="pre">&lt;DEVICE&gt;:any</span></tt>: interface is connected to device</li>
<li><tt class="docutils literal"><span class="pre">&lt;DEVICE&gt;:none</span></tt>: interface is NOT connected to device (might be
connected or not to some other device)</li>
<li><tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;:&lt;STRING&gt;</span></tt>: interface is connected to specific
device/interface</li>
<li><tt class="docutils literal"><span class="pre">&lt;STRING&gt;:&lt;$VARIABLE&gt;</span></tt>: interface is connected to specific
device/interface</li>
<li><tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;:&lt;$VARIABLE&gt;</span></tt>: interface is connected to specific
device/interface</li>
<li><tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;</span></tt> (‘any’ is implied for the interface. This is equal to
<tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;:any</span></tt>): interface is connected to device</li>
<li><tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;:any</span></tt>: interface is connected to device</li>
<li><tt class="docutils literal"><span class="pre">$&lt;VARIABLE&gt;:none</span></tt>: interface is NOT connected to device (might be
connected or not to some other device)</li>
</ul>
</div>
<div class="section" id="port-name-system-name-neighbor-port-name">
<h3><a class="toc-backref" href="#id17">port_name: system_name:neighbor_port_name</a><a class="headerlink" href="#port-name-system-name-neighbor-port-name" title="Permalink to this headline">¶</a></h3>
<p>Negative constraints</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">DEVICE:none</span></tt>: no port is connected to DEVICE</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">DEVICE:any</span></tt>: same as above</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">DEVICE:none</span></tt>: same as above</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">any:PORT</span></tt>: no device is connected to PORT on any device</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">DEVICE:PORT</span></tt>: no device is connected to DEVICE:PORT</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">any:none</span></tt>: interfaces not connected</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">none:any</span></tt>: same as above</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">none:none</span></tt>: same as above</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">none:PORT</span></tt>: interfaces not connected to PORT on any
device</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">DEVICE:none</span></tt>: interfaces not connected to DEVICE</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">any:none</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">none:none</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">none:any</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">none:PORT</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">any:any</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">any:none</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">none:any</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">none:none</span></tt>: bogus, will prevent pattern from matching
anything</li>
<li><tt class="docutils literal"><span class="pre">none:</span> <span class="pre">none:PORT</span></tt>: bogus, will prevent pattern from matching
anything</li>
</ol>
<p>Positive constraints</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">any:any</span></tt>: &#8220;Open pattern&#8221; matches anything</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">any:PORT</span></tt>: matches any interface connected to any device’s
PORT</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">DEVICE:any</span></tt>: matches any interface connected to DEVICE</li>
<li><tt class="docutils literal"><span class="pre">any:</span> <span class="pre">DEVICE:PORT</span></tt>: matches any interface connected to DEVICE:PORT</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">any:any</span></tt>: matches if local interfaces is one of
INTERFACES</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">any:PORT</span></tt>: matches if one of INTERFACES is connected
to any device’s PORT</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">DEVICE:any</span></tt>: matches if one of INTERFACES is connected
to DEVICE</li>
<li><tt class="docutils literal"><span class="pre">INTERFACES:</span> <span class="pre">DEVICE:PORT</span></tt>: matches if one of INTERFACES is
connected to DEVICE:PORT</li>
</ol>
</div>
</div>
<div class="section" id="definitions">
<h2><a class="toc-backref" href="#id18">Definitions</a><a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">[data_root]/definitions/</span></tt> contains a set of shared definition files
which can be associated with patterns in <tt class="docutils literal"><span class="pre">neighbordb</span></tt> (see the <a class="reference internal" href="#neighbordb"><em>Dynamic provisioning - neighbordb</em></a>
section below) or added to/symlink-ed from nodes’ folders.</p>
<p>See <a class="reference internal" href="#definition"><em>Static provisioning - definition</em></a> for more.</p>
</div>
<div class="section" id="actions">
<h2><a class="toc-backref" href="#id19">Actions</a><a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">[data_root]/actions/</span></tt> contains the set of all actions available for use in
definitions.</p>
<p>New custom actions to-be referenced from definitions can be added to
<tt class="docutils literal"><span class="pre">[data_root]/actions/</span></tt>. These will be loaded on-demand and do not require
a restart of the ZTPServer. See <tt class="docutils literal"><span class="pre">[data_root]/actions</span></tt> for examples.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="47%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Description</th>
<th class="head">Required Attributes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="xref py py-mod docutils literal"><span class="pre">add_config</span></tt></td>
<td>Adds a block of configuration to the final startup-config
file</td>
<td>url</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-mod docutils literal"><span class="pre">copy_file</span></tt></td>
<td>Copies a file from the server to the destination node</td>
<td>src_url, dst_url, overwrite, mode</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-mod docutils literal"><span class="pre">install_cli_plugin</span></tt></td>
<td>Installs a new EOS CLI plugin and configures rc.eos</td>
<td>url</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-mod docutils literal"><span class="pre">install_extension</span></tt></td>
<td>Installs a new EOS extension</td>
<td>extension_url, autoload, force</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-mod docutils literal"><span class="pre">install_image</span></tt></td>
<td>Validates and installs a specific version of EOS</td>
<td>url, version</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-mod docutils literal"><span class="pre">replace_config</span></tt></td>
<td>Sends an entire startup-config to the node (overrides
(overrides add_config)</td>
<td>url</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-mod docutils literal"><span class="pre">send_email</span></tt></td>
<td>Sends an email to a set of recipients routed
through a relay host. Can include file attachments</td>
<td>smarthost, sender, receivers, subject,
body, attachments, commands</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-mod docutils literal"><span class="pre">run_bash_script</span></tt></td>
<td>Run bash script during bootstrap.</td>
<td>url</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-mod docutils literal"><span class="pre">run_cli_commands</span></tt></td>
<td>Run CLI commands during bootstrap.</td>
<td>url</td>
</tr>
</tbody>
</table>
<p>Additional details on each action are available in the <a class="reference internal" href="actions.html"><em>Actions</em></a> module docs.</p>
<p>e.g.</p>
<p>Assume that we have a block of configuration that adds a list of
NTP servers to the startup configuration. The action would be
constructed as such:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure NTP</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">add_config</span>
      <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/files/templates/ntp.template</span>
</pre></div>
</div>
<p>The above action would reference the <tt class="docutils literal"><span class="pre">ntp.template</span></tt> file which would contain configuration commands to
configure NTP. The template file could look like the following:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">ntp server 0.north-america.pool.ntp.org</span>
<span class="go">ntp server 1.north-america.pool.ntp.org</span>
<span class="go">ntp server 2.north-america.pool.ntp.org</span>
<span class="go">ntp server 3.north-america.pool.ntp.org</span>
</pre></div>
</div>
<p>When this action is called, the configuration snippet above will be
appended to the <tt class="docutils literal"><span class="pre">startup-config</span></tt> file.</p>
<p>The configuration templates can also contains <strong>variables</strong>, which are
automatically substituted during the action’s execution. A variable is
marked in the template via the &#8216;$&#8217; symbol.</p>
<p>e.g.
Let’s assume a need for a more generalized template that only needs
node specific values changed (such as a hostname and management IP
address). In this case, we’ll build an action that allows for <strong>variable
substitution</strong> as follows.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure system</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">add_config</span>
      <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/files/templates/system.template</span>
        <span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">hostname</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">veos01</span>
            <span class="l-Scalar-Plain">ipaddress</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">192.168.1.16/24</span>
</pre></div>
</div>
<p>The corresponding template file <tt class="docutils literal"><span class="pre">system.template</span></tt> will provide the
configuration block:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">hostname $hostname</span>
<span class="l-Scalar-Plain">!</span>
<span class="l-Scalar-Plain">interface Management1</span>
    <span class="l-Scalar-Plain">description OOB interface</span>
    <span class="l-Scalar-Plain">ip address $ipaddress</span>
    <span class="l-Scalar-Plain">no shutdown</span>
</pre></div>
</div>
<p>This will result in the following configuration being added to the
<tt class="docutils literal"><span class="pre">startup-config</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">hostname veos01</span>
<span class="go">!</span>
<span class="go">interface Management1</span>
<span class="go">    description OOB interface</span>
<span class="go">    ip address 192.168.1.16/24</span>
<span class="go">    no shutdown</span>
</pre></div>
</div>
<p>Note that in each of the examples, above, the template files are
just standard EOS configuration blocks.</p>
</div>
<div class="section" id="plugins-for-allocating-resources">
<h2><a class="toc-backref" href="#id20">Plugins for allocating resources</a><a class="headerlink" href="#plugins-for-allocating-resources" title="Permalink to this headline">¶</a></h2>
<p>Plugins for allocating resources from resource pools
are located in <tt class="docutils literal"><span class="pre">[data_root]/plugins/</span></tt> and are referenced
by <tt class="docutils literal"><span class="pre">&lt;filename&gt;(&lt;resource_pool&gt;)</span></tt>.</p>
<p>Each plugin contains a <tt class="docutils literal"><span class="pre">main</span></tt> function with the following signature:</p>
<blockquote>
<div><dl class="docutils">
<dt>def main(node_id, pool):</dt>
<dd>...</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>where:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">node_id</span></tt> is the unique_id of the node being provisioned</li>
<li><tt class="docutils literal"><span class="pre">pool</span></tt> is the name of the resource pool from which an attribute is being allocated</li>
</ul>
</dd>
</dl>
<p>New custom plugins to-be referenced from definitions can be added to
<tt class="docutils literal"><span class="pre">[data_root]/plugins/</span></tt>. These will be loaded on-demand and do not require
a restart of the ZTPServer. See <tt class="docutils literal"><span class="pre">[data_root]/plugins/test</span></tt> for a very basic
example.</p>
<p><strong>allocate(resource_pool)</strong></p>
<p><tt class="docutils literal"><span class="pre">[data_root]/resources/</span></tt> contains global resource pools from which
attributes in definitions can be allocated.</p>
<p>The resource pools provide a way to dynamically allocate a resource to a
node when the node definition is created. The resource pools are
key/value YAML files that contain a set of resources to be allocated to
a node.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;value1&gt;: &lt;&quot;null&quot;|node_identifier&gt;</span>
<span class="go">&lt;value2&gt;: &lt;&quot;null&quot;|node_identifier&gt;</span>
</pre></div>
</div>
<p>In the example below, a resource pool contains a series of 8 IP
addresses to be allocated. Entries which are not yet allocated to a node
are marked using the <tt class="docutils literal"><span class="pre">null</span></tt> descriptor.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">192.168.1.1/24: null</span>
<span class="go">192.168.1.2/24: null</span>
<span class="go">192.168.1.3/24: null</span>
<span class="go">192.168.1.4/24: null</span>
<span class="go">192.168.1.5/24: null</span>
<span class="go">192.168.1.6/24: null</span>
<span class="go">192.168.1.7/24: null</span>
<span class="go">192.168.1.8/24: null</span>
</pre></div>
</div>
<p>When a resource is allocated to a node’s definition, the first available
null value will be replaced by the node’s unique_id. Here is an
example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">192.168.1.1/24: 001c731a2b3c</span>
<span class="go">192.168.1.2/24: null</span>
<span class="go">192.168.1.3/24: null</span>
<span class="go">192.168.1.4/24: null</span>
<span class="go">192.168.1.5/24: null</span>
<span class="go">192.168.1.6/24: null</span>
<span class="go">192.168.1.7/24: null</span>
<span class="go">192.168.1.8/24: null</span>
</pre></div>
</div>
<p>On subsequent attempts to allocate the resource to the same node, ZTPS
will first check to see whether the node has already been allocated a
resource from the pool. If it has, it will reuse the resource instead of
allocating a new one.</p>
<p>In order to free a resource from a pool, simply turn the value
associated to it back to <tt class="docutils literal"><span class="pre">null</span></tt>, by editing the resource file.</p>
<p>Alternatively, <tt class="docutils literal"><span class="pre">$ztps</span> <span class="pre">--clear-resources</span></tt> can be used in order to free
all resources in all file-based resource files.</p>
<p><strong>sqlite(resource_pool)</strong></p>
<p>Allocates a resource from a pre-filled sqlite database. The database
is defined by the global variable, &#8216;DB_URL&#8217; within the plugin. The database
can include multiple tables, but the value passed into the
&#8216;sqlite(resource_pool)&#8217; function will be used to look for an available resource.</p>
<p>Table structure should be as follows with the exact column names:</p>
<table border="1" class="docutils">
<colgroup>
<col width="65%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">node_id</th>
<th class="head">key</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NULL</td>
<td>1.1.1.1</td>
</tr>
<tr class="row-odd"><td>NULL</td>
<td>1.1.1.2</td>
</tr>
<tr class="row-even"><td>NULL</td>
<td>1.1.1.3</td>
</tr>
</tbody>
</table>
<p>Which can be created with statements like:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">`mgmt_subnet`</span><span class="p">(</span><span class="k">key</span> <span class="kt">TEXT</span><span class="p">,</span> <span class="n">node_id</span> <span class="kt">TEXT</span><span class="p">)</span>
</pre></div>
</div>
<p>and add entries with:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">`mgmt_subnet`</span> <span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1.1.1.1&#39;</span><span class="p">,</span> <span class="no">NULL</span><span class="p">)</span>
</pre></div>
</div>
<p>When a resource is added, the node_id row will be updated
to include the System ID from the switch.</p>
<table border="1" class="docutils">
<colgroup>
<col width="65%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">node_id</th>
<th class="head">key</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>001122334455</td>
<td>1.1.1.1</td>
</tr>
<tr class="row-odd"><td>NULL</td>
<td>1.1.1.2</td>
</tr>
<tr class="row-even"><td>NULL</td>
<td>1.1.1.3</td>
</tr>
</tbody>
</table>
<p>On subsequent attempts to allocate the resource to the same node,
ztpserver will first check to see whether the node has already been
allocated a resource from the pool. If it has, it will reuse the
resource instead of allocating a new one.</p>
<p>Definition example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">actions</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span>
    <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">add_config</span>
    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">files/templates/ma1.templates</span>
      <span class="l-Scalar-Plain">variables</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">ipaddress</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sqlite(&#39;mgmt_subnet&#39;)</span>
    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;configure</span><span class="nv"> </span><span class="s">ma1&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Check out <a class="reference external" href="https://raw.githubusercontent.com/arista-eosplus/ztpserver/develop/utils/create_db.py">create_db.py</a> for an example script to create a sqlite database.</p>
</div>
</div>
<div class="section" id="config-handlers">
<h2><a class="toc-backref" href="#id21">Config-handlers</a><a class="headerlink" href="#config-handlers" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">[data_root]/config-handlers/</span></tt> contains config-handlers which can be
associated with nodes via <em>neighbordb</em>. A config-handler script is executed
every time a PUT startup-config request succeeds for a node which is
associated to it.</p>
</div>
<div class="section" id="other-files">
<h2><a class="toc-backref" href="#id22">Other files</a><a class="headerlink" href="#other-files" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">[data_root]/files/</span></tt> contains the files that actions might request
from the server. For example, <tt class="docutils literal"><span class="pre">[data_root]/files/images/</span></tt> could contain
all EOS SWI files.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="startup.html" class="btn btn-neutral" title="Startup"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Arista Networks.
      Last updated on Oct 13, 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>