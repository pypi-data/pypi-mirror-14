<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>PCP Quality Assessment Protocol</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<body>
<!-- HEADER -->
<div id="header">
    <h1 id="project_title">PCP Quality Assessment Protocol - QAP Reports for fMRI</h1>
</div>

<p>After all processing has been completed, the designated output directory for the 
functional workflow will contain a set of pdf files that contain the relevant reports
for the set of scans undergoing quality assessment.
The set of output pdfs includes one pdf file per input scan, e.g.: 
<code>functional_sub-01.pdf</code>, which contains a mosaic plot of the mean EPI 
volume, a mosaic plot of the tSNR volume, an FD (frame displacement) plot, and
QC metrics for that scan. The QC metrics are split in two categories: <em>spatial</em>
and <em>temporal</em>. There will also be a group report pdf in that main output 
directory, e.g.: <code>functional_group.pdf</code>, that contains the summary of QC
metrics for the entire set of scans.</p>

<h2>For the individual scan reports:</h2>

<h3 id="mosaic">The Mean EPI Slice Mosaic</h3>

<p>This plot in the report for the scan being assessed, e.g.: </p>
<pre><code>Mean EPI image (subject 1_session_1_scan_1)</code></pre>
<p>is the rendering of the axial slices from the 3D stack created by the workflow.
This mean EPI was created by averaging the BOLD signal intensity values in each voxel over time.
Hence, a 3-dimensional image was created from the 4-dimensional scan and was displayed as a slice mosaic.
This image can be used to eyeball the quality of the overall signal in the scan, as it will be obvious if
there were any problem areas where there was signal dropout resulting from a bad shim or other sources of
signal distortion (such as tattoos which contain metallic or ferromagnetic compounds, or permanent makeup).</p>

<h3 id="mosaic">The tSNR Slice Mosaic</h3>

<p>The image showing the tSNR map for a particular scan, e.g.:</p>
<pre><code>tSNR volume, subject sub-01 (session_1_func_1)</code></pre>
<p>is the rendering of the temporal signal-to-noise ratio information from the scan.
The tSNR plot is similar to the mean EPI plot generated by the <code>qap_functional_spatial.py</code> workflow, in that both metrics reduce the 4-dimensional
scan to a representative 3-dimensional volume that is then split and displayed as a stack of 
axial (horizontal) slices.
For this tSNR plot, the mean of each voxel's timeseries is 
also computed and is then divided by the timeseries standard deviation.
Hence, the tSNR plot shows the voxels in which one would expect to have SNR good enough for statistical analyses.
Differences in tSNR are particularly important for comparing the results from region of
interest (ROI) analyses, since any observed functional differences might actually be attributable
to systematic differences in SNR across the regions being compared.
You can learn more about the utility of tSNR plots for fMRI analyses
<a href="http://practicalfmri.blogspot.com.es/2011/01/comparing-fmri-protocols.html" target="_blank" >here</a>.</p>

<h3 id="fd_plot">The framewise displacement plot</h3>

<p>The image showing the framewise displacement plot for the scan being assessed, e.g.:</p>
<pre><code>FD, subject sub-01 (session_1_func_1)</code></pre>
<p>is the framewise displacement that occurred throughout the scan.
This is a temporal motion quality assurance metric and tracks head motions over time, making 
it easy to determine whether or not the data potentially suffered from significant corruption
due to motion. For instance, it is possible to detect if the participant's head was slowly sinking into the 
cushions in the head coil, or whether the participant was possibly restless or agitated, which 
would result in several postion changes or movement spikes. The framewise displacement is a 
frame-by-frame representation of the differences between the BOLD signal intensity value of 
the n and n+1 timepoints, the n+1 and n+2 timepoints, and so on. The report page for framewise 
displacement in the functional scan includes both this frame-by-frame plot, as well as a 
histogram that can be used to visually determine what proportion of timepoints exceeded some 
pre-set movement threshold (eg: 0.2 mm).</p>


<h3>The Spatial Metrics computed on the Functional Scan</h3>
<p>The metrics displayed in the Summary Report were computed using the</p>
<pre><code>qap_functional_spatial.py </code></pre>
<p>workflow and have been displayed as violin plots. The stars in these plots denote 
where the score for this particular scan falls in the distribution of all scores for 
scans that were included as inputs to this workflow.</p>

<p>The metrics computed are as follows:</p>
<ol>
	<li>bg_size - Background mask size</li>
	<li>fg_size - Foreground mask size</li>
	<li>bg_mean - Mean intensity of the background mask</li>
	<li>fg_mean - Mean intensity of the foreground mask</li>
	<li>bg_std - Standard deviation of the background mask</li>
	<li>fg_std - Standard deviation of the foreground mask</li>
	<li>efc - Entropy Focus Criterion</li>
	<li>fber - Foreground to Background Energy Ratio</li>
	<li>fwhm - Full-width half maximum smoothness of the voxels averaged across the three 
	coordinate axes, and also for each axis [x,y,x]</li>
	<li>ghost_x - Ghost to Signal Ratio </li>
	<li>snr -  Signal to Noise Ratio</li>
</ol>

<p>All metrics are described in more detail in the 
<a href="http://preprocessed-connectomes-project.github.io/quality-assessment-protocol/#taxonomy-of-qa-measures" target="_blank" >Taxonomy of QA Measures section</a> of the QAP documentation. Please refer to the QAP website for descriptions of these metrics.</p>

<h3>The Temporal Metrics computed on the Functional Scan</h3>
<p>The metrics displayed in the Summary Report were computed using the <code>qap_functional_temporal.py</code> workflow and have been displayed as violin plots. Eg:</p>
<pre><code>QC measures (subject sub-01_session_1)</code></pre>
<p>The stars in these plots denote where the score for this particular scan falls in the
distribution of all scores for scans that were included as inputs to the the 
functional-temporal workflow.</p>

<p>The metrics computed are as follows:</p>
<ol>
	<li>dvars - Spatial standard deviation of the voxelwise temporal derivates </li>
	<li>gcor - Global Correlation</li>
	<li>mean_fd - Mean Fractional Displacement</li>
	<li>num_fd - Number of volumes with FD greater than 0.2mm </li>
	<li>perc_fd - Percent of volumes with FD greater than 0.2mm</li>
	<li>outlier - Mean fraction of outliers per fMRI volume</li>
	<li>quality - Median Distance Index</li>
</ol>

<p>All metrics are described in more detail in the 
<a href="http://preprocessed-connectomes-project.github.io/quality-assessment-protocol/#taxonomy-of-qa-measures" target="_blank" >Taxonomy of QA Measures section</a> of the QAP documentation. Please refer to the QAP website for descriptions of these metrics.</p>

<h2> For the group reports:</h2>

<p>The violin plots included in the group report, e.g.: <code>QC measures (session_1)</code>
are a graphical representation of the columnar values in the <code>qap_functional_spatial.csv</code>
file that was created in the main output directory for the workflow. The scores for each metric
described above were aggregated to create the distributions that were plotted in both the individual
and group reports. Hence, the violin plots in the individual scan reports and the group reports are
identical, except that the group reports do not contain any stars denoting individual scans.
These group reports are intended to provide the user a means of visually inspecting the overall 
quality of the spatial and temporal data for that group of functional scans.</p>

</body>