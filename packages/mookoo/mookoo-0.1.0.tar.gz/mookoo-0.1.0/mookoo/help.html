
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
<title>MooKoo</title>
<style>
@import url(http://fonts.googleapis.com/css?family=Vollkorn:400,400italic,700,700italic&subset=latin);

html, body {
        padding:1em;
        margin:auto;
        max-width:42em;
        background:#fefefe;
	}
body {
	font: 1.3em "Vollkorn", Palatino, Times;
	color: #333;
	line-height: 1.4;
	text-align: justify;
	}
header, nav, article, footer {
	width: 700px;
	margin:0 auto;
	}
article {
	margin-top: 4em;
	margin-bottom: 4em;
	min-height: 400px;
	}
footer {
	margin-bottom:50px;
	}
video {
	margin: 2em 0;
	border:1px solid #ddd;
	}

nav {
	font-size: .9em;
	font-style: italic;
	border-bottom: 1px solid #ddd;
	padding: 1em 0;
	}
nav p {
	margin: 0;
	}

/* Typography
-------------------------------------------------------- */

h1 {
	margin-top: 0;
	font-weight: normal;
	}
h2 {
	font-weight: normal;
	}
h3 {
	font-weight: normal;
	font-style: italic;
	margin-top:3em;
	}
p {
	margin-top:0;
	-webkit-hypens:auto;
	-moz-hypens:auto;
	hyphens:auto;
	}
ul {
	list-style: square;
	padding-left:1.2em;
	}
ol {
	padding-left:1.2em;
	}
blockquote {
	margin-left: 1em;
	padding-left: 1em;
	border-left: 1px solid #ddd;
	}
code {
	font-family: "Consolas", "Menlo", "Monaco", monospace, serif;
	font-size: .9em;
	background: white;
	}
a {
	color: #2484c1;
	text-decoration: none;
	}
a:hover {
	text-decoration: underline;
	}
a img {
	border:none;
	}
h1 a, h1 a:hover {
	color: #333;
	text-decoration: none;
	}
hr {
	color : #ddd;
	height : 1px;
	margin: 2em 0;
	border-top : solid 1px #ddd;
	border-bottom : none;
	border-left: 0;
	border-right: 0;
	}
p#heart{
	font-size: 2em;
	line-height: 1;
	text-align: center;
	color: #ccc;
	}
.red {
	color:#B50000;
	}

/* Home Page
--------------------------- */

body#index li {
	margin-bottom: 1em;
	}


/* iPad
-------------------------------------------------------- */
@media only screen and (max-device-width: 1024px) {
body {
	font-size: 120%;
	line-height: 1.4;
	}
} /* @iPad */

/* iPhone
-------------------------------------------------------- */
@media only screen and (max-device-width: 480px) {
body {
	text-align: left;
	}
article, footer {
	width: auto;
	}
article {
	padding: 0 10px;
	}
} /* @iPhone */

</style>
</head>
<body>
<h1>
<a id="user-content-mookoo" class="anchor" href="#mookoo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MooKoo</h1>

<p>MooKoo是一个基于Python的Mock http server</p>

<h2>
<a id="user-content-安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安装</h2>

<h3>
<a id="user-content-使用pip安装" class="anchor" href="#%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用pip安装</h3>

<div class="highlight highlight-source-shell"><pre>pip install mookoo
mookoo mock1 <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">cd</span> mock1 <span class="pl-k">&amp;&amp;</span> python mock.py
<span class="pl-c"># 在浏览器中访问 http://localhost:7928/hello</span></pre></div>

<h3>
<a id="user-content-手工安装" class="anchor" href="#%E6%89%8B%E5%B7%A5%E5%AE%89%E8%A3%85" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>手工安装</h3>

<div class="highlight highlight-source-shell"><pre>mkdir mock1<span class="pl-k">;</span> <span class="pl-c1">cd</span> mock1
git clone https://github.com/gaorx/mookoo.git <span class="pl-k">&amp;&amp;</span> rm -rf mookoo/.git
vim mock.py</pre></div>

<h2>
<a id="user-content-起步" class="anchor" href="#%E8%B5%B7%E6%AD%A5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>起步</h2>

<p>在<code>mock1</code>目录中，编辑<code>mock.py</code></p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> mookoo <span class="pl-k">import</span> <span class="pl-k">*</span>
GET(<span class="pl-s"><span class="pl-pds">'</span>/hello<span class="pl-pds">'</span></span>).json({<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Hello MooKoo!<span class="pl-pds">"</span></span>})
run()</pre></div>

<p>然后在shell中执行</p>

<div class="highlight highlight-source-shell"><pre>python mock.py
<span class="pl-c"># 也可以设定端口</span>
<span class="pl-c"># python mock.py -p 9928</span></pre></div>

<p>然后在浏览器中就访问<code>http://localhost:7928/hello</code>，就可以看到</p>

<div class="highlight highlight-source-json"><pre>{<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Hello Mookoo<span class="pl-pds">"</span></span>}</pre></div>

<p>也可以访问<code>http://localhost:7928/+mookoo</code>查看此帮助文件</p>

<h2>
<a id="user-content-进阶" class="anchor" href="#%E8%BF%9B%E9%98%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>进阶</h2>

<h3>
<a id="user-content-动态加载文件" class="anchor" href="#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>动态加载文件</h3>

<p>在<code>mock1</code>目录中，创建<code>hello.json</code>，然后编辑它，然后使用下面的代码动态加载</p>

<div class="highlight highlight-source-python"><pre>GET(<span class="pl-s"><span class="pl-pds">'</span>/hello<span class="pl-pds">'</span></span>).load_json(<span class="pl-s"><span class="pl-pds">'</span>hello.json<span class="pl-pds">'</span></span>)</pre></div>

<h3>
<a id="user-content-修改status和header" class="anchor" href="#%E4%BF%AE%E6%94%B9status%E5%92%8Cheader" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>修改<code>Status</code>和<code>Header</code>
</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># 定制Status</span>
GET(<span class="pl-s"><span class="pl-pds">'</span>/404<span class="pl-pds">'</span></span>).html(<span class="pl-s"><span class="pl-pds">'</span>&lt;h1&gt;Not found&lt;/h1&gt;<span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">404</span>)

<span class="pl-c"># 加入Header</span>
GET(<span class="pl-s"><span class="pl-pds">'</span>/custom_header<span class="pl-pds">'</span></span>).text(<span class="pl-s"><span class="pl-pds">"</span>Press F12<span class="pl-pds">"</span></span>, <span class="pl-v">header</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">"</span>My-Header<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>HeaderContent<span class="pl-pds">"</span></span>})

<span class="pl-c"># 修改content_type</span>
GET(<span class="pl-s"><span class="pl-pds">'</span>/custom_content_type<span class="pl-pds">'</span></span>).text(<span class="pl-s"><span class="pl-pds">"</span>&lt;h1&gt;Press F12&lt;/h1&gt;<span class="pl-pds">"</span></span>, <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>)</pre></div>

<h3>
<a id="user-content-动态响应" class="anchor" href="#%E5%8A%A8%E6%80%81%E5%93%8D%E5%BA%94" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>动态响应</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@GET</span>(<span class="pl-s"><span class="pl-pds">'</span>/dynamic/&lt;sub&gt;<span class="pl-pds">'</span></span>)
<span class="pl-k">def</span> <span class="pl-en">_dynamic</span>(<span class="pl-smi">sub</span>):
    response.content_type <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>
    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>Sub path is <span class="pl-c1">%s</span>, query_string is '<span class="pl-c1">%s</span>'<span class="pl-pds">"</span></span> <span class="pl-k">%</span> (sub, request.query_string)</pre></div>

<h3>
<a id="user-content-静态文件" class="anchor" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>静态文件</h3>

<p>将一张在<code>mock1</code>目录中复制一张图片<code>hello.jpg</code></p>

<div class="highlight highlight-source-python"><pre>GET(<span class="pl-s"><span class="pl-pds">'</span>/image<span class="pl-pds">'</span></span>).static_file(<span class="pl-s"><span class="pl-pds">'</span>hello.jpg<span class="pl-pds">'</span></span>)</pre></div>

<h3>
<a id="user-content-静态目录" class="anchor" href="#%E9%9D%99%E6%80%81%E7%9B%AE%E5%BD%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>静态目录</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@mookoo.GET</span>(<span class="pl-s"><span class="pl-pds">'</span>/static/&lt;filename:path&gt;<span class="pl-pds">'</span></span>)
<span class="pl-k">def</span> <span class="pl-en">_static_dir</span>(<span class="pl-smi">filename</span>):
    <span class="pl-k">return</span> mookoo.static_file(os.path.join(<span class="pl-s"><span class="pl-pds">'</span>static_dir<span class="pl-pds">'</span></span>, filename))</pre></div>

<h3>
<a id="user-content-动态json" class="anchor" href="#%E5%8A%A8%E6%80%81json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>动态JSON</h3>

<p>在<code>mock1</code>目录中，创建<code>hello.json.py</code>，内容为:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c1">JSON</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Python json<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>query_string<span class="pl-pds">"</span></span>: request.query_string,
}</pre></div>

<p>然后使用下面的代码加载:</p>

<div class="highlight highlight-source-python"><pre>GET(<span class="pl-s"><span class="pl-pds">'</span>/dynamic_json<span class="pl-pds">'</span></span>).load_json(<span class="pl-s"><span class="pl-pds">'</span>hello.json.py<span class="pl-pds">'</span></span>)</pre></div>

<h3>
<a id="user-content-helpers" class="anchor" href="#helpers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Helpers</h3>

<p>可以使用<code>mookoo.helper</code>注册共享函数，然后在动态JSON中可以使用<code>helpers</code>来使用这些函数。例如在<code>mock.py</code>中：</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@helper</span>
<span class="pl-k">def</span> <span class="pl-en">helper1</span>():
    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>Helper1<span class="pl-pds">"</span></span>

<span class="pl-en">@helper</span>()
<span class="pl-k">def</span> <span class="pl-en">helper2</span>():
    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>Helper2<span class="pl-pds">"</span></span>

<span class="pl-en">@helper</span>(<span class="pl-s"><span class="pl-pds">'</span>helper3<span class="pl-pds">'</span></span>)
<span class="pl-k">def</span> <span class="pl-en">the_name_is_not_helper3</span>():
    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>Helper3<span class="pl-pds">"</span></span>

GET(<span class="pl-s"><span class="pl-pds">'</span>/dynamic_json<span class="pl-pds">'</span></span>).load_json(<span class="pl-s"><span class="pl-pds">'</span>hello.json.py<span class="pl-pds">'</span></span>)</pre></div>

<p>在<code>hello.json.py</code>中</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c1">JSON</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Python json<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>query_string<span class="pl-pds">"</span></span>: request.query_string,
    <span class="pl-s"><span class="pl-pds">"</span>helper1<span class="pl-pds">"</span></span>: helpers.helper1(),
    <span class="pl-s"><span class="pl-pds">"</span>helper2<span class="pl-pds">"</span></span>: helpers.helper2(),
    <span class="pl-s"><span class="pl-pds">"</span>helper3<span class="pl-pds">"</span></span>: helpers.helper3(),
}</pre></div>

<h3>
<a id="user-content-重定向" class="anchor" href="#%E9%87%8D%E5%AE%9A%E5%90%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>重定向</h3>

<div class="highlight highlight-source-python"><pre>GET(<span class="pl-s"><span class="pl-pds">'</span>/redirect<span class="pl-pds">'</span></span>).redirect(<span class="pl-s"><span class="pl-pds">'</span>https://github.com/gaorx/mookoo<span class="pl-pds">'</span></span>)</pre></div>

<h3>
<a id="user-content-代理" class="anchor" href="#%E4%BB%A3%E7%90%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>代理</h3>

<div class="highlight highlight-source-python"><pre>GET(<span class="pl-s"><span class="pl-pds">'</span>/http_rfc<span class="pl-pds">'</span></span>).proxy(<span class="pl-s"><span class="pl-pds">'</span>https://tools.ietf.org/rfc/rfc2616.txt<span class="pl-pds">'</span></span>)</pre></div>

<p>注意: Proxy只会使用转发源Header中的Status和Content-Type，其余Header不转发。</p>

</body>
</html>
