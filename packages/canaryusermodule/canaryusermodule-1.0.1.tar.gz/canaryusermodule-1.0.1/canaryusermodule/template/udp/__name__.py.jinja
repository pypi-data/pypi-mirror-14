INCIDENT_NAME = "{{ pkgname }} Incident"
VERSION = "1.0"
MODULE_DESCRIPTION = "{{ description }}"
AUTHOR = "User"
AUTHOR_EMAIL = "user@example.com"

from opencanary.modules import CanaryService
from twisted.internet.protocol import DatagramProtocol

class {{ pkgname }}(DatagramProtocol, CanaryService):
    NAME = '{{ name }}'

    def datagramReceived(self, data, (host, port)):
        logdata = {
            'DESCRIPTION': INCIDENT_NAME,
            'DATA': data
        }
        self.log(
            logdata,
            src_host=host,
            src_port=port
        )
        self.transport.write(data, (host, port))

    def __init__(self, config=None, logger=None):
        CanaryService.__init__(self, config=config, logger=logger)
        self.port = config.getVal('{{ name }}.port', 8008)
        self.logtype = logger.LOG_USER_1
