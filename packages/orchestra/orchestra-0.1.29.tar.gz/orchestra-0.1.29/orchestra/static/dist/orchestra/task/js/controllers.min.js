!function(){"use strict";function TaskController($location,$scope,$routeParams,$http,$rootScope,$modal,$timeout,autoSaveTask,orchestraService,requiredFields){var vm=this;vm.taskId=$routeParams.taskId,vm.taskAssignment={},vm.angularDirective="",vm.activate=function(){$http.post("/orchestra/api/interface/task_assignment_information/",{task_id:vm.taskId}).success(function(data,status,headers,config){vm.taskAssignment=data,vm.project=data.project,vm.is_read_only=data.is_read_only,vm.work_times_seconds=data.work_times_seconds,vm.is_read_only||(requiredFields.setup(vm),$scope.$watch("vm.taskAssignment.task.data",function(newVal,oldVal){newVal!=oldVal&&$rootScope.$broadcast("task.data:change")},!0),vm.autoSaver=autoSaveTask,autoSaveTask.setup($scope,vm.taskId,vm.taskAssignment.task.data));var inject,directiveTag=window.orchestra.angular_directives[data.workflow.slug][data.workflow_version.slug][data.step.slug];directiveTag&&(directiveTag=directiveTag.replace(/[A-Z]/g,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()}),inject=["<",directiveTag,' task-assignment="vm.taskAssignment"></',directiveTag,">"].join("")),vm.angularDirective=inject})},vm.confirmSubmission=function(command,totalSeconds){return vm.submitting=!0,orchestraService.signals.fireSignal("submit.before")===!1?void(vm.submitting=!1):void $http.post("/orchestra/api/interface/submit_task_assignment/",{task_id:vm.taskId,task_data:vm.taskAssignment.task.data,command_type:command,work_time_seconds:totalSeconds}).success(function(data,status,headers,config){vm.autoSaver.cancel(),orchestraService.signals.fireSignal("submit.success"),$location.path("/")}).error(function(data,status,headers,config){orchestraService.signals.fireSignal("submit.error")})["finally"](function(){orchestraService.signals.fireSignal("submit.finally"),vm.submitting=!1})},vm.submitTask=function(command){var modalInstance=$modal.open({templateUrl:"submit_task_modal.html",controller:"SubmitModalInstanceCtrl",size:"sm",windowClass:"modal-confirm-submit",resolve:{command:function(){return command},work_times_seconds:function(){return vm.work_times_seconds}}});modalInstance.result.then(function(totalSeconds){vm.confirmSubmission(command,totalSeconds)})},vm.activate()}TaskController.$inject=["$location","$scope","$routeParams","$http","$rootScope","$modal","$timeout","autoSaveTask","orchestraService","requiredFields"],angular.module("orchestra.task.controllers").controller("TaskController",TaskController)}(),function(){"use strict";function SubmitModalInstanceCtrl($scope,$modalInstance,command,workTimesSeconds){$scope.command=command,$scope.currentIterationHours=null,$scope.currentIterationMinutes=null,$scope.workTimesSeconds=workTimesSeconds,$scope.submit=function(){$modalInstance.close($scope.totalSeconds())},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.totalSeconds=function(){var hours=parseInt($scope.currentIterationHours),minutes=parseInt($scope.currentIterationMinutes);if(isNaN(hours))throw"Please provide hours (0 is acceptable)";if(hours.toString()!==$scope.currentIterationHours)throw"Hours should be a whole number";if(0>hours)throw"Hours should be >=0";if(isNaN(minutes))throw"Please provide minutes (0 is acceptable)";if(minutes.toString()!==$scope.currentIterationMinutes)throw"Minutes should be a whole number";if(minutes>59||0>minutes)throw"Minutes should be <60 and >=0";return 3600*hours+60*minutes},$scope.secondsError=function(){try{$scope.totalSeconds()}catch(error){return error}return null},$scope.hoursMinutes=function(seconds){var hours=(seconds-seconds%3600)/3600,minutes=seconds%3600/60;return[hours,minutes]},$scope.totalPreviousSeconds=function(){var total=0;return angular.forEach($scope.workTimesSeconds,function(seconds){total+=seconds}),total},$scope.totalPreviousHoursMinutes=function(){return $scope.hoursMinutes($scope.totalPreviousSeconds())},$scope.totalHoursMinutes=function(){var allSeconds=$scope.totalPreviousSeconds();try{allSeconds+=$scope.totalSeconds()}catch(error){}return $scope.hoursMinutes(allSeconds)},$scope.$watchGroup(["currentIterationHours","currentIterationMinutes"],function(newTimes,oldTimes){for(var i=0;i<newTimes.length;i++)newTimes[i]!=oldTimes[i]&&($scope.secondsErrorMessage=$scope.secondsError())})}angular.module("orchestra.task.controllers").controller("SubmitModalInstanceCtrl",SubmitModalInstanceCtrl),SubmitModalInstanceCtrl.$inject=["$scope","$modalInstance","command","work_times_seconds"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hlc3RyYS90YXNrL2pzL2NvbnRyb2xsZXJzLmpzIl0sIm5hbWVzIjpbIlRhc2tDb250cm9sbGVyIiwiJGxvY2F0aW9uIiwiJHNjb3BlIiwiJHJvdXRlUGFyYW1zIiwiJGh0dHAiLCIkcm9vdFNjb3BlIiwiJG1vZGFsIiwiJHRpbWVvdXQiLCJhdXRvU2F2ZVRhc2siLCJvcmNoZXN0cmFTZXJ2aWNlIiwicmVxdWlyZWRGaWVsZHMiLCJ2bSIsInRoaXMiLCJ0YXNrSWQiLCJ0YXNrQXNzaWdubWVudCIsImFuZ3VsYXJEaXJlY3RpdmUiLCJhY3RpdmF0ZSIsInBvc3QiLCJ0YXNrX2lkIiwic3VjY2VzcyIsImRhdGEiLCJzdGF0dXMiLCJoZWFkZXJzIiwiY29uZmlnIiwicHJvamVjdCIsImlzX3JlYWRfb25seSIsIndvcmtfdGltZXNfc2Vjb25kcyIsInNldHVwIiwiJHdhdGNoIiwibmV3VmFsIiwib2xkVmFsIiwiJGJyb2FkY2FzdCIsImF1dG9TYXZlciIsInRhc2siLCJpbmplY3QiLCJkaXJlY3RpdmVUYWciLCJ3aW5kb3ciLCJvcmNoZXN0cmEiLCJhbmd1bGFyX2RpcmVjdGl2ZXMiLCJ3b3JrZmxvdyIsInNsdWciLCJ3b3JrZmxvd192ZXJzaW9uIiwic3RlcCIsInJlcGxhY2UiLCJsZXR0ZXIiLCJwb3MiLCJ0b0xvd2VyQ2FzZSIsImpvaW4iLCJjb25maXJtU3VibWlzc2lvbiIsImNvbW1hbmQiLCJ0b3RhbFNlY29uZHMiLCJzdWJtaXR0aW5nIiwic2lnbmFscyIsImZpcmVTaWduYWwiLCJ0YXNrX2RhdGEiLCJjb21tYW5kX3R5cGUiLCJ3b3JrX3RpbWVfc2Vjb25kcyIsImNhbmNlbCIsInBhdGgiLCJlcnJvciIsInN1Ym1pdFRhc2siLCJtb2RhbEluc3RhbmNlIiwib3BlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNpemUiLCJ3aW5kb3dDbGFzcyIsInJlc29sdmUiLCJyZXN1bHQiLCJ0aGVuIiwiJGluamVjdCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJTdWJtaXRNb2RhbEluc3RhbmNlQ3RybCIsIiRtb2RhbEluc3RhbmNlIiwid29ya1RpbWVzU2Vjb25kcyIsImN1cnJlbnRJdGVyYXRpb25Ib3VycyIsImN1cnJlbnRJdGVyYXRpb25NaW51dGVzIiwic3VibWl0IiwiY2xvc2UiLCJkaXNtaXNzIiwiaG91cnMiLCJwYXJzZUludCIsIm1pbnV0ZXMiLCJpc05hTiIsInRvU3RyaW5nIiwic2Vjb25kc0Vycm9yIiwiaG91cnNNaW51dGVzIiwic2Vjb25kcyIsInRvdGFsUHJldmlvdXNTZWNvbmRzIiwidG90YWwiLCJmb3JFYWNoIiwidG90YWxQcmV2aW91c0hvdXJzTWludXRlcyIsInRvdGFsSG91cnNNaW51dGVzIiwiYWxsU2Vjb25kcyIsIiR3YXRjaEdyb3VwIiwibmV3VGltZXMiLCJvbGRUaW1lcyIsImkiLCJsZW5ndGgiLCJzZWNvbmRzRXJyb3JNZXNzYWdlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNFLFlBTUEsU0FBU0EsZ0JBQWVDLFVBQVdDLE9BQVFDLGFBQWNDLE1BQU9DLFdBQzlEQyxPQUFRQyxTQUFVQyxhQUFjQyxpQkFDaENDLGdCQUNBLEdBQUlDLElBQUtDLElBQ1RELElBQUdFLE9BQVNWLGFBQWFVLE9BQ3pCRixHQUFHRyxrQkFDSEgsR0FBR0ksaUJBQW1CLEdBRXRCSixHQUFHSyxTQUFXLFdBQ1paLE1BQU1hLEtBQUsseURBQ1RDLFFBQVdQLEdBQUdFLFNBRWhCTSxRQUFRLFNBQVNDLEtBQU1DLE9BQVFDLFFBQVNDLFFBQ3RDWixHQUFHRyxlQUFpQk0sS0FDcEJULEdBQUdhLFFBQVVKLEtBQUtJLFFBQ2xCYixHQUFHYyxhQUFlTCxLQUFLSyxhQUN2QmQsR0FBR2UsbUJBQXFCTixLQUFLTSxtQkFFeEJmLEdBQUdjLGVBQ05mLGVBQWVpQixNQUFNaEIsSUFDckJULE9BQU8wQixPQUFPLDhCQUErQixTQUFTQyxPQUFRQyxRQUd4REQsUUFBVUMsUUFDWnpCLFdBQVcwQixXQUFXLHNCQUV2QixHQUVIcEIsR0FBR3FCLFVBQVl4QixhQUNm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QVUsS0FBUSxFQUNqQyxRQUFRUCxNQUFPRSxVQUdqQmpGLE9BQU91RixxQkFBdUIsV0FDNUIsR0FBSUMsT0FBUSxDQUlaLE9BSEFuQixTQUFRb0IsUUFBUXpGLE9BQU95RSxpQkFBa0IsU0FBU2EsU0FDaERFLE9BQVNGLFVBRUpFLE9BR1R4RixPQUFPMEYsMEJBQTRCLFdBQ2pDLE1BQU8xRixRQUFPcUYsYUFBYXJGLE9BQU91Rix5QkFHcEN2RixPQUFPMkYsa0JBQW9CLFdBQ3pCLEdBQUlDLFlBQWE1RixPQUFPdUYsc0JBQ3hCLEtBQ0VLLFlBQWM1RixPQUFPZ0QsZUFDckIsTUFBT1MsUUFDVCxNQUFPekQsUUFBT3FGLGFBQWFPLGFBRzdCNUYsT0FBTzZGLGFBQWEsd0JBQ2hCLDJCQUVGLFNBQVNDLFNBQVVDLFVBQ2pCLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRixTQUFTRyxPQUFRRCxJQUMvQkYsU0FBU0UsSUFBTUQsU0FBU0MsS0FDMUJoRyxPQUFPa0csb0JBQXNCbEcsT0FBT29GLGtCQXZGOUNmLFFBQ0dDLE9BQU8sOEJBQ1BSLFdBQVcsMEJBQTJCUyx5QkFFekNBLHdCQUF3QkgsU0FBVyxTQUFVLGlCQUFrQixVQUFXIiwiZmlsZSI6Im9yY2hlc3RyYS90YXNrL2pzL2NvbnRyb2xsZXJzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdvcmNoZXN0cmEudGFzay5jb250cm9sbGVycycpXG4gICAgLmNvbnRyb2xsZXIoJ1Rhc2tDb250cm9sbGVyJywgVGFza0NvbnRyb2xsZXIpO1xuXG4gIGZ1bmN0aW9uIFRhc2tDb250cm9sbGVyKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkcm9vdFNjb3BlLFxuICAgICRtb2RhbCwgJHRpbWVvdXQsIGF1dG9TYXZlVGFzaywgb3JjaGVzdHJhU2VydmljZSxcbiAgICByZXF1aXJlZEZpZWxkcykge1xuICAgIHZhciB2bSA9IHRoaXM7XG4gICAgdm0udGFza0lkID0gJHJvdXRlUGFyYW1zLnRhc2tJZDtcbiAgICB2bS50YXNrQXNzaWdubWVudCA9IHt9O1xuICAgIHZtLmFuZ3VsYXJEaXJlY3RpdmUgPSAnJztcblxuICAgIHZtLmFjdGl2YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAkaHR0cC5wb3N0KCcvb3JjaGVzdHJhL2FwaS9pbnRlcmZhY2UvdGFza19hc3NpZ25tZW50X2luZm9ybWF0aW9uLycsIHtcbiAgICAgICAgJ3Rhc2tfaWQnOiB2bS50YXNrSWRcbiAgICAgIH0pLlxuICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICB2bS50YXNrQXNzaWdubWVudCA9IGRhdGE7XG4gICAgICAgIHZtLnByb2plY3QgPSBkYXRhLnByb2plY3Q7XG4gICAgICAgIHZtLmlzX3JlYWRfb25seSA9IGRhdGEuaXNfcmVhZF9vbmx5O1xuICAgICAgICB2bS53b3JrX3RpbWVzX3NlY29uZHMgPSBkYXRhLndvcmtfdGltZXNfc2Vjb25kcztcblxuICAgICAgICBpZiAoIXZtLmlzX3JlYWRfb25seSkge1xuICAgICAgICAgIHJlcXVpcmVkRmllbGRzLnNldHVwKHZtKTtcbiAgICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS50YXNrQXNzaWdubWVudC50YXNrLmRhdGEnLCBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkge1xuICAgICAgICAgICAgLy8gRW5zdXJlIHNhdmUgZmlyZWQgYXQgaW5pdGlhbGl6YXRpb25cbiAgICAgICAgICAgIC8vIFtodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xODkxNTU4NV1cbiAgICAgICAgICAgIGlmIChuZXdWYWwgIT0gb2xkVmFsKSB7XG4gICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndGFzay5kYXRhOmNoYW5nZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgdm0uYXV0b1NhdmVyID0gYXV0b1NhdmVUYXNrO1xuICAgICAgICAgIGF1dG9TYXZlVGFzay5zZXR1cCgkc2NvcGUsIHZtLnRhc2tJZCwgdm0udGFza0Fzc2lnbm1lbnQudGFzay5kYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkaXJlY3RpdmVUYWcgPSAod2luZG93Lm9yY2hlc3RyYVxuICAgICAgICAgIC5hbmd1bGFyX2RpcmVjdGl2ZXNbZGF0YS53b3JrZmxvdy5zbHVnXVtkYXRhLndvcmtmbG93X3ZlcnNpb24uc2x1Z11cbiAgICAgICAgICBbZGF0YS5zdGVwLnNsdWddKTtcblxuICAgICAgICB2YXIgaW5qZWN0O1xuICAgICAgICBpZiAoZGlyZWN0aXZlVGFnKSB7XG4gICAgICAgICAgLy8gSHlwaGVuYXRlIGFuZCBsb3dlcmNhc2UgY2FtZWwtY2FzZWQgZGlyZWN0aXZlIG5hbWVzIGFjY29yZGluZyB0b1xuICAgICAgICAgIC8vIGFuZ3VsYXIgc3RhbmRhcmRzLlxuICAgICAgICAgIGRpcmVjdGl2ZVRhZyA9IGRpcmVjdGl2ZVRhZy5yZXBsYWNlKC9bQS1aXS9nLCBmdW5jdGlvbihsZXR0ZXIsIHBvcykge1xuICAgICAgICAgICAgcmV0dXJuIChwb3MgPyAnLScgOiAnJykgKyBsZXR0ZXIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGluamVjdCA9IFtcbiAgICAgICAgICAgICc8JyxcbiAgICAgICAgICAgIGRpcmVjdGl2ZVRhZyxcbiAgICAgICAgICAgICcgdGFzay1hc3NpZ25tZW50PVwidm0udGFza0Fzc2lnbm1lbnRcIj48LycsXG4gICAgICAgICAgICBkaXJlY3RpdmVUYWcsXG4gICAgICAgICAgICAnPidcbiAgICAgICAgICBdLmpvaW4oJycpO1xuICAgICAgICB9XG4gICAgICAgIHZtLmFuZ3VsYXJEaXJlY3RpdmUgPSBpbmplY3Q7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdm0uY29uZmlybVN1Ym1pc3Npb24gPSBmdW5jdGlvbihjb21tYW5kLCB0b3RhbFNlY29uZHMpIHtcbiAgICAgIHZtLnN1Ym1pdHRpbmcgPSB0cnVlO1xuICAgICAgaWYgKG9yY2hlc3RyYVNlcnZpY2Uuc2lnbmFscy5maXJlU2lnbmFsKCdzdWJtaXQuYmVmb3JlJykgPT09IGZhbHNlKSB7XG4gICAgICAgIC8vIElmIGFueSBvZiB0aGUgcmVnaXN0ZXJlZCBzaWduYWwgaGFuZGxlcnMgcmV0dXJucyBmYWxzZSwgcHJldmVudFxuICAgICAgICAvLyBzdWJtaXQuXG4gICAgICAgIHZtLnN1Ym1pdHRpbmcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgJGh0dHAucG9zdCgnL29yY2hlc3RyYS9hcGkvaW50ZXJmYWNlL3N1Ym1pdF90YXNrX2Fzc2lnbm1lbnQvJywge1xuICAgICAgICAgICd0YXNrX2lkJzogdm0udGFza0lkLFxuICAgICAgICAgICd0YXNrX2RhdGEnOiB2bS50YXNrQXNzaWdubWVudC50YXNrLmRhdGEsXG4gICAgICAgICAgJ2NvbW1hbmRfdHlwZSc6IGNvbW1hbmQsXG4gICAgICAgICAgJ3dvcmtfdGltZV9zZWNvbmRzJzogdG90YWxTZWNvbmRzXG4gICAgICAgIH0pXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgLy8gUHJldmVudCBhZGRpdGlvbmFsIGNvbmZpcm1hdGlvbiBkaWFsb2cgb24gbGVhdmluZyB0aGUgcGFnZTsgZGF0YVxuICAgICAgICAgIC8vIHdpbGwgYmUgc2F2ZWQgYnkgc3VibWlzc2lvblxuICAgICAgICAgIHZtLmF1dG9TYXZlci5jYW5jZWwoKTtcbiAgICAgICAgICBvcmNoZXN0cmFTZXJ2aWNlLnNpZ25hbHMuZmlyZVNpZ25hbCgnc3VibWl0LnN1Y2Nlc3MnKTtcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICBvcmNoZXN0cmFTZXJ2aWNlLnNpZ25hbHMuZmlyZVNpZ25hbCgnc3VibWl0LmVycm9yJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG9yY2hlc3RyYVNlcnZpY2Uuc2lnbmFscy5maXJlU2lnbmFsKCdzdWJtaXQuZmluYWxseScpO1xuICAgICAgICAgIHZtLnN1Ym1pdHRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZtLnN1Ym1pdFRhc2sgPSBmdW5jdGlvbihjb21tYW5kKSB7XG4gICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzdWJtaXRfdGFza19tb2RhbC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ1N1Ym1pdE1vZGFsSW5zdGFuY2VDdHJsJyxcbiAgICAgICAgc2l6ZTogJ3NtJyxcbiAgICAgICAgd2luZG93Q2xhc3M6ICdtb2RhbC1jb25maXJtLXN1Ym1pdCcsXG4gICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICBjb21tYW5kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgd29ya190aW1lc19zZWNvbmRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB2bS53b3JrX3RpbWVzX3NlY29uZHM7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24odG90YWxTZWNvbmRzKSB7XG4gICAgICAgIHZtLmNvbmZpcm1TdWJtaXNzaW9uKGNvbW1hbmQsIHRvdGFsU2Vjb25kcyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdm0uYWN0aXZhdGUoKTtcbiAgfVxuXG59KSgpO1xuXG5cbihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdvcmNoZXN0cmEudGFzay5jb250cm9sbGVycycpXG4gICAgLmNvbnRyb2xsZXIoJ1N1Ym1pdE1vZGFsSW5zdGFuY2VDdHJsJywgU3VibWl0TW9kYWxJbnN0YW5jZUN0cmwpO1xuXG4gIFN1Ym1pdE1vZGFsSW5zdGFuY2VDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckbW9kYWxJbnN0YW5jZScsICdjb21tYW5kJywgJ3dvcmtfdGltZXNfc2Vjb25kcyddO1xuXG4gIGZ1bmN0aW9uIFN1Ym1pdE1vZGFsSW5zdGFuY2VDdHJsKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsIGNvbW1hbmQsIHdvcmtUaW1lc1NlY29uZHMpIHtcbiAgICAkc2NvcGUuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgJHNjb3BlLmN1cnJlbnRJdGVyYXRpb25Ib3VycyA9IG51bGw7XG4gICAgJHNjb3BlLmN1cnJlbnRJdGVyYXRpb25NaW51dGVzID0gbnVsbDtcbiAgICAkc2NvcGUud29ya1RpbWVzU2Vjb25kcyA9IHdvcmtUaW1lc1NlY29uZHM7XG5cbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUudG90YWxTZWNvbmRzKCkpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvdGFsU2Vjb25kcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhvdXJzID0gcGFyc2VJbnQoJHNjb3BlLmN1cnJlbnRJdGVyYXRpb25Ib3Vycyk7XG4gICAgICB2YXIgbWludXRlcyA9IHBhcnNlSW50KCRzY29wZS5jdXJyZW50SXRlcmF0aW9uTWludXRlcyk7XG4gICAgICBpZiAoaXNOYU4oaG91cnMpKSB7XG4gICAgICAgIHRocm93ICdQbGVhc2UgcHJvdmlkZSBob3VycyAoMCBpcyBhY2NlcHRhYmxlKSc7XG4gICAgICB9XG4gICAgICBpZiAoaG91cnMudG9TdHJpbmcoKSAhPT0gJHNjb3BlLmN1cnJlbnRJdGVyYXRpb25Ib3Vycykge1xuICAgICAgICB0aHJvdyAnSG91cnMgc2hvdWxkIGJlIGEgd2hvbGUgbnVtYmVyJztcbiAgICAgIH1cbiAgICAgIGlmIChob3VycyA8IDApIHtcbiAgICAgICAgdGhyb3cgJ0hvdXJzIHNob3VsZCBiZSA+PTAnO1xuICAgICAgfVxuICAgICAgaWYgKGlzTmFOKG1pbnV0ZXMpKSB7XG4gICAgICAgIHRocm93ICdQbGVhc2UgcHJvdmlkZSBtaW51dGVzICgwIGlzIGFjY2VwdGFibGUpJztcbiAgICAgIH1cbiAgICAgIGlmIChtaW51dGVzLnRvU3RyaW5nKCkgIT09ICRzY29wZS5jdXJyZW50SXRlcmF0aW9uTWludXRlcykge1xuICAgICAgICB0aHJvdyAnTWludXRlcyBzaG91bGQgYmUgYSB3aG9sZSBudW1iZXInO1xuICAgICAgfVxuICAgICAgaWYgKG1pbnV0ZXMgPiA1OSB8fCBtaW51dGVzIDwgMCkge1xuICAgICAgICB0aHJvdyAnTWludXRlcyBzaG91bGQgYmUgPDYwIGFuZCA+PTAnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gKGhvdXJzICogMzYwMCkgKyAobWludXRlcyAqIDYwKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNlY29uZHNFcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgJHNjb3BlLnRvdGFsU2Vjb25kcygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmhvdXJzTWludXRlcyA9IGZ1bmN0aW9uKHNlY29uZHMpIHtcbiAgICAgIHZhciBob3VycyA9IChzZWNvbmRzIC0gKHNlY29uZHMgJSAzNjAwKSkgLyAzNjAwO1xuICAgICAgdmFyIG1pbnV0ZXMgPSAoc2Vjb25kcyAlIDM2MDApIC8gNjA7XG4gICAgICByZXR1cm4gW2hvdXJzLCBtaW51dGVzXTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvdGFsUHJldmlvdXNTZWNvbmRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdG90YWwgPSAwO1xuICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS53b3JrVGltZXNTZWNvbmRzLCBmdW5jdGlvbihzZWNvbmRzKSB7XG4gICAgICAgIHRvdGFsICs9IHNlY29uZHM7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0b3RhbDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvdGFsUHJldmlvdXNIb3Vyc01pbnV0ZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAkc2NvcGUuaG91cnNNaW51dGVzKCRzY29wZS50b3RhbFByZXZpb3VzU2Vjb25kcygpKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvdGFsSG91cnNNaW51dGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYWxsU2Vjb25kcyA9ICRzY29wZS50b3RhbFByZXZpb3VzU2Vjb25kcygpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYWxsU2Vjb25kcyArPSAkc2NvcGUudG90YWxTZWNvbmRzKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgIHJldHVybiAkc2NvcGUuaG91cnNNaW51dGVzKGFsbFNlY29uZHMpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWydjdXJyZW50SXRlcmF0aW9uSG91cnMnLFxuICAgICAgICAnY3VycmVudEl0ZXJhdGlvbk1pbnV0ZXMnXG4gICAgICBdLFxuICAgICAgZnVuY3Rpb24obmV3VGltZXMsIG9sZFRpbWVzKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3VGltZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAobmV3VGltZXNbaV0gIT0gb2xkVGltZXNbaV0pIHtcbiAgICAgICAgICAgICRzY29wZS5zZWNvbmRzRXJyb3JNZXNzYWdlID0gJHNjb3BlLnNlY29uZHNFcnJvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
