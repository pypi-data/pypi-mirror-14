!function(){"use strict";var serviceModule=angular.module("orchestra.project_management.services");serviceModule.factory("assignmentsVis",["dataService","orchestraApi","iterationsVis","visUtils",function(dataService,orchestraApi,iterationsVis,visUtils){var _vis,assignmentsVis;return{addingAssignment:!1,setup:function(vis){_vis=vis,assignmentsVis=this},draw:function(){var tasks=visUtils.parentContainer.selectAll(".task"),assignments=tasks.selectAll(".assignment").data(function(taskKey){var assignments=dataService.taskFromKey(taskKey).assignments.map(function(assignment){return dataService.keyFromAssignment(assignment)});return assignments.push(),assignments});assignments.exit().remove();var assignmentsEnter=assignments.enter().append("g").attr("class","assignment");iterationsVis.draw(),assignmentsEnter.append("circle").attr({"class":"active-assignment",cx:0,cy:15,r:5}),assignments.selectAll(".active-assignment").attr({fill:function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);return"Submitted"==assignment.status?"rgb(0, 121, 191)":"white"},stroke:function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);return"Submitted"==assignment.status?"white":"rgb(0, 121, 191)"}}),this.drawAssignmentTools()},drawAssignmentTools:function(){var assignmentsVis=this,assignmentsMeta=visUtils.parentContainer.selectAll(".task-view").selectAll(".assignment-meta").data(function(taskKey){return dataService.taskFromKey(taskKey).assignments.map(function(assignment){return dataService.keyFromAssignment(assignment)})});assignmentsMeta.exit().remove();var assignmentsMetaEnter=assignmentsMeta.enter().append("div").attr("class","assignment-meta");assignmentsMetaEnter.append("input").attr({"class":"worker-name readonly"}).on("click",function(){d3.select(this).classed("readonly",!1)}).on("blur",function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);this.value=assignment.task.is_human?assignment.worker.username:"Machine",d3.select(this).classed("readonly",!0)}),assignmentsMeta.selectAll(".worker-name").attr({placeholder:function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);return assignment.worker.username||!assignment.task.is_human?"":"Add new assignment"}}).on("keydown",function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);13==d3.event.keyCode&&assignment.task.is_human&&(assignment.worker.username?assignmentsVis.reassignAssignment(assignment,d3.select(this)):assignmentsVis.assign_task(assignment.task,d3.select(this)))}).each(function(assignmentKey){var assignment=dataService.assignmentFromKey(assignmentKey);this.value=assignment.task.is_human?assignment.worker.username:"Machine"})},assign_task:function(task,inputEl){var assignmentsVis=this;assignmentsVis.addingAssignment||(assignmentsVis.addingAssignment=!0,orchestraApi.assignTask(task,inputEl.node().value).then(function(){inputEl.node().blur(),dataService.updateData()},function(response){inputEl.node().value="",inputEl.node().blur();var errorMessage="Error assigning task.";400===response.status&&(errorMessage=response.data.message),alert(errorMessage)})["finally"](function(){assignmentsVis.addingAssignment=!1}))},reassignAssignment:function(assignment,inputEl){assignment.reassigning||(assignment.reassigning=!0,orchestraApi.reassignAssignment(assignment,inputEl.node().value).then(function(){assignment.worker.username=inputEl.node().value,assignmentsVis.draw()},function(response){inputEl.node().blur();var errorMessage="Error reassigning worker.";400===response.status&&(errorMessage=response.data.message),alert(errorMessage)})["finally"](function(){inputEl.node().blur(),inputEl.node().value=assignment.worker.username,assignment.reassigning=!1}))}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hlc3RyYS9wcm9qZWN0X21hbmFnZW1lbnQvanMvYXNzaWdubWVudHNWaXMuanMiXSwibmFtZXMiOlsic2VydmljZU1vZHVsZSIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiZGF0YVNlcnZpY2UiLCJvcmNoZXN0cmFBcGkiLCJpdGVyYXRpb25zVmlzIiwidmlzVXRpbHMiLCJfdmlzIiwiYXNzaWdubWVudHNWaXMiLCJhZGRpbmdBc3NpZ25tZW50Iiwic2V0dXAiLCJ2aXMiLCJ0aGlzIiwiZHJhdyIsInRhc2tzIiwicGFyZW50Q29udGFpbmVyIiwic2VsZWN0QWxsIiwiYXNzaWdubWVudHMiLCJkYXRhIiwidGFza0tleSIsInRhc2tGcm9tS2V5IiwibWFwIiwiYXNzaWdubWVudCIsImtleUZyb21Bc3NpZ25tZW50IiwicHVzaCIsImV4aXQiLCJyZW1vdmUiLCJhc3NpZ25tZW50c0VudGVyIiwiZW50ZXIiLCJhcHBlbmQiLCJhdHRyIiwiY2xhc3MiLCJjeCIsImN5IiwiciIsImZpbGwiLCJhc3NpZ25tZW50S2V5IiwiYXNzaWdubWVudEZyb21LZXkiLCJzdGF0dXMiLCJzdHJva2UiLCJkcmF3QXNzaWdubWVudFRvb2xzIiwiYXNzaWdubWVudHNNZXRhIiwiYXNzaWdubWVudHNNZXRhRW50ZXIiLCJvbiIsImQzIiwic2VsZWN0IiwiY2xhc3NlZCIsInZhbHVlIiwidGFzayIsImlzX2h1bWFuIiwid29ya2VyIiwidXNlcm5hbWUiLCJwbGFjZWhvbGRlciIsImV2ZW50Iiwia2V5Q29kZSIsInJlYXNzaWduQXNzaWdubWVudCIsImFzc2lnbl90YXNrIiwiZWFjaCIsImlucHV0RWwiLCJhc3NpZ25UYXNrIiwibm9kZSIsInRoZW4iLCJibHVyIiwidXBkYXRlRGF0YSIsInJlc3BvbnNlIiwiZXJyb3JNZXNzYWdlIiwibWVzc2FnZSIsImFsZXJ0IiwicmVhc3NpZ25pbmciXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0UsWUFFQSxJQUFJQSxlQUFnQkMsUUFB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QUFNVSxRQUFRRSxPQUFPYixPQUMxQ2MsS0FBSyxXQUNKSCxRQUFRRSxPQUFPRSxPQUNmM0QsWUFBWTRELGNBQ1gsU0FBU0MsVUFDVk4sUUFBUUUsT0FBT2IsTUFBUSxHQUN2QlcsUUFBUUUsT0FBT0UsTUFDZixJQUFJRyxjQUFlLHVCQUNLLE9BQXBCRCxTQUFTMUIsU0FDWDJCLGFBQWVELFNBQVM5QyxLQUFLZ0QsU0FFL0JDLE1BQU1GLGdCQVhWN0QsV0FhVyxXQUNQSSxlQUFlQyxrQkFBbUIsTUFHeEM4QyxtQkFBb0IsU0FBU2pDLFdBQVlvQyxTQUtuQ3BDLFdBQVc4QyxjQUdmOUMsV0FBVzhDLGFBQWMsRUFDekJoRSxhQUFhbUQsbUJBQW1CakMsV0FBWW9DLFFBQVFFLE9BQU9iLE9BQ3hEYyxLQUFLLFdBQ0p2QyxXQUFXNEIsT0FBT0MsU0FBV08sUUFBUUUsT0FBT2IsTUFDNUN2QyxlQUFlSyxRQUNkLFNBQVNtRCxVQUNWTixRQUFRRSxPQUFPRSxNQUNmLElBQUlHLGNBQWUsMkJBQ0ssT0FBcEJELFNBQVMxQixTQUNYMkIsYUFBZUQsU0FBUzlDLEtBQUtnRCxTQUUvQkMsTUFBTUYsZ0JBVlY3RCxXQVlXLFdBQ1BzRCxRQUFRRSxPQUFPRSxPQUNmSixRQUFRRSxPQUFPYixNQUFRekIsV0FBVzRCLE9BQU9DLFNBQ3pDN0IsV0FBVzhDLGFBQWMiLCJmaWxlIjoib3JjaGVzdHJhL3Byb2plY3RfbWFuYWdlbWVudC9qcy9hc3NpZ25tZW50c1Zpcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgc2VydmljZU1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdvcmNoZXN0cmEucHJvamVjdF9tYW5hZ2VtZW50LnNlcnZpY2VzJyk7XG5cbiAgc2VydmljZU1vZHVsZS5mYWN0b3J5KCdhc3NpZ25tZW50c1ZpcycsIGZ1bmN0aW9uKGRhdGFTZXJ2aWNlLCBvcmNoZXN0cmFBcGksIGl0ZXJhdGlvbnNWaXMsIHZpc1V0aWxzKSB7XG4gICAgLyoqXG4gICAgICogU2VydmljZSB0byBtb2R1bGFyaXplIGFzc2lnbm1lbnQgdmlzdWFsaXphdGlvbiBhbmQgbWFuaXB1bGF0aW9uIHdpdGhpblxuICAgICAqIHRoZSBwcm9qZWN0IG1hbmFnZW1lbnQgdmlldy5cbiAgICAgKi9cbiAgICB2YXIgX3ZpcztcbiAgICB2YXIgYXNzaWdubWVudHNWaXM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWRkaW5nQXNzaWdubWVudDogZmFsc2UsXG4gICAgICBzZXR1cDogZnVuY3Rpb24odmlzKSB7XG4gICAgICAgIF92aXMgPSB2aXM7XG4gICAgICAgIGFzc2lnbm1lbnRzVmlzID0gdGhpcztcbiAgICAgIH0sXG4gICAgICBkcmF3OiBmdW5jdGlvbigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERyYXdzL3VwZGF0ZXMgYXNzaWdubWVudHMgd2l0aGluIHByb2plY3QgbWFuYWdlbWVudCB2aXN1YWxpemF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHRhc2tzID0gdmlzVXRpbHMucGFyZW50Q29udGFpbmVyLnNlbGVjdEFsbCgnLnRhc2snKTtcblxuICAgICAgICB2YXIgYXNzaWdubWVudHMgPSB0YXNrcy5zZWxlY3RBbGwoJy5hc3NpZ25tZW50JylcbiAgICAgICAgICAuZGF0YShmdW5jdGlvbih0YXNrS2V5KSB7XG4gICAgICAgICAgICB2YXIgYXNzaWdubWVudHMgPSBkYXRhU2VydmljZS50YXNrRnJvbUtleSh0YXNrS2V5KS5hc3NpZ25tZW50cy5tYXAoZnVuY3Rpb24oYXNzaWdubWVudCkge1xuICAgICAgICAgICAgICByZXR1cm4gZGF0YVNlcnZpY2Uua2V5RnJvbUFzc2lnbm1lbnQoYXNzaWdubWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFzc2lnbm1lbnRzLnB1c2goKTtcbiAgICAgICAgICAgIHJldHVybiBhc3NpZ25tZW50cztcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhc3NpZ25tZW50cy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHZhciBhc3NpZ25tZW50c0VudGVyID0gYXNzaWdubWVudHMuZW50ZXIoKS5hcHBlbmQoJ2cnKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdhc3NpZ25tZW50Jyk7XG5cbiAgICAgICAgaXRlcmF0aW9uc1Zpcy5kcmF3KCk7XG5cbiAgICAgICAgYXNzaWdubWVudHNFbnRlci5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgJ2NsYXNzJzogJ2FjdGl2ZS1hc3NpZ25tZW50JyxcbiAgICAgICAgICAgICdjeCc6IDAsXG4gICAgICAgICAgICAnY3knOiAxNSxcbiAgICAgICAgICAgICdyJzogNSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhc3NpZ25tZW50cy5zZWxlY3RBbGwoJy5hY3RpdmUtYXNzaWdubWVudCcpLmF0dHIoe1xuICAgICAgICAgICdmaWxsJzogZnVuY3Rpb24oYXNzaWdubWVudEtleSkge1xuICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBkYXRhU2VydmljZS5hc3NpZ25tZW50RnJvbUtleShhc3NpZ25tZW50S2V5KTtcbiAgICAgICAgICAgIHJldHVybiBhc3NpZ25tZW50LnN0YXR1cyA9PSAnU3VibWl0dGVkJyA/ICdyZ2IoMCwgMTIxLCAxOTEpJyA6ICd3aGl0ZSc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAnc3Ryb2tlJzogZnVuY3Rpb24oYXNzaWdubWVudEtleSkge1xuICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBkYXRhU2VydmljZS5hc3NpZ25tZW50RnJvbUtleShhc3NpZ25tZW50S2V5KTtcbiAgICAgICAgICAgIHJldHVybiBhc3NpZ25tZW50LnN0YXR1cyA9PSAnU3VibWl0dGVkJyA/ICd3aGl0ZScgOiAncmdiKDAsIDEyMSwgMTkxKSc7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmRyYXdBc3NpZ25tZW50VG9vbHMoKTtcbiAgICAgIH0sXG4gICAgICBkcmF3QXNzaWdubWVudFRvb2xzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERyYXdzIGFic29sdXRlLXBvc2l0aW5lZCBIVE1MIGVsZW1lbnRzIHRvIGFsbG93IGZvciBhc3NpZ25tZW50XG4gICAgICAgICAqIG1hbmlwdWxhdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHZhciBhc3NpZ25tZW50c1ZpcyA9IHRoaXM7XG4gICAgICAgIHZhciBhc3NpZ25tZW50c01ldGEgPSB2aXNVdGlscy5wYXJlbnRDb250YWluZXJcbiAgICAgICAgICAuc2VsZWN0QWxsKCcudGFzay12aWV3JylcbiAgICAgICAgICAuc2VsZWN0QWxsKCcuYXNzaWdubWVudC1tZXRhJylcbiAgICAgICAgICAuZGF0YShmdW5jdGlvbih0YXNrS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YVNlcnZpY2UudGFza0Zyb21LZXkodGFza0tleSkuYXNzaWdubWVudHNcbiAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbihhc3NpZ25tZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFTZXJ2aWNlLmtleUZyb21Bc3NpZ25tZW50KGFzc2lnbm1lbnQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhc3NpZ25tZW50c01ldGEuZXhpdCgpLnJlbW92ZSgpO1xuICAgICAgICB2YXIgYXNzaWdubWVudHNNZXRhRW50ZXIgPSBhc3NpZ25tZW50c01ldGEuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2Fzc2lnbm1lbnQtbWV0YScpO1xuXG4gICAgICAgIGFzc2lnbm1lbnRzTWV0YUVudGVyLmFwcGVuZCgnaW5wdXQnKVxuICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICdjbGFzcyc6ICd3b3JrZXItbmFtZSByZWFkb25seScsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuY2xhc3NlZCgncmVhZG9ubHknLCBmYWxzZSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAub24oJ2JsdXInLCBmdW5jdGlvbihhc3NpZ25tZW50S2V5KSB7XG4gICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9IGRhdGFTZXJ2aWNlLmFzc2lnbm1lbnRGcm9tS2V5KGFzc2lnbm1lbnRLZXkpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGFzc2lnbm1lbnQudGFzay5pc19odW1hbiA/IGFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lIDogJ01hY2hpbmUnO1xuICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmNsYXNzZWQoJ3JlYWRvbmx5JywgdHJ1ZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgYXNzaWdubWVudHNNZXRhLnNlbGVjdEFsbCgnLndvcmtlci1uYW1lJylcbiAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAncGxhY2Vob2xkZXInOiBmdW5jdGlvbihhc3NpZ25tZW50S2V5KSB7XG4gICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gZGF0YVNlcnZpY2UuYXNzaWdubWVudEZyb21LZXkoYXNzaWdubWVudEtleSk7XG4gICAgICAgICAgICAgIHJldHVybiBhc3NpZ25tZW50Lndvcmtlci51c2VybmFtZSB8fCAhYXNzaWdubWVudC50YXNrLmlzX2h1bWFuID8gJycgOiAnQWRkIG5ldyBhc3NpZ25tZW50JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGFzc2lnbm1lbnRLZXkpIHtcbiAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gZGF0YVNlcnZpY2UuYXNzaWdubWVudEZyb21LZXkoYXNzaWdubWVudEtleSk7XG4gICAgICAgICAgICBpZiAoZDMuZXZlbnQua2V5Q29kZSA9PSAxMyAmJiBhc3NpZ25tZW50LnRhc2suaXNfaHVtYW4pIHtcbiAgICAgICAgICAgICAgaWYgKCFhc3NpZ25tZW50Lndvcmtlci51c2VybmFtZSkge1xuICAgICAgICAgICAgICAgIGFzc2lnbm1lbnRzVmlzLmFzc2lnbl90YXNrKGFzc2lnbm1lbnQudGFzaywgZDMuc2VsZWN0KHRoaXMpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhc3NpZ25tZW50c1Zpcy5yZWFzc2lnbkFzc2lnbm1lbnQoYXNzaWdubWVudCwgZDMuc2VsZWN0KHRoaXMpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVhY2goZnVuY3Rpb24oYXNzaWdubWVudEtleSkge1xuICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBkYXRhU2VydmljZS5hc3NpZ25tZW50RnJvbUtleShhc3NpZ25tZW50S2V5KTtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBhc3NpZ25tZW50LnRhc2suaXNfaHVtYW4gPyBhc3NpZ25tZW50Lndvcmtlci51c2VybmFtZSA6ICdNYWNoaW5lJztcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBhc3NpZ25fdGFzazogZnVuY3Rpb24odGFzaywgaW5wdXRFbCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSBvcmNoZXN0cmFBcGkuYXNzaWduVGFzayBpbiB0aGVcbiAgICAgICAgICogdmlzdWFsaXphdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHZhciBhc3NpZ25tZW50c1ZpcyA9IHRoaXM7XG4gICAgICAgIGlmIChhc3NpZ25tZW50c1Zpcy5hZGRpbmdBc3NpZ25tZW50KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFzc2lnbm1lbnRzVmlzLmFkZGluZ0Fzc2lnbm1lbnQgPSB0cnVlO1xuICAgICAgICBvcmNoZXN0cmFBcGkuYXNzaWduVGFzayh0YXNrLCBpbnB1dEVsLm5vZGUoKS52YWx1ZSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlucHV0RWwubm9kZSgpLmJsdXIoKTtcbiAgICAgICAgICAgIGRhdGFTZXJ2aWNlLnVwZGF0ZURhdGEoKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkudmFsdWUgPSAnJztcbiAgICAgICAgICAgIGlucHV0RWwubm9kZSgpLmJsdXIoKTtcbiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAnRXJyb3IgYXNzaWduaW5nIHRhc2suJztcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhbGVydChlcnJvck1lc3NhZ2UpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhc3NpZ25tZW50c1Zpcy5hZGRpbmdBc3NpZ25tZW50ID0gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgcmVhc3NpZ25Bc3NpZ25tZW50OiBmdW5jdGlvbihhc3NpZ25tZW50LCBpbnB1dEVsKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGVzIHRoZSBwcm9taXNlIHJldHVybmVkIGJ5IG9yY2hlc3RyYUFwaS5yZWFzc2lnbkFzc2lnbm1lbnQgaW5cbiAgICAgICAgICogdGhlIHZpc3VhbGl6YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoYXNzaWdubWVudC5yZWFzc2lnbmluZykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhc3NpZ25tZW50LnJlYXNzaWduaW5nID0gdHJ1ZTtcbiAgICAgICAgb3JjaGVzdHJhQXBpLnJlYXNzaWduQXNzaWdubWVudChhc3NpZ25tZW50LCBpbnB1dEVsLm5vZGUoKS52YWx1ZSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lID0gaW5wdXRFbC5ub2RlKCkudmFsdWU7XG4gICAgICAgICAgICBhc3NpZ25tZW50c1Zpcy5kcmF3KCk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlucHV0RWwubm9kZSgpLmJsdXIoKTtcbiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAnRXJyb3IgcmVhc3NpZ25pbmcgd29ya2VyLic7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWxlcnQoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkuYmx1cigpO1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkudmFsdWUgPSBhc3NpZ25tZW50Lndvcmtlci51c2VybmFtZTtcbiAgICAgICAgICAgIGFzc2lnbm1lbnQucmVhc3NpZ25pbmcgPSBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfSk7XG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
