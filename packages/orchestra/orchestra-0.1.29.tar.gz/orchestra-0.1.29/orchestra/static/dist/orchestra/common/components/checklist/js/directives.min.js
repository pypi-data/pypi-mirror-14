!function(){"use strict";function orchestraChecklist($http,$timeout,$compile,orchestraService){return{restrict:"E",scope:{data:"=",author:"@?",imagePrefix:"@?"},link:function(scope,el,attr){var sampleItem={title:"Update the hero image (This is a sample item! Click on the text to edit or click to the right to expand.)",comments:[{author:"jane",timestamp:new Date(new Date-108e5),text:"The hero image you've chosen doesn't fit well with the color scheme. Try something less washed out?"},{author:"john",timestamp:new Date(new Date-72e5),text:"Sounds good! I swapped it out, what do you think? "},{author:"",text:"This is a sample checklist comment. You can add a new comment for each new round of iteration on your work!"}],checked:!1,expanded:!1,readonly:!0,index:0,order:0};scope.data=scope.data||{},scope.data.items=scope.data.items||[sampleItem],scope.data.deletedItems=scope.data.deletedItems||[],scope.hideCompleted=!1,orchestraService.signals.registerSignal("submit.before",function(){scope.data.items.forEach(function(item){item.comments[item.comments.length-1].text&&(item.comments[item.comments.length-1].author=scope.author,item.comments[item.comments.length-1].timestamp=Date.now(),item.comments.push({author:"",text:""}))})}),orchestraService.signals.registerSignal("submit.error",function(){scope.data.items.forEach(function(item){item.comments[item.comments.length-1].text&&(item.comments.pop(),item.comments[item.comments.length-1].author="",item.comments[item.comments.length-1].timestamp=void 0)})}),scope.preventAction=!1;var checklistContainer=el.find("ul.checklist"),drake=dragula([checklistContainer.get(0)],{moves:function(el,container,handle){return handle.className.indexOf("checklist-item")>=0||handle.className.indexOf("item-title-input")>=0&&handle.className.indexOf("readonly")>=0||handle.className.indexOf("item-title")>=0&&handle.className.indexOf("item-title-input")<0},invalid:function(el,target){return scope.preventAction}});drake.on("drag",function(){scope.preventAction=!0,scope.$apply()}),drake.on("dragend",function(){setOrder(),scope.preventAction=!1,scope.$apply()});var setOrder=function(){for(var items=el.get(0).querySelectorAll(".checklist-item"),i=0;i<items.length;i++){var item=items[i];getItemByKey(item.getAttribute("data-key")).order=i}},getItemByKey=function(key){for(var item,i=scope.data.items.length-1;i>=0;i--)if(item=scope.data.items[i],item.$$hashKey===key)return item};scope.addItem=function(){scope.data.items.push({title:"",comments:[{author:scope.author,text:""}],checked:!1,expanded:!1,readonly:!0,order:scope.data.items.length})},scope.removeItem=function(item,confirm_needed){var index=scope.data.items.indexOf(item);confirm_needed&&!confirm("Are you sure you want to delete this item?")||(scope.preventAction=!0,scope.data.items.splice(index,1),scope.data.deletedItems.push(item),$timeout(function(){setOrder(),scope.preventAction=!1},0,!1))},scope.editItem=function(item,$event){item.readonly&&($event&&$event.target.focus(),scope.data.items.forEach(function(scopeItem){scopeItem.readonly=!0})),item.readonly=!item.readonly},scope.expandItem=function(item){item.expanded=!item.expanded,scope.data.items.forEach(function(scopeItem){scopeItem.readonly=!0})},scope.getCommentTimestamp=function(comment){return new Date(comment.timestamp).toLocaleString()}},templateUrl:"/static/orchestra/common/components/checklist/partials/checklist.html"}}function orchestraChecklistItem($http,$timeout,$compile,orchestraService){return{restrict:"E",link:function(scope,el,attr){scope.autosizeInput=function(elem,ghost,minWidth,str){function escape(str){return str.replace(SPACE,"&nbsp;").replace(LESS_THAN,"&lt;").replace(MORE_THAN,"&gt;")}var SPACE=/\s/g,LESS_THAN=/>/g,MORE_THAN=/</g;str=str||elem.value||"";var elemStyle=window.getComputedStyle(elem),elemCssText="font-family:"+elemStyle.fontFamily+";font-size:"+elemStyle.fontSize;ghost.style.cssText+=elemCssText,ghost.innerHTML=escape(str);var width=window.getComputedStyle(ghost).width;return"0px"===width&&(width=minWidth),elem.style.width=width,width},scope.setupAutosizer=function(elem){var ghost=document.createElement("div");ghost.className="ghost",ghost.style.cssText="box-sizing:content-box;display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(ghost),elem.style.boxSizing="content-box";var minWidth=scope.autosizeInput(elem,ghost,0,elem.getAttribute("placeholder"));elem.addEventListener("input",function(){scope.autosizeInput(elem,ghost,minWidth)}),$timeout(function(){scope.autosizeInput(elem,ghost,minWidth)},0)},scope.setupAutosizer(el.find(".item-title input").get(0))},templateUrl:"/static/orchestra/common/components/checklist/partials/checklist-item.html"}}angular.module("orchestra.common.components.directives").directive("orchestraChecklist",["$http","$timeout","$compile","orchestraService",orchestraChecklist]),angular.module("orchestra.common.components.directives").directive("orchestraChecklistItem",["$http","$timeout","$compile","orchestraService",orchestraChecklistItem])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hlc3RyYS9jb21tb24vY29tcG9uZW50cy9jaGVja2xpc3QvanMvZGlyZWN0aXZlcy5qcyJdLCJuYW1lcyI6WyJvcmNoZXN0cmFDaGVja2xpc3QiLCIkaHR0cCIsIiR0aW1lb3V0IiwiJGNvbXBpbGUiLCJvcmNoZXN0cmFTZXJ2aWNlIiwicmVzdHJpY3QiLCJzY29wZSIsImRhdGEiLCJhdXRob3IiLCJpbWFnZVByZWZpeCIsImxpbmsiLCJlbCIsImF0dHIiLCJzYW1wbGVJdGVtIiwidGl0bGUiLCJjb21tZW50cyIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0ZXh0IiwiY2hlY2tlZCIsImV4cGFuZGVkIiwicmVhZG9ubHkiLCJpbmRleCIsIm9yZGVyIiwiaXRlbXMiLCJkZWxldGVkSXRlbXMiLCJoaWRlQ29tcGxldGVkIiwic2lnbmFscyIsInJlZ2lzdGVyU2lnbmFsIiwiZm9yRWFjaCIsIml0ZW0iLCJsZW5ndGgiLCJub3ciLCJwdXNoIiwicG9wIiwidW5kZWZpbmVkIiwicHJldmVudEFjdGlvbiIsImNoZWNrbGlzdENvbnRhaW5lciIsImZpbmQiLCJkcmFrZSIsImRyYWd1bGEiLCJnZXQiLCJtb3ZlcyIsImNvbnRhaW5lciIsImhhbmRsZSIsImNsYXNzTmFtZSIsImluZGV4T2YiLCJpbnZhbGlkIiwidGFyZ2V0Iiwib24iLCIkYXBwbHkiLCJzZXRPcmRlciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpIiwiZ2V0SXRlbUJ5S2V5IiwiZ2V0QXR0cmlidXRlIiwia2V5IiwiJCRoYXNoS2V5IiwiYWRkSXRlbSIsInJlbW92ZUl0ZW0iLCJjb25maXJtX25lZWRlZCIsImNvbmZpcm0iLCJzcGxpY2UiLCJlZGl0SXRlbSIsIiRldmVudCIsImZvY3VzIiwic2NvcGVJdGVtIiwiZXhwYW5kSXRlbSIsImdldENvbW1lbnRUaW1lc3RhbXAiLCJjb21tZW50IiwidG9Mb2NhbGVTdHJpbmciLCJ0ZW1wbGF0ZVVybCIsIm9yY2hlc3RyYUNoZWNrbGlzdEl0ZW0iLCJhdXRvc2l6ZUlucHV0IiwiZWxlbSIsImdob3N0IiwibWluV2lkdGgiLCJzdHIiLCJlc2NhcGUiLCJyZXBsYWNlIiwiU1BBQ0UiLCJMRVNTX1RIQU4iLCJNT1JFX1RIQU4iLCJ2YWx1ZSIsImVsZW1TdHlsZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJlbGVtQ3NzVGV4dCIsImZvbnRGYW1pbHkiLCJmb250U2l6ZSIsInN0eWxlIiwiY3NzVGV4dCIsImlubmVySFRNTCIsIndpZHRoIiwic2V0dXBBdXRvc2l6ZXIiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJib3hTaXppbmciLCJhZGRFdmVudExpc3RlbmVyIiwiYW5ndWxhciIsIm1vZHVsZSIsImRpcmVjdGl2ZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDRSxZQU1BLFNBQVNBLG9CQUFtQkMsTUFBT0MsU0FBVUMsU0FBVUMsa0JBQ3JELE9BQ0VDLFNBQVUsSUFDVkMsT0FDRUMsS0FBUSxJQUNSQyxPQUFVLEtBQ1ZDLFlBQWUsTUFFakJDLEtBQU0sU0FBU0osTUFBT0ssR0FBSUMsTUFDeEIsR0FBSUMsYUFDRkMsTUFBUyw0R0FHVEMsV0FDRVAsT0FBVSxPQUNWUSxVQUFhLEdBQUlDLE1BQUssR0FBSUEsTUFBUyxPQUNuQ0MsS0FBUSx3R0FJUlYsT0FBVSxPQUNWUSxVQUFhLEdBQUlDLE1BQUssR0FBSUEsTUFBUyxNQUNuQ0MsS0FBUSx1REFHUlYsT0FBVSxHQUNWVSxLQUFRLGdIQUlWQyxTQUFXLEVBQ1hDLFVBQVksRUFDWkMsVUFBWSxFQUNaQyxNQUFTLEVBQ1RDLE1BQVMsRUFJWGpCLE9BQU1DLEtBQU9ELE1BQU1DLFNBQ25CRCxNQUFNQyxLQUFLaUIsTUFBUWxCLE1BQU1DLEtBQUtpQixRQUFVWCxZQUN4Q1AsTUFBTUMsS0FBS2tCLGFBQWVuQixNQUFNQyxLQUFLa0IsaUJBQ3JDbkIsTUFBTW9CLGVBQWdCLEVBR3RCdEIsaUJBQWlCdUIsUUFBUUMsZUFBZSxnQkFBaUIsV0FDdkR0QixNQUFNQyxLQUFLaUIs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LGFBQWEsZUFHckVtQixNQUFLMEIsaUJBQWlCLFFBQVMsV0FDN0I5RixNQUFNbUUsY0FBY0MsS0FBTUMsTUFBT0MsWUFJbkMxRSxTQUFTLFdBQ1BJLE1BQU1tRSxjQUFjQyxLQUFNQyxNQUFPQyxXQUNoQyxJQUdMdEUsTUFBTXdGLGVBQWVuRixHQUFHMkIsS0FBSyxxQkFBcUJHLElBQUksS0FFeEQ4QixZQUFhLDhFQW5RakI4QixRQUNHQyxPQUFPLDBDQUNQQyxVQUFVLHNCQUF1QixRQUFTLFdBQVksV0FBWSxtQkFBb0J2RyxxQkF3THpGcUcsUUFDR0MsT0FBTywwQ0FDUEMsVUFBVSwwQkFBMkIsUUFBUyxXQUFZLFdBQVksbUJBQW9CL0IiLCJmaWxlIjoib3JjaGVzdHJhL2NvbW1vbi9jb21wb25lbnRzL2NoZWNrbGlzdC9qcy9kaXJlY3RpdmVzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdvcmNoZXN0cmEuY29tbW9uLmNvbXBvbmVudHMuZGlyZWN0aXZlcycpXG4gICAgLmRpcmVjdGl2ZSgnb3JjaGVzdHJhQ2hlY2tsaXN0JywgWyckaHR0cCcsICckdGltZW91dCcsICckY29tcGlsZScsICdvcmNoZXN0cmFTZXJ2aWNlJywgb3JjaGVzdHJhQ2hlY2tsaXN0XSk7XG5cbiAgZnVuY3Rpb24gb3JjaGVzdHJhQ2hlY2tsaXN0KCRodHRwLCAkdGltZW91dCwgJGNvbXBpbGUsIG9yY2hlc3RyYVNlcnZpY2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgICdkYXRhJzogJz0nLFxuICAgICAgICAnYXV0aG9yJzogJ0A/JyxcbiAgICAgICAgJ2ltYWdlUHJlZml4JzogJ0A/JyxcbiAgICAgIH0sXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHIpIHtcbiAgICAgICAgdmFyIHNhbXBsZUl0ZW0gPSB7XG4gICAgICAgICAgJ3RpdGxlJzogJ1VwZGF0ZSB0aGUgaGVybyBpbWFnZSAnICtcbiAgICAgICAgICAgICcoVGhpcyBpcyBhIHNhbXBsZSBpdGVtISBDbGljayBvbiB0aGUgdGV4dCB0byBlZGl0IG9yICcgK1xuICAgICAgICAgICAgJ2NsaWNrIHRvIHRoZSByaWdodCB0byBleHBhbmQuKScsXG4gICAgICAgICAgJ2NvbW1lbnRzJzogW3tcbiAgICAgICAgICAgICdhdXRob3InOiAnamFuZScsXG4gICAgICAgICAgICAndGltZXN0YW1wJzogbmV3IERhdGUobmV3IERhdGUoKSAtIDMgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICAndGV4dCc6IFwiVGhlIGhlcm8gaW1hZ2UgeW91J3ZlIGNob3NlbiBkb2Vzbid0IGZpdCBcIiArXG4gICAgICAgICAgICAgICd3ZWxsIHdpdGggdGhlIGNvbG9yIHNjaGVtZS4gVHJ5IHNvbWV0aGluZyAnICtcbiAgICAgICAgICAgICAgJ2xlc3Mgd2FzaGVkIG91dD8nXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgJ2F1dGhvcic6ICdqb2huJyxcbiAgICAgICAgICAgICd0aW1lc3RhbXAnOiBuZXcgRGF0ZShuZXcgRGF0ZSgpIC0gMiAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgICAgICd0ZXh0JzogJ1NvdW5kcyBnb29kISBJIHN3YXBwZWQgaXQgb3V0LCB3aGF0IGRvICcgK1xuICAgICAgICAgICAgICAneW91IHRoaW5rPyAnXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgJ2F1dGhvcic6ICcnLFxuICAgICAgICAgICAgJ3RleHQnOiAnVGhpcyBpcyBhIHNhbXBsZSBjaGVja2xpc3QgY29tbWVudC4gJyArXG4gICAgICAgICAgICAgICdZb3UgY2FuIGFkZCBhIG5ldyBjb21tZW50IGZvciBlYWNoIG5ldyAnICtcbiAgICAgICAgICAgICAgJ3JvdW5kIG9mIGl0ZXJhdGlvbiBvbiB5b3VyIHdvcmshJ1xuICAgICAgICAgIH1dLFxuICAgICAgICAgICdjaGVja2VkJzogZmFsc2UsXG4gICAgICAgICAgJ2V4cGFuZGVkJzogZmFsc2UsXG4gICAgICAgICAgJ3JlYWRvbmx5JzogdHJ1ZSxcbiAgICAgICAgICAnaW5kZXgnOiAwLFxuICAgICAgICAgICdvcmRlcic6IDBcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIGNoZWNrbGlzdCBkYXRhIGZvciBhIGZyZXNoIHRhc2tcbiAgICAgICAgc2NvcGUuZGF0YSA9IHNjb3BlLmRhdGEgfHwge307XG4gICAgICAgIHNjb3BlLmRhdGEuaXRlbXMgPSBzY29wZS5kYXRhLml0ZW1zIHx8IFtzYW1wbGVJdGVtXTtcbiAgICAgICAgc2NvcGUuZGF0YS5kZWxldGVkSXRlbXMgPSBzY29wZS5kYXRhLmRlbGV0ZWRJdGVtcyB8fCBbXTtcbiAgICAgICAgc2NvcGUuaGlkZUNvbXBsZXRlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8vIFByZXBhcmUgZGF0YSBmb3Igc3VibWl0XG4gICAgICAgIG9yY2hlc3RyYVNlcnZpY2Uuc2lnbmFscy5yZWdpc3RlclNpZ25hbCgnc3VibWl0LmJlZm9yZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNjb3BlLmRhdGEuaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAvLyBBZGQgYXV0aG9yIGFuZCBkYXRlIGluZm9ybWF0aW9uIHRvIHRoZSBsYXRlc3QgY29tbWVudC4gVGhlbixcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBjb21tZW50IHNwYWNlIGZvciB0aGUgbmV4dCB3b3JrZXIuXG4gICAgICAgICAgICBpZiAoaXRlbS5jb21tZW50c1tpdGVtLmNvbW1lbnRzLmxlbmd0aCAtIDFdLnRleHQpIHtcbiAgICAgICAgICAgICAgaXRlbS5jb21tZW50c1tpdGVtLmNvbW1lbnRzLmxlbmd0aCAtIDFdLmF1dGhvciA9IHNjb3BlLmF1dGhvcjtcbiAgICAgICAgICAgICAgaXRlbS5jb21tZW50c1tpdGVtLmNvbW1lbnRzLmxlbmd0aCAtIDFdLnRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgIGl0ZW0uY29tbWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgJ2F1dGhvcic6ICcnLFxuICAgICAgICAgICAgICAgICd0ZXh0JzogJydcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG9yY2hlc3RyYVNlcnZpY2Uuc2lnbmFscy5yZWdpc3RlclNpZ25hbCgnc3VibWl0LmVycm9yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc2NvcGUuZGF0YS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIC8vIFJldmVydCBjb21tZW50IGNoYW5nZXMgZnJvbSBzdWJtaXQuYmVmb3JlIGhhbmRsZXJcbiAgICAgICAgICAgIGlmIChpdGVtLmNvbW1lbnRzW2l0ZW0uY29tbWVudHMubGVuZ3RoIC0gMV0udGV4dCkge1xuICAgICAgICAgICAgICBpdGVtLmNvbW1lbnRzLnBvcCgpO1xuICAgICAgICAgICAgICBpdGVtLmNvbW1lbnRzW2l0ZW0uY29tbWVudHMubGVuZ3RoIC0gMV0uYXV0aG9yID0gJyc7XG4gICAgICAgICAgICAgIGl0ZW0uY29tbWVudHNbaXRlbS5jb21tZW50cy5sZW5ndGggLSAxXS50aW1lc3RhbXAgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldHVwIGRyYWcgdG8gcmVvcmRlclxuICAgICAgICBzY29wZS5wcmV2ZW50QWN0aW9uID0gZmFsc2U7XG4gICAgICAgIHZhciBjaGVja2xpc3RDb250YWluZXIgPSBlbC5maW5kKCd1bC5jaGVja2xpc3QnKTtcbiAgICAgICAgdmFyIGRyYWtlID0gZHJhZ3VsYShbY2hlY2tsaXN0Q29udGFpbmVyLmdldCgwKV0sIHtcbiAgICAgICAgICBtb3ZlczogZnVuY3Rpb24oZWwsIGNvbnRhaW5lciwgaGFuZGxlKSB7XG4gICAgICAgICAgICAvLyBJdGVtIHRpdGxlIGlucHV0IG9ubHkgd2hlbiByZWFkb25seSAoc28gdXNlciBjYW4gc2VsZWN0IHRleHQgd2l0aGluIGlucHV0KVxuICAgICAgICAgICAgLy8gSXRlbSB0aXRsZSBjb250YWluZXIgb3V0c2lkZSBvZiBpbnB1dFxuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZS5jbGFzc05hbWUuaW5kZXhPZignY2hlY2tsaXN0LWl0ZW0nKSA+PSAwIHx8IChoYW5kbGUuY2xhc3NOYW1lLmluZGV4T2YoJ2l0ZW0tdGl0bGUtaW5wdXQnKSA+PSAwICYmIGhhbmRsZS5jbGFzc05hbWUuaW5kZXhPZigncmVhZG9ubHknKSA+PSAwKSB8fCAoaGFuZGxlLmNsYXNzTmFtZS5pbmRleE9mKCdpdGVtLXRpdGxlJykgPj0gMCAmJiBoYW5kbGUuY2xhc3NOYW1lLmluZGV4T2YoJ2l0ZW0tdGl0bGUtaW5wdXQnKSA8IDApO1xuXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnZhbGlkOiBmdW5jdGlvbihlbCwgdGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gc2NvcGUucHJldmVudEFjdGlvbjtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFByZXZlbnQgYW5vdGhlciBkcmFnIGZyb20gb2NjdXJpbmcgdW50aWwgdGhlIGN1cnJlbnQgZHJhZyBpc1xuICAgICAgICAvLyBjb21wbGV0ZWQgYW5kIHRoZSBuZXcgb3JkZXIgaXMgc2V0LlxuICAgICAgICBkcmFrZS5vbignZHJhZycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNjb3BlLnByZXZlbnRBY3Rpb24gPSB0cnVlO1xuICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZHJha2Uub24oJ2RyYWdlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBzZXRPcmRlcigpO1xuICAgICAgICAgIHNjb3BlLnByZXZlbnRBY3Rpb24gPSBmYWxzZTtcbiAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lcyBhbmQgc2F2ZXMgdGhlIG9yZGVyIGNoYW5nZWQgYnkgZHJhZyBldmVudFxuICAgICAgICB2YXIgc2V0T3JkZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgaXRlbXMgPSBlbC5nZXQoMCkucXVlcnlTZWxlY3RvckFsbCgnLmNoZWNrbGlzdC1pdGVtJyk7XG5cbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgZ2V0SXRlbUJ5S2V5KGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWtleScpKS5vcmRlciA9IGk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFJldHJpZXZlcyBjaGVja2xpc3QgaXRlbSBiYXNlZCBvbiBhbmd1bGFyIG9iamVjdCBrZXlcbiAgICAgICAgdmFyIGdldEl0ZW1CeUtleSA9IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgIHZhciBtYXRjaDtcbiAgICAgICAgICB2YXIgaXRlbTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gc2NvcGUuZGF0YS5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgaXRlbSA9IHNjb3BlLmRhdGEuaXRlbXNbaV07XG4gICAgICAgICAgICBpZiAoaXRlbS4kJGhhc2hLZXkgPT09IGtleSkge1xuICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIG5ldyBjaGVja2xpc3QgaXRlbVxuICAgICAgICBzY29wZS5hZGRJdGVtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc2NvcGUuZGF0YS5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICd0aXRsZSc6ICcnLFxuICAgICAgICAgICAgJ2NvbW1lbnRzJzogW3tcbiAgICAgICAgICAgICAgJ2F1dGhvcic6IHNjb3BlLmF1dGhvcixcbiAgICAgICAgICAgICAgJ3RleHQnOiAnJ1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAnY2hlY2tlZCc6IGZhbHNlLFxuICAgICAgICAgICAgJ2V4cGFuZGVkJzogZmFsc2UsXG4gICAgICAgICAgICAncmVhZG9ubHknOiB0cnVlLFxuICAgICAgICAgICAgJ29yZGVyJzogc2NvcGUuZGF0YS5pdGVtcy5sZW5ndGhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBSZW1vdmUgY2hlY2tsaXN0IGl0ZW1cbiAgICAgICAgc2NvcGUucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uKGl0ZW0sIGNvbmZpcm1fbmVlZGVkKSB7XG4gICAgICAgICAgdmFyIGluZGV4ID0gc2NvcGUuZGF0YS5pdGVtcy5pbmRleE9mKGl0ZW0pO1xuICAgICAgICAgIGlmICghY29uZmlybV9uZWVkZWQgfHwgY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGl0ZW0/JykpIHtcbiAgICAgICAgICAgIHNjb3BlLnByZXZlbnRBY3Rpb24gPSB0cnVlO1xuICAgICAgICAgICAgc2NvcGUuZGF0YS5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgc2NvcGUuZGF0YS5kZWxldGVkSXRlbXMucHVzaChpdGVtKTtcblxuICAgICAgICAgICAgLy8gUmVzZXQgb3JkZXIgYWZ0ZXIgJGRpZ2VzdCBibG9jayAob25jZSBpdGVtIGhhcyBiZWVuIHJlbW92ZWQpXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0T3JkZXIoKTtcbiAgICAgICAgICAgICAgc2NvcGUucHJldmVudEFjdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSwgMCwgZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBbGxvdyBjaGVja2xpc3QgdGl0bGUgdG8gYmUgZWRpdGVkXG4gICAgICAgIHNjb3BlLmVkaXRJdGVtID0gZnVuY3Rpb24oaXRlbSwgJGV2ZW50KSB7XG4gICAgICAgICAgaWYgKGl0ZW0ucmVhZG9ubHkpIHtcbiAgICAgICAgICAgIC8vIEl0ZW0gd2lsbCBiZWNvbWUgZWRpdGFibGVcbiAgICAgICAgICAgIGlmICgkZXZlbnQpIHtcbiAgICAgICAgICAgICAgLy8gU2V0IGZvY3VzIG9uIGlucHV0XG4gICAgICAgICAgICAgICRldmVudC50YXJnZXQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNjb3BlLmRhdGEuaXRlbXMuZm9yRWFjaChmdW5jdGlvbihzY29wZUl0ZW0pIHtcbiAgICAgICAgICAgICAgc2NvcGVJdGVtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtLnJlYWRvbmx5ID0gIWl0ZW0ucmVhZG9ubHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gRXhwYW5kIGNoZWNrbGlzdCBpdGVtIHRvIHNob3cgY29tbWVudHNcbiAgICAgICAgc2NvcGUuZXhwYW5kSXRlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICBpdGVtLmV4cGFuZGVkID0gIWl0ZW0uZXhwYW5kZWQ7XG4gICAgICAgICAgc2NvcGUuZGF0YS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKHNjb3BlSXRlbSkge1xuICAgICAgICAgICAgc2NvcGVJdGVtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBSZXR1cm4gbG9jYWxpemVkIGNvbW1lbnQgdGltZXN0YW1wXG4gICAgICAgIHNjb3BlLmdldENvbW1lbnRUaW1lc3RhbXAgPSBmdW5jdGlvbihjb21tZW50KSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGNvbW1lbnQudGltZXN0YW1wKS50b0xvY2FsZVN0cmluZygpO1xuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9vcmNoZXN0cmEvY29tbW9uL2NvbXBvbmVudHMvY2hlY2tsaXN0L3BhcnRpYWxzL2NoZWNrbGlzdC5odG1sJ1xuICAgIH07XG4gIH1cblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnb3JjaGVzdHJhLmNvbW1vbi5jb21wb25lbnRzLmRpcmVjdGl2ZXMnKVxuICAgIC5kaXJlY3RpdmUoJ29yY2hlc3RyYUNoZWNrbGlzdEl0ZW0nLCBbJyRodHRwJywgJyR0aW1lb3V0JywgJyRjb21waWxlJywgJ29yY2hlc3RyYVNlcnZpY2UnLCBvcmNoZXN0cmFDaGVja2xpc3RJdGVtXSk7XG5cbiAgZnVuY3Rpb24gb3JjaGVzdHJhQ2hlY2tsaXN0SXRlbSgkaHR0cCwgJHRpbWVvdXQsICRjb21waWxlLCBvcmNoZXN0cmFTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHIpIHtcbiAgICAgICAgLy8gRHluYW1pY2FsbHkgYXV0b3NpemUgYSB0ZXh0IGlucHV0IHRvIGZpdCBpdHMgY29udGVudHMuXG4gICAgICAgIC8vIE1vZGlmaWVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL3l1YW5xaW5nL2F1dG9zaXplLWlucHV0IChNSVQgbGljZW5zZSkuXG4gICAgICAgIHNjb3BlLmF1dG9zaXplSW5wdXQgPSBmdW5jdGlvbihlbGVtLCBnaG9zdCwgbWluV2lkdGgsIHN0cikge1xuICAgICAgICAgIC8vIENvbXBpbGUgYW5kIGNhY2hlIHRoZSBuZWVkZWQgcmVndWxhciBleHByZXNzaW9ucy5cbiAgICAgICAgICB2YXIgU1BBQ0UgPSAvXFxzL2c7XG4gICAgICAgICAgdmFyIExFU1NfVEhBTiA9IC8+L2c7XG4gICAgICAgICAgdmFyIE1PUkVfVEhBTiA9IC88L2c7XG5cbiAgICAgICAgICAvLyBXZSBuZWVkIHRvIHN3YXAgb3V0IHRoZXNlIGNoYXJhY3RlcnMgd2l0aCB0aGVpciBjaGFyYWN0ZXItZW50aXR5XG4gICAgICAgICAgLy8gZXF1aXZhbGVudHMgYmVjYXVzZSB3ZSdyZSBhc3NpZ25pbmcgdGhlIHJlc3VsdGluZyBzdHJpbmcgdG9cbiAgICAgICAgICAvLyBgZ2hvc3QuaW5uZXJIVE1MYC5cbiAgICAgICAgICBmdW5jdGlvbiBlc2NhcGUoc3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoU1BBQ0UsICcmbmJzcDsnKVxuICAgICAgICAgICAgICAucmVwbGFjZShMRVNTX1RIQU4sICcmbHQ7JylcbiAgICAgICAgICAgICAgLnJlcGxhY2UoTU9SRV9USEFOLCAnJmd0OycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHN0ciA9IHN0ciB8fCBlbGVtLnZhbHVlIHx8ICcnO1xuXG4gICAgICAgICAgLy8gQXBwbHkgdGhlIGBmb250LXNpemVgIGFuZCBgZm9udC1mYW1pbHlgIHN0eWxlcyBvZiBgZWxlbWAgb24gdGhlXG4gICAgICAgICAgLy8gYGdob3N0YCBlbGVtZW50LlxuICAgICAgICAgIHZhciBlbGVtU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtKTtcbiAgICAgICAgICB2YXIgZWxlbUNzc1RleHQgPSAnZm9udC1mYW1pbHk6JyArIGVsZW1TdHlsZS5mb250RmFtaWx5ICtcbiAgICAgICAgICAgICc7Zm9udC1zaXplOicgKyBlbGVtU3R5bGUuZm9udFNpemU7XG5cbiAgICAgICAgICBnaG9zdC5zdHlsZS5jc3NUZXh0ICs9IGVsZW1Dc3NUZXh0O1xuICAgICAgICAgIGdob3N0LmlubmVySFRNTCA9IGVzY2FwZShzdHIpO1xuICAgICAgICAgIHZhciB3aWR0aCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGdob3N0KS53aWR0aDtcbiAgICAgICAgICBpZiAod2lkdGggPT09ICcwcHgnKSB7XG4gICAgICAgICAgICB3aWR0aCA9IG1pbldpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbGVtLnN0eWxlLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgcmV0dXJuIHdpZHRoO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0aGF0OlxuICAgICAgICAvLyAxLiBDb3BpZXMgdGhlIGBmb250LWZhbWlseWAgYW5kIGBmb250LXNpemVgIG9mIG91ciBgZWxlbWAgb250byBgZ2hvc3RgXG4gICAgICAgIC8vIDIuIFNldHMgdGhlIGNvbnRlbnRzIG9mIGBnaG9zdGAgdG8gdGhlIHNwZWNpZmllZCBgc3RyYFxuICAgICAgICAvLyAzLiBDb3BpZXMgdGhlIHdpZHRoIG9mIGBnaG9zdGAgb250byBvdXIgYGVsZW1gXG4gICAgICAgIHNjb3BlLnNldHVwQXV0b3NpemVyID0gZnVuY3Rpb24oZWxlbSkge1xuICAgICAgICAgIC8vIENyZWF0ZSB0aGUgYGdob3N0YCBlbGVtZW50LCB3aXRoIGlubGluZSBzdHlsZXMgdG8gaGlkZSBpdCBhbmQgZW5zdXJlIHRoYXRcbiAgICAgICAgICAvLyB0aGUgdGV4dCBpcyBhbGwgb24gYSBzaW5nbGUgbGluZS5cbiAgICAgICAgICB2YXIgZ2hvc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBnaG9zdC5jbGFzc05hbWUgPSAnZ2hvc3QnO1xuICAgICAgICAgIGdob3N0LnN0eWxlLmNzc1RleHQgPSAnYm94LXNpemluZzpjb250ZW50LWJveDtkaXNwbGF5OmlubGluZS1ibG9jaztoZWlnaHQ6MDtvdmVyZmxvdzpoaWRkZW47cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7dmlzaWJpbGl0eTpoaWRkZW47d2hpdGUtc3BhY2U6bm93cmFwOyc7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChnaG9zdCk7XG5cbiAgICAgICAgICAvLyBGb3JjZSBgY29udGVudC1ib3hgIG9uIHRoZSBgZWxlbWAuXG4gICAgICAgICAgZWxlbS5zdHlsZS5ib3hTaXppbmcgPSAnY29udGVudC1ib3gnO1xuXG4gICAgICAgICAgdmFyIG1pbldpZHRoID0gc2NvcGUuYXV0b3NpemVJbnB1dChlbGVtLCBnaG9zdCwgMCwgZWxlbS5nZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJykpO1xuXG4gICAgICAgICAgLy8gQXV0b3NpemUgaW5wdXQgb24gdmFsdWUgY2hhbmdlXG4gICAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2NvcGUuYXV0b3NpemVJbnB1dChlbGVtLCBnaG9zdCwgbWluV2lkdGgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQXV0b3NpemUgaW5wdXQgd2hlbiBjaGVja2xpc3QgaXRlbSBmaXJzdCBhZGRlZCB0byB0aGUgRE9NXG4gICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzY29wZS5hdXRvc2l6ZUlucHV0KGVsZW0sIGdob3N0LCBtaW5XaWR0aCk7XG4gICAgICAgICAgfSwgMCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2NvcGUuc2V0dXBBdXRvc2l6ZXIoZWwuZmluZCgnLml0ZW0tdGl0bGUgaW5wdXQnKS5nZXQoMCkpO1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9vcmNoZXN0cmEvY29tbW9uL2NvbXBvbmVudHMvY2hlY2tsaXN0L3BhcnRpYWxzL2NoZWNrbGlzdC1pdGVtLmh0bWwnXG4gICAgfTtcbiAgfVxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
