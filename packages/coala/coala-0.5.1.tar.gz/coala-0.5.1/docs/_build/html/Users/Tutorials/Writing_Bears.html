

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Guide to Write a Bear &mdash; coala 0.5.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="coala 0.5.1 documentation" href="../../index.html"/>
        <link rel="next" title="Linter Bears" href="Linter_Bears.html"/>
        <link rel="prev" title="coala Tutorial" href="Tutorial.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> coala
          

          
          </a>

          
            
            
              <div class="version">
                0.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome</a></li>
</ul>
<p class="caption"><span class="caption-text">For Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coafile.html">coafile Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glob_Patterns.html">Glob Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Exit_Codes.html">Exit Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../External_APIs.html">External APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Git_Hooks.html">Git Hooks</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html">First Step</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Writing Bears</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-bear">What is a bear?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-hello-world-bear">A Hello World Bear</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communicating-with-the-user">Communicating with the User</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-data-types-are-supported">What Data Types are Supported?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Linter_Bears.html">Linter Bears</a></li>
<li class="toctree-l1"><a class="reference internal" href="Self_Correcting_Bears.html">Linter Bears - Suggest corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="Git_Help.html">Git Help</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Involved</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Newcomers.html">Newcomers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Codestyle.html">Codestyle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Writing_Good_Commits.html">Commit Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Testing.html">Executing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Review.html">Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Writing_Tests.html">Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/Writing_Documentation.html">Writing Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting_Involved/MAC_Hints.html">MAC Hints</a></li>
</ul>
<p class="caption"><span class="caption-text">General Developer Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../General_Dev_Info/git_tutorial_1.html">A Hitchhiker&#8217;s Guide to Git (1): Genesis</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../API/modules.html">List of Modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">coala</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Guide to Write a Bear</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/Users/Tutorials/Writing_Bears.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="guide-to-write-a-bear">
<h1>Guide to Write a Bear<a class="headerlink" href="#guide-to-write-a-bear" title="Permalink to this headline">¶</a></h1>
<p>Welcome. This document presents information on how to write a bear for
coala. It assumes you know how to use coala. If not please read our main
tutorial!</p>
<p>The sample sources for this tutorial lie at our coala-tutorial
repository, go clone it with:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/coala-analyzer/coala-tutorial.git
</pre></div>
</div>
<p>All paths and commands given here are meant to be executed from the root
directory of the coala-tutorial repository.</p>
<div class="section" id="what-is-a-bear">
<h2>What is a bear?<a class="headerlink" href="#what-is-a-bear" title="Permalink to this headline">¶</a></h2>
<p>A bear is meant to do some analysis on source code. The source code will
be provided by coala so the bear doesn&#8217;t have to care where it comes from
or where it goes.</p>
<p>A bear can communicate with the user via two ways:</p>
<ul class="simple">
<li>Via log messages</li>
<li>Via results</li>
</ul>
<p>Log messages will be logged according to the users settings and are
usually used if something goes wrong. However you can use debug for
providing development related debug information since it will not be
shown to the user by default. If error/failure messages are used, the
bear is expected not to continue analysis.</p>
</div>
<div class="section" id="a-hello-world-bear">
<h2>A Hello World Bear<a class="headerlink" href="#a-hello-world-bear" title="Permalink to this headline">¶</a></h2>
<p>Below is the code given for a simple bear that sends a debug message for
each file:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">coalib.bears.LocalBear</span> <span class="kn">import</span> <span class="n">LocalBear</span>


<span class="k">class</span> <span class="nc">HelloWorldBear</span><span class="p">(</span><span class="n">LocalBear</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="nb">file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Hello World! Checking file&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This bear is stored at <code class="docutils literal"><span class="pre">./bears/HelloWorldBear</span></code></p>
<p>In order to let coala execute this bear you need to let coala know where
to find it. We can do that with the <code class="docutils literal"><span class="pre">-d</span></code> (<code class="docutils literal"><span class="pre">--bear-dirs</span></code>) argument:</p>
<p><code class="docutils literal"><span class="pre">coala</span> <span class="pre">-f</span> <span class="pre">src/*.c</span> <span class="pre">-d</span> <span class="pre">bears</span> <span class="pre">-b</span> <span class="pre">HelloWorldBear</span> <span class="pre">-L</span> <span class="pre">DEBUG</span></code></p>
<p>You should now see the debug message for our sample file.</p>
<p>The Bear class also supports <code class="docutils literal"><span class="pre">warn</span></code> and <code class="docutils literal"><span class="pre">err</span></code>.</p>
</div>
<div class="section" id="communicating-with-the-user">
<h2>Communicating with the User<a class="headerlink" href="#communicating-with-the-user" title="Permalink to this headline">¶</a></h2>
<p>Now we can send messages through the queue, we can do the real work.
Lets say:</p>
<ul class="simple">
<li>We want some information from the user (e.g. the tab width if we rely
on indentation)</li>
<li>We&#8217;ve got some useful information for the user and want to show it to
him. This might be some issue with his code or just an information
like the number of lines.</li>
</ul>
<p>So let&#8217;s extend our HelloWorldBear a bit, I&#8217;ve named the new bear with
the creative name CommunicationBear:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">coalib.bears.LocalBear</span> <span class="kn">import</span> <span class="n">LocalBear</span>
<span class="kn">from</span> <span class="nn">coalib.results.Result</span> <span class="kn">import</span> <span class="n">Result</span>


<span class="k">class</span> <span class="nc">CommunicationBear</span><span class="p">(</span><span class="n">LocalBear</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="nb">file</span><span class="p">,</span>
            <span class="n">user_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Communicates with the user.</span>

<span class="sd">        :param user_input: Arbitrary user input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got &#39;{ui}&#39; as user input of type {type}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">ui</span><span class="o">=</span><span class="n">user_input</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">user_input</span><span class="p">)))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Result</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;A hello world result.&quot;</span><span class="p">,</span>
                                   <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="nb">file</span><span class="o">=</span><span class="n">filename</span><span class="p">)]</span>
</pre></div>
</div>
<p>Try executing it:</p>
<div class="highlight-python"><div class="highlight"><pre>coala -f=src/\*.c -d=bears -b=CommunicationBear -L=DEBUG
</pre></div>
</div>
<p>Hey, we&#8217;ll get asked for the user_input! Wasn&#8217;t that easy? Go ahead,
enter something and observe the output.</p>
<p>So, what did coala do here?</p>
<p>First, coala looked at the parameters of the run method and found that
we need some value named user_input. Then it parsed our documentation
comment and found a description for the parameter which was shown to us
to help us choose the right value. After the needed values are provided,
coala converts us the value into a string because we&#8217;ve provided the
<code class="docutils literal"><span class="pre">str</span></code> annotation for this parameter. If no annotation is given or the
value isn&#8217;t convertible into the desired data type, you will get a
<code class="docutils literal"><span class="pre">coalib.settings.Setting.Setting</span></code>.</p>
<p>Your docstring can also be used to tell the user what exactly your bear
does.</p>
<p>Try executing</p>
<div class="highlight-python"><div class="highlight"><pre>coala -d bears -b CommunicationBear --show-bears
</pre></div>
</div>
<p>This will show the user a bunch of information related to the bear like:
- A description of what the bear does - The sections which uses it - The
settings it uses (optional and required)</p>
<div class="section" id="what-data-types-are-supported">
<h3>What Data Types are Supported?<a class="headerlink" href="#what-data-types-are-supported" title="Permalink to this headline">¶</a></h3>
<p>The Setting does support some very basic types:</p>
<ul class="simple">
<li>String (<code class="docutils literal"><span class="pre">str</span></code>)</li>
<li>Float (<code class="docutils literal"><span class="pre">float</span></code>)</li>
<li>Int (<code class="docutils literal"><span class="pre">int</span></code>)</li>
<li>Boolean (<code class="docutils literal"><span class="pre">bool</span></code>, will accept values like <code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">yes</span></code>,
<code class="docutils literal"><span class="pre">yeah</span></code>, <code class="docutils literal"><span class="pre">no</span></code>, <code class="docutils literal"><span class="pre">nope</span></code>, <code class="docutils literal"><span class="pre">false</span></code>)</li>
<li>List of strings (<code class="docutils literal"><span class="pre">list</span></code>, values will be split by comma)</li>
<li>Dict of strings (<code class="docutils literal"><span class="pre">dict</span></code>, values will be split by comma and colon)</li>
</ul>
<p>If you need another type, you can write the conversion function yourself
and use this function as the annotation. We&#8217;ve provided a few advanced
conversions for you:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">coalib.settings.Setting.path</span></code>, converts to an absolute file path
relative to the file/command where the setting was set</li>
<li><code class="docutils literal"><span class="pre">coalib.settings.Setting.path_list</span></code>, converts to a list of absolute
file paths relative to the file/command where the setting was set</li>
<li><code class="docutils literal"><span class="pre">coalib.settings.Setting.typed_list(typ)</span></code>, converts to a list and
applies the given conversion (<code class="docutils literal"><span class="pre">typ</span></code>) to each element.</li>
<li><code class="docutils literal"><span class="pre">coalib.settings.Setting.typed_ordered_dict(key_type,</span> <span class="pre">value_type,</span>
<span class="pre">default)</span></code>, converts to a dict while applying the <code class="docutils literal"><span class="pre">key_type</span></code>
conversion to all keys, the <code class="docutils literal"><span class="pre">value_type</span></code> conversion to all values
and uses the <code class="docutils literal"><span class="pre">default</span></code> value for all unset keys. Use <code class="docutils literal"><span class="pre">typed_dict</span></code>
if the order is irrelevant for you.</li>
</ul>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>In the end we&#8217;ve got a result. If a file is provided, coala will show
the file, if a line is provided, coala will also show a few lines before
the affecting line. There are a few parameters to the Result
constructor, so you can e.g. create a result that proposes a code change
to the user. If the user likes it, coala will apply it automatically -
you don&#8217;t need to care.</p>
<p>Your function needs to return an iterable of <code class="docutils literal"><span class="pre">Result</span></code> objects: that
means you can either return a <code class="docutils literal"><span class="pre">list</span></code> of <code class="docutils literal"><span class="pre">Result</span></code> objects or simply
yield them and write the method as a generator.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>We are currently planning to simplify Bears for bear writers and us.
In order to make your Bear future proof, we recommend writing your
method in generator style.</p>
<p class="last">Don&#8217;t worry: in order to migrate your Bears to our new API, you will
likely only need to change two lines of code. For more information
about how bears will look in the future, please read up on
<a class="reference external" href="https://github.com/coala-analyzer/coala/issues/725">https://github.com/coala-analyzer/coala/issues/725</a> or ask us on
<a class="reference external" href="https://gitter.im/coala-analyzer/coala">https://gitter.im/coala-analyzer/coala</a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Linter_Bears.html" class="btn btn-neutral float-right" title="Linter Bears" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Tutorial.html" class="btn btn-neutral" title="coala Tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, The coala Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>