!function(e){function t(s){if(i[s])return i[s].exports;var r=i[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="/assets/",t(0)}({0:function(e,t,i){"use strict";var s=i(43);window.addEventListener("DOMContentLoaded",s.init.bind(s)),window.viewer=s},24:function(e,t,i){"use strict";var s=i(25),r=function(e,t){this.hierarchy=e,this._depth=e.length,t.classes||(t.classes={}),this.options=t;var i;if(this._eventListeners={onchange:[],onaction:[],onselect:[],oncategoryedit:[]},t.events)for(i in this._eventListeners)this._eventListeners.hasOwnProperty(i)&&t.events[i]&&this._eventListeners[i].push(t.events[i]);if(this._callbacks={onload:null,onmove:null,ondropto:null},t.callbacks)for(i in this._callbacks)this._callbacks.hasOwnProperty(i)&&t.callbacks[i]&&(this._callbacks[i]=t.callbacks[i]);this._categories=[],this._rootChildren=[],this._lastIds=[],this._groups={},this._lastGroupId=0,this._currentGroupId=null,this._currentCategory=null,this._smiles={},this._selectedSmileIds=[],this._lastSelectedSmileId=null,this._smileMovePosId=null,this._lastCreatedSmileId=0,this._lazyCategoriesQueue=[],this._lazyProcessing=0,t.lazyStep?this._lazyStep=t.lazyStep:navigator.userAgent.toLowerCase().indexOf("chrome")>=0?this._lazyStep=15:this._lazyStep=3,this._lazyCallback=this._lazyLoaded.bind(this),this._selectedIds=[],this._initDOM(),this._initDOMTabs(),s.add(this._dom.container,{onstart:this._dragStart.bind(this),onmove:this._dragMove.bind(this),onmoveto:this._dragMoveTo.bind(this),ondropto:this._dragDropTo.bind(this),ontransitionend:this._dragEnd.bind(this),onclick:this._smileClickEvent.bind(this)});for(var r=Array.prototype.slice.apply(this._dom.container.querySelectorAll(".temporary")),n=r.length-1;n>=0;n--)r[n].parentNode.removeChild(r[n])};r.prototype._initDOM=function(){var e=this.options,t=e.classes;this._dom={},this._dom.container=e.container||document.createElement("div");var i=this._dom.container;i.addEventListener("click",this._onclick.bind(this)),t.container&&!i.classList.contains(t.container)&&i.classList.add(t.container),this._dom.tabsContainer=i.getElementsByClassName(t.tabsWrapper||"tabs-wrapper")[0],this._dom.tabsContainer||(this._dom.tabsContainer=document.createElement("div"),this._dom.tabsContainer.className=t.tabsWrapper||"tabs-wrapper",i.appendChild(this._dom.tabsContainer)),this._dom.message=i.getElementsByClassName(t.message||"collection-message")[0],this._dom.message||(this._dom.message=document.createElement("div"),this._dom.message.className=t.message||"collection-message",this._dom.message.textContent=e.message||"",i.appendChild(this._dom.message)),this._dom.smilesContainer=i.getElementsByClassName(t.smilesContainer||"collection-smiles")[0],this._dom.smilesContainer||(this._dom.smilesContainer=document.createElement("div"),this._dom.smilesContainer.className=t.smilesContainer||"collection-smiles",i.appendChild(this._dom.smilesContainer)),this._dom.dropHint=document.createElement("div"),this._dom.dropHint.className="drop-hint",this._dom.dropHint.style.display="none",this._dom.smilesContainer.appendChild(this._dom.dropHint)},r.prototype._initDOMTabs=function(){this._dom.tabsContainers=[];for(var e=0;e<this._depth;e++){this._categories.push({}),this._lastIds.push(0),this._selectedIds.push(null);var t=document.createElement("div");if(t.className=this.options.classes.tabsLevel||"tabs-level",t.dataset.level=e.toString(),e>0&&(t.style.display="none"),this.hierarchy[e][2]&&t.appendChild(document.createTextNode(this.hierarchy[e][2])),this.options.editable){var i=document.createElement("a");i.className="action-btn action-add",i.dataset.action="add",i.dataset.level=e.toString(),i.href="#",t.appendChild(i)}this._dom.tabsContainers.push(t),this._dom.tabsContainer.appendChild(t)}this._depth>0&&(this._dom.rootCategories=this._buildDomTabs(0,0),this._dom.rootCategories.style.display="")},r.prototype.getDOM=function(){return this._dom.container},r.prototype.setCallback=function(e,t){if(void 0===this._callbacks[e])throw new Error("Unknown event "+e);this._callbacks[e]=t},r.prototype.subscribe=function(e,t){if(void 0===this._eventListeners[e])throw new Error("Unknown event "+e);this._eventListeners[e].push(t)},r.prototype.callListeners=function(e,t){for(var i=this._eventListeners[e],s=0;s<i.length;s++)i[s].apply(this,t)},r.prototype.loadData=function(e){this._loadDataLevel(e[this.hierarchy[0][0]],0,0)},r.prototype.isTabsVisible=function(){return"none"!=this._dom.tabsContainer.style.display},r.prototype.setTabsVisibility=function(e){this._dom.tabsContainer.style.display=e?"":"none"},r.prototype.getLoadingVisibility=function(){return this._dom.container.classList.contains("smiles-processing")},r.prototype.setLoadingVisibility=function(e){this._dom.container.classList.contains("smiles-processing")!==e&&this._dom.container.classList.toggle("smiles-processing")},r.prototype.getLastInternalIds=function(){return[this._lastIds,this._lastCreatedSmileId]},r.prototype.setLastInternalIds=function(e,t){for(var i=0;i<this._depth;i++)this._lastIds[i]=parseInt(e[i],10);this._lastCreatedSmileId=parseInt(t,10)},r.prototype.addCategory=function(e,t,i){var s=e-1,r=e>0?this._categories[s][t]:null;if(e>0&&!r)return null;var n=i.id;return(void 0===n||null===n)&&(this._lastIds[e]--,n=this._lastIds[e]),this._categories[e][n]={id:n,parentId:e>0?t:null,level:e,name:i.name,description:i.description,empty:i.empty?!0:!1,dom:null,childrenDom:null,iconId:i.icon?i.icon.id:-1,iconUrl:i.icon?i.icon.url:null,childrenIds:e+1<this._depth?[]:null,groupId:null},this._buildCategoryDom(e,n,!0),this.callListeners("oncategoryedit",{categoryLevel:e,categoryId:n,added:!0,removed:!1}),n},r.prototype.editCategory=function(e,t,i){if(0>e||e>=this._depth||!this._categories[e][t])return null;var s=this._categories[e][t];i.hasOwnProperty("name")&&(s.name=i.name),i.hasOwnProperty("description")&&(s.description=i.description),i.hasOwnProperty("empty")&&(s.empty=i.empty?!0:!1),i.hasOwnProperty("icon")&&(s.iconId=i.icon?i.icon.id:-1,s.iconUrl=i.icon?i.icon.url:null);var r=this._buildCategoryDom(e,t,!1);this._selectedIds[e]==t&&r.classList.add("tab-btn-active");var n=s.dom.parentNode;return n.insertBefore(r,s.dom),n.removeChild(s.dom),s.dom=r,this.callListeners("oncategoryedit",{categoryLevel:e,categoryId:s.id,added:!1,removed:!1}),s.id},r.prototype.moveCategory=function(e,t,i){if(0>e||e>=this._depth)return!1;var s=this._categories[e][t];if(!s)return!1;var r=this._categories[e][i];if(void 0!==r&&null!==r&&!r)return!1;if(r&&r.id===s.id)return!0;if(r&&r.parentId!==s.parentId)return!1;var n=e>0?this._categories[e-1][s.parentId]:null,o=n?n.childrenIds:this._rootChildren;o.splice(o.indexOf(s.id),1),r?o.splice(o.indexOf(r.id),0,s.id):o.push(s.id);var l=n?n.childrenDom:this._dom.rootCategories;return r?l.insertBefore(s.dom,r.dom):l.appendChild(s.dom),!0},r.prototype.removeCategory=function(e,t){if(0>e||e>=this._depth)return null;var i=this._categories[e][t];if(!i)return null;var s=[];if(this._selectedIds[e]==t&&this.selectCategory(e,null),this._currentCategory&&this._currentCategory[0]==e&&this._currentCategory[1]==t&&this._showGroupNow(null),e+1<this._depth)for(;i.childrenIds.length>0;)Array.prototype.push.apply(s,this.removeCategory(e+1,i.childrenIds[0]));null!==i.groupId&&Array.prototype.push.apply(s,this.removeGroup(i.groupId)),i.dom.parentNode&&i.dom.parentNode.removeChild(i.dom),i.dom=null,i.childrenDom&&i.childrenDom.parentNode&&(i.childrenDom.parentNode.removeChild(i.childrenDom),i.childrenDom=null),delete this._categories[e][t];var r;return e>0?(r=this._categories[e-1][i.parentId].childrenIds.indexOf(t),r>-1&&this._categories[e-1][i.parentId].childrenIds.splice(r,1)):(r=this._rootChildren.indexOf(t),r>-1&&this._rootChildren.splice(r,1)),this.callListeners("oncategoryedit",{categoryLevel:e,categoryId:i.id,added:!1,removed:!0}),s},r.prototype.createGroup=function(e){var t=++this._lastGroupId;return e=e||{},this._groups[t]={id:t,dom:null,smileIds:[],lazyQueue:[],openedClass:e.openedClass||"smiles-opened",description:e.description||"",categoryLevel:null,categoryId:null},t},r.prototype.createGroupForCategory=function(e,t,i){var s=this._categories[e][t];return s&&null===s.groupId?(i=i||{},void 0===i.description&&(i.description=s.description),i.openedClass||(i.openedClass="smiles-opened"),s.groupId=this.createGroup(i),this._groups[s.groupId].categoryLevel=e,this._groups[s.groupId].categoryId=s.id,this.callListeners("oncategoryedit",{categoryLevel:e,categoryId:s.id,added:!1,removed:!1}),s.groupId):null},r.prototype.removeGroup=function(e){var t=this._groups[e];if(!t)return null;this._currentGroupId===t.id&&this.showGroup(null);for(var i=0;i<t.smileIds.length;i++){var s=this._smiles[t.smileIds[i]];delete s.groups[t.id]}return t.dom&&t.dom.parentNode.removeChild(t.dom),delete this._groups[e],t.smileIds},r.prototype.selectCategory=function(e,t,i){if(0>e||e>=this._depth)return!1;var s=this._categories[e][t];if(null!==t&&!s)return!1;if(this._selectedIds[e]==t)return!0;if(s&&e>0&&this.selectCategory(e-1,s.parentId),null!==this._selectedIds[e])for(var r=e;r<this._depth&&null!==this._selectedIds[r];r++)this._categories[r][this._selectedIds[r]].dom.classList.remove("tab-btn-active"),r+1<this._depth&&(this._categories[r][this._selectedIds[r]].childrenDom.style.display="none",this._dom.tabsContainers[r+1].style.display="none"),this._selectedIds[r]=null;return s?(s.dom.classList.add("tab-btn-active"),this._selectedIds[e]=t,e+1<this._depth&&s.childrenDom?(this._dom.tabsContainers[e+1].style.display="",s.childrenDom.style.display=""):null!==s.groupId&&this.showGroup(s.groupId,i),e+1===this._depth-1&&null!==this._currentCategory&&this._currentCategory[0]===e+1&&this._categories[e+1][this._currentCategory[1]].dom.classList.add("tab-btn-active"),!0):!0},r.prototype.showCategory=function(e,t,i){if(void 0===t||null===t)return this._showGroupNow(null);if(isNaN(e)||0>e||e>=this._depth)return!1;var s=this._categories[e][t];return s&&null!==s.groupId?this.showGroup(s.groupId,i):!1},r.prototype.showGroup=function(e,t){if(void 0===e||null===e)return this._showGroupNow(null);var i=this._groups[e];if(!i)return!1;if(!i.dom&&i.smileIds.length<1&&!t&&this._callbacks.onload){var s={groupId:i.id};if(null!==i.categoryId&&(s.categoryLevel=i.categoryLevel,s.categoryId=i.categoryId),this._callbacks.onload(this,s))return this.setLoadingVisibility(!0),null===this._currentGroupId&&(this._dom.message.textContent=i.description||""),!0}var r=this._currentCategory;return null!==r&&(this._categories[r[0]][r[1]].dom.classList.remove("tab-btn-active"),this._selectedIds[this._depth-1]===r[1]&&(this._selectedIds[this._depth-1]=null)),this._showGroupNow(i.id)?(null!==i.categoryId&&this._categories[i.categoryLevel][i.categoryId].dom.classList.add("tab-btn-active"),!0):!1},r.prototype.getCategoryInfo=function(e,t,i){if(void 0===e||null===e||isNaN(e)||0>e||e>=this._depth)return null;var s=this._categories[e][t];if(!s)return null;var r={name:s.name,description:s.description,icon:s.iconUrl?{id:null!==s.iconId?parseInt(s.iconId):null,url:i&&i.withoutIconUrl?void 0:s.iconUrl}:null};return i&&i["short"]||(r.level=s.level),i&&i.withoutIds||(r.id=s.id),i&&i.withGroupId&&(r.groupId=s.groupId),i&&i.withParent&&(r.parentId=s.parentId),r},r.prototype.getCategoryIdsWithSmiles=function(){for(var e=[],t=0;t<this._depth;t++)for(var i in this._categories[t])null!==this._categories[t][i].groupId&&e.push([t,i]);return e},r.prototype.getCategoriesWithHierarchy=function(e){var t,i,s,r=[],n=[];for(t=0;t<this._depth;t++){n.push({});for(s in this._categories[t])i=this.getCategoryInfo(t,s,e),t+1<this._depth&&(i[this.hierarchy[t+1][0]]=[]),t>0?n[t-1][this._categories[t][s].parentId][this.hierarchy[t][0]].push(i):r.push(i),n[t][i.id]=i}return r},r.prototype.getCategoryIds=function(){for(var e=[],t=function(e){return parseInt(e,10)},i=0;i<this._categories.length;i++){var s=Object.keys(this._categories[i]).map(t);e.push(s)}return e},r.prototype.getCategoryChildrenIds=function(e,t){if(void 0===e||null===e||isNaN(e)||0>e||e>=this._depth)return null;if(0===e)return this._rootChildren.slice();var i=this._categories[e-1][t];return i&&null!==i.childrenIds?i.childrenIds.slice():null},r.prototype.getSelectedCategory=function(e){return this._selectedIds[e]},r.prototype.getCurrentCategory=function(){return null===this._currentCategory?null:[this._currentCategory[0],this._currentCategory[1]]},r.prototype.getCurrentGroupId=function(){return this._currentGroupId},r.prototype.getGroupOfCategory=function(e,t){if(void 0===e||null===e||isNaN(e)||0>e||e>=this._depth)return null;var i=this._categories[e][t];return i?i.groupId:null},r.prototype.getParentId=function(e,t){return void 0===e||null===e||isNaN(e)||0>e||e>=this._depth?null:this._categories[e][t]?this._categories[e][t].parentId:null},r.prototype.isCategoryLoaded=function(e,t){if(isNaN(e)||0>e||e>=this._depth)return null;var i=this._categories[e][t];return i&&null!==i.groupId?this.isGroupLoaded(i.groupId):null},r.prototype.isGroupLoaded=function(e){var t=this._groups[e];return t?Boolean(t.dom||t.smileIds.length>0):null},r.prototype.addSmile=function(e,t){if(!e)return null;var i,s=e.id;if((void 0===s||null===s||isNaN(s))&&(this._lastCreatedSmileId--,s=this._lastCreatedSmileId),this._smiles[s])return null;var r,n=[];for(i=0;e.groupIds&&i<e.groupIds.length;i++)r=e.groupIds[i],this._groups[r]&&n.push(r);var o=e.categoryLevel,l=e.categoryId;if(0!==n.length||void 0===l||null===l||isNaN(l))o=null,l=null;else{if(isNaN(o)||0>o||o>=this._depth)return null;if(!this._categories[o][l])return null;if(n.push(this._categories[o][l].groupId),null===n[0])return null}for(this._smiles[s]={id:s,groups:{},categoryLevel:null,categoryId:null,url:e.url,description:e.description,tags:e.tags||[],width:e.w,height:e.h,dragged:e.dragged||!1,selected:e.selected||!1,raw:e.hasOwnProperty("raw")?e.raw:e},i=0;i<n.length;i++)this.addSmileToGroup(s,n[i],t);return this._smiles[s].selected&&(null!==this._currentGroupId&&void 0!==this._smiles[s].groups[this._currentGroupId]?(this._selectedSmileIds.push(s),this._selectUpdated([s],[])):this._smiles[s].selected=!1),s},r.prototype.editSmile=function(e){var t=this._smiles[e.id];if(!t)return!1;var i=!1;if(e.hasOwnProperty("w")&&(t.width=e.w,i=!0),e.hasOwnProperty("h")&&(t.height=e.h,i=!0),e.hasOwnProperty("url")&&(t.url=e.url,i=!0),e.hasOwnProperty("description")&&(t.description=e.description||"",i=!0),e.hasOwnProperty("tags")&&(t.tags=e.tags||[],i=!0),i)for(var s in t.groups){var r=t.groups[s];r&&(r.src=t.url,r.width=t.width,r.height=t.height,r.title=e.description||e.tags.join(", ")||e.url)}return e.hasOwnProperty("dragged")&&this.setDragged(t.id,e.dragged),e.hasOwnProperty("selected")&&this.setSelected(t.id,e.selected),e.hasOwnProperty("raw")&&(t.raw=e.raw),!0},r.prototype.addSmileIfNotExists=function(e,t){if(void 0!==e.id&&null!==e.id&&this._smiles[e.id]){if(this._smiles[e.id].url!==e.url)throw new Error("Conflict");if(void 0!==e.categoryLevel&&void 0!==e.categoryId)this.addSmileToCategory(e.id,e.categoryLevel,e.categoryId);else if(e.groupIds&&e.groupIds.length>0)for(var i=0;i<e.groupIds.length;i++)this.addSmileToGroup(e.id,e.groupIds[i],t);return e.id}return this.addSmile(e,t)},r.prototype.addSmileToGroup=function(e,t,i){var s=this._smiles[e],r=this._groups[t];return s&&r?void 0!==s.groups[r.id]?!0:(s.groups[r.id]=null,r.smileIds.push(s.id),null!==r.categoryId&&(s.categoryLevel=r.categoryLevel,s.categoryId=r.categoryId,this._categories[r.categoryLevel][r.categoryId].empty&&this.editCategory(r.categoryLevel,r.categoryId,{empty:!1})),r.dom&&this._addSmileDom(s.id,r.id,i),!0):!1},r.prototype.addSmileToCategory=function(e,t,i,s){var r=this._smiles[e],n=this._categories[t][i];return r&&n&&null!==n.groupId&&this.addSmileToGroup(r.id,n.groupId,s)?!0:!1},r.prototype.removeSmile=function(e){if(!this._smiles[e])return!1;var t=this._selectedSmileIds.indexOf(e);return t>=0&&(this._selectedSmileIds.splice(t,1),this._lastSelectedSmileId==e&&(this._lastSelectedSmileId=null),this._selectUpdated([],[e])),this._removeSmileRaw(e),!0},r.prototype.removeManySmiles=function(e){for(var t,i,s=[],r=0;r<e.length;r++)t=e[r],this._smiles[t]&&(i=this._selectedSmileIds.indexOf(t),i>=0&&(this._selectedSmileIds.splice(i,1),this._lastSelectedSmileId===t&&(this._lastSelectedSmileId=null)),this._removeSmileRaw(t),s.push(t));return this._selectUpdated([],s),s},r.prototype.removeSmileFromGroup=function(e,t){var i=this._smiles[e];if(!i)return null;var s=this._groups[t];if(!s)return Object.keys(i.groups).length;var r=s.smileIds.indexOf(i.id);return 0>r?Object.keys(i.groups).length:(s.smileIds.splice(r,1),i.groups[s.id]&&s.dom.removeChild(i.groups[s.id]),delete i.groups[s.id],this._currentGroupId===s.id&&i.selected&&(r=this._selectedSmileIds.indexOf(e),r>=0&&this._selectedSmileIds.splice(r,1),i.selected=!1,this._selectUpdated([],[e])),null!==i.categoryId&&this._categories[i.categoryLevel][i.categoryId].groupId===s.id&&(0!==s.smileIds.length||this._categories[i.categoryLevel][i.categoryId].empty||this.editCategory(i.categoryLevel,i.categoryId,{empty:!0}),i.categoryLevel=null,i.categoryId=null),Object.keys(i.groups).length)},r.prototype.hasSmile=function(e){return void 0!==this._smiles[e]},r.prototype.getSmileInfo=function(e,t){var i=this._smiles[e];if(!i)return null;var s={url:i.url,w:i.width,h:i.height,description:i.description};return t&&t.withoutIds||(s.id=i.id),t&&t.withParent&&(s.categoryLevel=i.categoryLevel,s.categoryId=i.categoryId,s.groups=Object.keys(i.groups).map(function(e){return parseInt(e,10)})),t&&t.withRaw&&(s.raw=i.raw),s},r.prototype.getSmileRaw=function(e){var t=this._smiles[e];return t?t.raw:null},r.prototype.getSmileIdByDom=function(e){if(!e||!this._dom.smilesContainer.contains(e)||!e.classList.contains("smile"))return null;var t=this._smiles[parseInt(e.dataset.id)];return t?t.id:null},r.prototype.getSmileIdsOfCategory=function(e,t){return this._categories[e][t]?this.getSmileIds(this._categories[e][t].groupId):null},r.prototype.getSmileIds=function(e){return this._groups[e]?Array.prototype.slice.apply(this._groups[e].smileIds):null},r.prototype.getSmilesCountOfCategory=function(e,t){return this._categories[e][t]?this.getSmilesCount(this._categories[e][t].groupId):null},r.prototype.getSmilesCount=function(e){return this._groups[e]?this._groups[e].smileIds.length:null},r.prototype.getSelectedSmileIds=function(){return Array.prototype.slice.apply(this._selectedSmileIds)},r.prototype.getAllCategorizedSmileIds=function(e){var t={};if(void 0===e||null===e||isNaN(e))e=this._depth-1;else if(0>e||e>=this._depth)return t;var i;for(var s in this._categories[e])null!==this._categories[e][s].groupId&&(i=this._categories[e][s].groupId,i=this._groups[i],t[s]=Array.prototype.slice.apply(i.smileIds));return t},r.prototype.getLevelSmileIds=function(e){var t=[];if(void 0===e||null===e||isNaN(e))e=this._depth-1;else if(0>e||e>=this._depth)return t;var i;for(var s in this._categories[e])null!==this._categories[e][s].groupId&&(i=this._categories[e][s].groupId,i=this._groups[i],Array.prototype.push.apply(t,i.smileIds));return t},r.prototype.moveSmile=function(e,t,i){void 0===i&&(i=this._currentGroupId);var s=this._groups[i];if(!s)return!1;if(e==t)return!1;var r=this._smiles[e],n=null!==t?this._smiles[t]:null;if(!r||null!==t&&!n)return!1;if(n&&!n.groups[s.id])return!1;var o=s.smileIds.indexOf(r.id);return o>=0&&s.smileIds.splice(o,1),n?(s.dom&&s.dom.insertBefore(r.groups[s.id],n.groups[s.id]),o=s.smileIds.indexOf(n.id),s.smileIds.splice(o,0,r.id)):(s.dom&&s.dom.appendChild(r.groups[s.id]),s.smileIds.push(r.id)),!0},r.prototype.getDragged=function(e){var t=this._smiles[e];return t?t.dragged:null},r.prototype.setDragged=function(e,t){var i=this._smiles[e];if(!i)return!1;if(i.dragged!=t){i.dragged=!i.dragged;for(var s in i.groups)null!==i.groups[s]&&i.groups[s].classList.toggle("dragged");i.dragged&&i.selected&&!this.options.selectableDragged&&this.setSelected(e,!1)}return!0},r.prototype.getSelected=function(e){var t=this._smiles[e];return t?t.selected:null},r.prototype.setSelected=function(e,t){var i=this._smiles[e];return null===this._currentGroupId?!1:!i||t&&void 0===i.groups[this._currentGroupId]?!1:t&&i.dragged&&!this.options.selectableDragged?!1:(this._setSelectedRaw(i.id,t),!0)},r.prototype.toggleSelected=function(e){var t=this._smiles[e];return t?this.setSelected(t.id,!t.selected):!1},r.prototype.selectAll=function(e){var t;if(null===this._currentGroupId)return!1;var i=Array.prototype.slice.apply(this._groups[this._currentGroupId].smileIds);if(i.length<1)return!0;for(var s=[],r=[],n=0;n<i.length;n++)t=this._smiles[i[n]],(e||!t.dragged)&&(s.push(t.id),t.selected||(r.push(t.id),t.selected=!0,t.groups[this._currentGroupId]&&t.groups[this._currentGroupId].classList.add("selected")));return r.length<1?!0:(this._selectedSmileIds=s,this._lastSelectedSmileId=s[s.length-1],this._selectUpdated(r,[]),!0)},r.prototype.deselectAll=function(){var e;if(null===this._currentGroupId||0===this._selectedSmileIds.length)return!1;for(var t=Array.prototype.slice.apply(this._selectedSmileIds),i=0;i<t.length;i++)e=this._smiles[t[i]],e.selected=!1,e.groups[this._currentGroupId]&&e.groups[this._currentGroupId].classList.remove("selected");return this._selectedSmileIds=[],this._lastSelectedSmileId=null,this._selectUpdated([],t),!0},r.prototype.getDropPosition=function(){return this._smileMovePosId},r.prototype.typeOfElement=function(e){if(!e)return null;if(e.classList.contains("smile")){var t=parseInt(e.dataset.id),i=parseInt(e.dataset.groupId),s=this._smiles[t];return s&&s.groups[i]===e?{type:"smile",id:t,groupId:i}:null}return null},r.prototype._buildCategoryDom=function(e,t,i){var s=this._categories[e][t],r=document.createElement("a");if(r.className="tab-btn",r.dataset.id=t.toString(),r.dataset.level=e.toString(),r.href=!this.options.useCategoryLinks||e<this._depth-1?"#":"#"+t,r.title=s.description||"",s.iconUrl){var n=document.createElement("img");n.src=s.iconUrl,n.className="tab-icon",n.dataset.id=s.iconId,r.appendChild(n)}if(s.empty&&r.classList.add("tab-btn-empty"),r.appendChild(document.createTextNode(s.name)),this.options.editable){var o=document.createElement("span");o.className="actions";var l=document.createElement("a");l.className="action-btn action-edit",l.dataset.action="edit",o.appendChild(l);var a=document.createElement("a");a.className="action-btn action-delete",a.dataset.action="delete",o.appendChild(a),r.appendChild(o)}if(i){if(e<this._depth-1&&(s.childrenDom=this._buildDomTabs(e+1,t)),e>0){var d=this._categories[e-1][s.parentId];d.childrenIds.push(t),d.childrenDom.appendChild(r)}else this._rootChildren.push(t),this._dom.rootCategories.appendChild(r);s.dom=r}return r},r.prototype._showGroupNow=function(e){if(this.setLoadingVisibility(!1),this._currentGroupId===e)return!0;var t=null;if(null!==this._currentGroupId&&(t=this._groups[this._currentGroupId],this.deselectAll(),t.dom.style.display="none",this._dom.container.classList.remove(t.openedClass)),void 0===e||null===e)return null!==t&&(this._currentGroupId=null,this._currentCategory=null,this._dom.message.textContent=""),!0;var i=this._groups[e];if(!i.dom){i.dom=document.createElement("div"),i.dom.className="smiles-list",i.dom.dataset.groupId=i.id,this._dom.smilesContainer.appendChild(i.dom);for(var s=0;s<i.smileIds.length;s++)this._addSmileDom(i.smileIds[s],i.id)}i.dom.style.display="",this._dom.container.classList.add(i.openedClass),this._dom.message.textContent=i.description||"",this._currentGroupId=i.id,null!==i.categoryId?this._currentCategory=[i.categoryLevel,i.categoryId]:this._currentCategory=null;var r={groupId:i.id};return null!==this._currentCategory&&(r.categoryLevel=this._currentCategory[0],r.categoryId=this._currentCategory[1]),this.callListeners("onchange",[r]),!0},r.prototype._addSmileDom=function(e,t,i){var s=this._smiles[e],r=this._groups[t];if(s.groups[t]||r.smileIds.indexOf(s.id)<0)return!1;var n=document.createElement("img");return n.alt="",n.title=s.description||s.tags.join(", ")||s.url,n.width=s.width,n.height=s.height,n.classList.add("smile"),n.dataset.id=s.id.toString(),n.dataset.groupId=r.id.toString(),i||n.classList.add("smile-loading"),s.dragged&&n.classList.add("dragged"),s.selected&&this._currentGroupId==r.id&&n.classList.add("selected"),i?n.src=s.url:(n.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",n.dataset.src=s.url,r.lazyQueue.push(e),this._lazyCategoriesQueue.indexOf(r.id)<0&&this._lazyCategoriesQueue.push(r.id)),r.dom.appendChild(n),s.groups[r.id]=n,!i&&this._lazyProcessing<this._lazyStep&&this._lazyNext(),!0},r.prototype._removeSmileRaw=function(e){var t,i,s=this._smiles[e];for(var r in s.groups)t=this._groups[r],s.groups[r]&&t.dom.removeChild(s.groups[r]),i=t.smileIds.indexOf(s.id),i>=0&&(t.smileIds.splice(i,1),0===t.smileIds.length&&null!==t.categoryId&&this.editCategory(t.categoryLevel,t.categoryId,{empty:!0}));delete this._smiles[e]},r.prototype._setSelectedRaw=function(e,t,i){var s=this._smiles[e],r=!1;s.selected!=t&&(s.selected=!s.selected,s.groups[this._currentGroupId]&&s.groups[this._currentGroupId].classList.toggle("selected"));var n=this._selectedSmileIds.indexOf(s.id);return t&&0>n?(this._selectedSmileIds.push(s.id),r=!0):!t&&n>=0&&(this._selectedSmileIds.splice(n,1),r=!0),t?this._lastSelectedSmileId=s.id:(0===this._selectedSmileIds.length||this._lastSelectedSmileId===s.id)&&(this._lastSelectedSmileId=null),r&&!i&&(t?this._selectUpdated([s.id],[]):this._selectUpdated([],[s.id])),r},r.prototype._selectUpdated=function(e,t){this._selectedSmileIds.length>0!=this._dom.container.classList.contains("with-selection")&&this._dom.container.classList.toggle("with-selection"),this.callListeners("onselect",[{added:e,removed:t,current:Array.prototype.slice.apply(this._selectedSmileIds),groupId:this._currentGroupId,container:this}])},r.prototype._loadDataLevel=function(e,t,i){for(var s,r=0;r<e.length;r++){var n={};for(var o in e[r])e[r].hasOwnProperty(o)&&("smiles_count"!=o||n.hasOwnProperty("empty")?n[o]=e[r][o]:n.empty=0===e[r].smiles_count);s=this.addCategory(t,i,n),t+1<this._depth&&e[r][this.hierarchy[t+1][0]]&&this._loadDataLevel(e[r][this.hierarchy[t+1][0]],t+1,s)}},r.prototype._buildDomTabs=function(e,t){var i=e-1;if(e>0&&!this._categories[i][t])return null;var s=document.createElement("div");return s.className=this.options.classes.tabsItems||"tabs-items",s.style.display="none",e>0&&(s.dataset.id="tabs-"+t.toString()),this.options.editable?this._dom.tabsContainers[e].insertBefore(s,this._dom.tabsContainers[e].lastElementChild):this._dom.tabsContainers[e].appendChild(s),s},r.prototype._onclick=function(e){if(e.target===this._dom.container||null!==this._currentGroupId&&e.target===this._groups[this._currentGroupId].dom)return this.deselectAll(),!1;if(!e.target.classList.contains("smile")){for(var t=null,i=null,s=null;!i||!s;){if(t=t?t.parentNode:e.target,!t||t===this._dom.container||t===document.body){if(i||s)break;return}t.classList.contains("action-btn")?(i=t,l=i.dataset.action):t.classList.contains("tab-btn")&&(s=t)}var r=s&&s.dataset.id?parseInt(s.dataset.id):null,n=null!==r?parseInt(s.dataset.level):null,o=null!==n?this._categories[n][r]:null,l=i?i.dataset.action:null;if(l)return this.callListeners("onaction",[{container:this,action:l,level:o?o.level:parseInt(i.dataset.level),categoryId:r}]),e.preventDefault(),!1;if(null!==n){if(!this.selectCategory(n,r))return;return e.preventDefault(),!1}}},r.prototype._smileClickEvent=function(e){if(e.element.classList.contains("smile")&&e.element.dataset.id){var t=this._smiles[parseInt(e.element.dataset.id)];if(t&&this.options.selectable&&null!==this._currentGroupId){var i=this._groups[this._currentGroupId];if(e.event.shiftKey&&null===this._lastSelectedSmileId)this.setSelected(t.id,!0);else if(e.event.shiftKey&&null!==this._lastSelectedSmileId){var s=i.smileIds.indexOf(this._lastSelectedSmileId),r=i.smileIds.indexOf(t.id);if(s>r){var n=r;r=s,s=n}for(var o,l=[],a=s;r>=a;a++)o=this._smiles[i.smileIds[a]],!this.options.selectableDragged&&o.dragged||!this._setSelectedRaw(i.smileIds[a],!0,!0)||l.push(i.smileIds[a]);l.length>0&&this._selectUpdated(l,[])}else e.event.ctrlKey||e.event.metaKey||!(this._selectedSmileIds.length>1)&&t.selected?this.setSelected(t.id,!t.selected):(this.deselectAll(),this.setSelected(t.id,!0))}}},r.prototype._dragStart=function(e){var t=e.element;if(t===this._dom.container||t===this._dom.smilesContainer)return null;do{if(t.dataset.action)break;if(t.classList.contains("smile")&&!t.classList.contains("dragged")){var i=this._smiles[parseInt(t.dataset.id)];return i&&!i.dragged?t:null}if(this.options.editable&&t.classList.contains("tab-btn")){var s=parseInt(t.dataset.level),r=parseInt(t.dataset.id);if(this._categories[s]&&this._categories[s][r])return t}t=t.parentNode}while(t&&t!==this._dom.container&&t!==this._dom.smilesContainer);return null},r.prototype._dragMove=function(e){e.targetContainer!==this._dom.container&&(this._dom.dropHint.style.display="none");var t=e.element;t.classList.contains("smile")?(e.starting&&!t.classList.contains("dragged")&&this.setDragged(parseInt(t.dataset.id),!0),e.starting&&e.overlay&&e.overlay.dataset.src&&(e.overlay.src=e.overlay.dataset.src,delete e.overlay.dataset.src,e.overlay.classList.remove("smile-loading"))):t.classList.contains("tab-btn")&&e.starting&&!t.classList.contains("dragged")&&t.classList.add("dragged")},r.prototype._dragMoveTo=function(e){var t=e.element;if(t.classList.contains("smile")){if(this.options.editable){var i=this.getSmileIdByDom(e.mouseOver);this._calculateSmileMove(e.x,e.y,i)}}else t.classList.contains("tab-btn")},r.prototype._dragDropTo=function(e){var t=this._smileMovePosId;if(this._smileMovePosId=null,this._dom.dropHint.style.display="none",e.sourceContainer===this._dom.container&&this.options.editable){if(!e.element.classList.contains("smile"))return null;var i=this._smiles[e.element.dataset.id];if(!i)return null;var s=this._groups[this._currentGroupId],r=t;if(null===t){var n=this._smiles[s.smileIds[s.smileIds.length-1]],o=n.groups[this._currentGroupId].getBoundingClientRect();e.y>=o.bottom||e.y>=o.top&&e.x>=o.left||(r=i.id)}else i.id===t&&(r=i.id);var l={name:"move",beforeId:r};if(this._callbacks.onmove&&(l=this._callbacks.onmove({container:this,smileId:i.id,beforeId:r})||l),"move"===l.name)l.beforeId!==i.id&&this.moveSmile(i.id,l.beforeId);else if("nothing"!==l.name)throw new Error("Unknown action "+l.name);return null}if(!this._callbacks.ondropto)return null;var a=this._callbacks.ondropto({sourceContainerElement:e.sourceContainer,targetContainer:this,element:e.element,overlay:e.overlay,dropPosition:t});if(a&&"animateToSmile"==a.name){var d=this._smiles[a.id].groups[this._currentGroupId];return d?{name:"animate",targetElement:d}:(this.setDragged(a.id,!1),{name:"fadeOut"})}return a},r.prototype._dragEnd=function(e){if(!e.element)return null;var t=e.element;t.classList.contains("smile")?t.classList.contains("dragged")&&this.setDragged(parseInt(t.dataset.id),!1):t.classList.contains("tab-btn")&&t.classList.contains("dragged")&&t.classList.remove("dragged")},r.prototype._calculateSmileMove=function(e,t,i){if(void 0===i||null===i)return this._dom.dropHint.style.display="none",void(this._smileMovePosId=null);var s=this._smiles[i],r=this._groups[this._currentGroupId],n=s.groups[this._currentGroupId].getBoundingClientRect(),o=(e-n.left)/n.width,l=null;if(o>=.5?(l=r.smileIds.indexOf(s.id)+1,l=l>=r.smileIds.length?null:r.smileIds[l]):l=i,l!=this._smileMovePosId){this._smileMovePosId=l;var a=null;l==i?(a=r.smileIds.indexOf(i)-1,a=a>=0?this._smiles[r.smileIds[a]]:null):null!==l&&(a=this._smiles[l]);var d=a?a.groups[this._currentGroupId].getBoundingClientRect():null;d&&d.height<n.height?this._dom.dropHint.style.height=d.height+"px":this._dom.dropHint.style.height=n.height+"px",null!==l?s.groups[this._currentGroupId].parentNode.insertBefore(this._dom.dropHint,this._smiles[l].groups[this._currentGroupId]):s.groups[this._currentGroupId].parentNode.appendChild(this._dom.dropHint),
this._dom.dropHint.style.display=""}},r.prototype._lazyNext=function(){var e=this._currentGroupId;if(null!==e||0!==this._lazyCategoriesQueue.length){null===e&&(e=this._lazyCategoriesQueue[0]);for(var t=this._groups[e];0===t.lazyQueue.length;){var i=this._lazyCategoriesQueue.indexOf(e);if(i>=0&&this._lazyCategoriesQueue.splice(i,1),0===this._lazyCategoriesQueue.length)return;e=this._lazyCategoriesQueue[0],t=this._groups[e]}var s=t.lazyQueue.splice(0,1)[0],r=this._smiles[s].groups[e];r.addEventListener("load",this._lazyCallback),r.addEventListener("error",this._lazyCallback),this._lazyProcessing++,r.src=r.dataset.src,delete r.dataset.src}},r.prototype._lazyLoaded=function(e){e.target.classList.remove("smile-loading"),this._lazyProcessing--,e.target.removeEventListener("load",this._lazyCallback),e.target.removeEventListener("error",this._lazyCallback),this._lazyProcessing<this._lazyStep&&setTimeout(this._lazyNext.bind(this),0)},e.exports=r},25:function(e,t){"use strict";var i={transitionDuration:175,startMargin:4,_containers:[],_currentContainer:null,_currentElement:null,_overlay:null,_startPos:null,_startElementPos:null,_mouseOver:null,_started:!1,_callbacks:null,add:function(e,t){t.dom=e,this._containers.push(t);var i=function(e){return this._eventDown(e,t)}.bind(this);t._mousedown=i,e.addEventListener("mousedown",i)},_findContainer:function(e){if(!e)return null;for(var t=null,i=0;i<this._containers.length;i++)if(this._containers[i].dom.contains(e)){t=this._containers[i];break}return t},_buildOverlay:function(e,t){var i=e.cloneNode(!0);t=t||e.getBoundingClientRect(),i.addEventListener("click",this._eventPrevent),i.addEventListener("mousedown",this._eventPrevent);for(var s,r,n,o,l,a=[[e,i]];a.length>0;){s=a.pop(),r=s[0],n=s[1];var d=getComputedStyle(r),h=getComputedStyle(n);for(l=d.length,o=0;l>o;o++){var c=d[o];(r!==e||"width"!=c&&"height"!=c&&"position"!=c&&0!==c.indexOf("margin")&&"box-sizing"!=c&&0!==c.indexOf("transition")&&0!==c.indexOf("-webkit-animation"))&&d[c]!=h[c]&&(n.style[c]=d[c])}for(n.style.pointerEvents="none",l=r.children.length,o=0;l>o;o++)a.push([r.children[o],n.children[o]])}return i.classList.add("overlay"),i.style.margin="0",i.style.position="fixed",i.style.width=t.width+"px",i.style.height=t.height+"px",i.style.boxSizing="border-box",i.title="",i},_eventPrevent:function(e){return e.preventDefault(),e.stopPropagation(),!1},_eventDown:function(e,t){if(!this._currentElement&&1==(e.which||e.button)){var i=e.target||e.srcElement;if(i=t.onstart({element:i,x:e.clientX,y:e.clientY}))return this._stop(),this._currentElement=i,this._currentContainer=t,this._startPos=[e.clientX,e.clientY],this._started=!1,this._callbacks=[function(e){return this._eventMove(e)}.bind(this),function(e){return this._eventUp(e)}.bind(this)],document.body.addEventListener("mousemove",this._callbacks[0]),document.body.addEventListener("mouseup",this._callbacks[1]),e.preventDefault(),!1}},_eventMove:function(e){if(this._currentElement&&this._currentContainer){e.preventDefault();var t=e.clientX-this._startPos[0],i=e.clientY-this._startPos[1],s=!this._started;if(s){if(t>-this.startMargin&&t<this.startMargin&&i>-this.startMargin&&i<this.startMargin)return!1;var r=this._currentElement.getBoundingClientRect();this._startElementPos=[r.left,r.top],this._overlay=this._buildOverlay(this._currentElement,r),document.body.appendChild(this._overlay),document.body.classList.contains("drag-enabled")||document.body.classList.add("drag-enabled"),this._currentElement.addEventListener("click",this._eventPrevent),this._started=!0}var n=this._startElementPos[0]+t,o=this._startElementPos[1]+i;this._overlay.style.left=n+"px",this._overlay.style.top=o+"px",navigator.userAgent.indexOf("Presto")>=0&&(this._overlay.style.display="none");var l=this._mouseOver;this._mouseOver=document.elementFromPoint(e.clientX,e.clientY);var a=this._mouseOver?this._findContainer(this._mouseOver):null;return this._currentContainer.onmove&&this._currentContainer.onmove({targetContainer:a?a.dom:null,element:this._currentElement,x:e.clientX,y:e.clientY,mouseOver:this._mouseOver,oldMouseOver:l,starting:s,overlay:this._overlay}),a&&a.onmoveto&&a.onmoveto({sourceContainer:this._currentContainer.dom,element:this._currentElement,x:e.clientX,y:e.clientY,mouseOver:this._mouseOver,overlay:this._overlay}),navigator.userAgent.indexOf("Presto")>=0&&(this._overlay.style.display=""),!1}},_eventUp:function(e){if(this._currentElement&&this._currentContainer){if(!this._started)return this._currentContainer.onclick&&this._currentContainer.onclick({element:this._currentElement,event:e}),void this._stop();e.preventDefault();var t=null,i=null,s=!1;this._mouseOver&&(t=this._findContainer(this._mouseOver),t&&t.ondropto&&(i=t.ondropto({sourceContainer:this._currentContainer.dom,element:this._currentElement,overlay:this._overlay,x:e.clientX,y:e.clientY}))),i?s=!0:i={name:"animate",targetElement:this._currentElement},this._currentContainer.ondrop&&this._currentContainer.ondrop({targetContainer:s?t.dom:null,targetElement:i.element,element:this._currentElement,overlat:this._overlay,x:e.clientX,y:e.clientY,mouseOver:this._mouseOver}),this._stop(i,(s?t:this._currentContainer).ontransitionend)}},_stop:function(e,t){this._currentElement&&this._currentElement.removeEventListener("click",this._eventPrevent),e&&"animate"==e.name&&e.targetElement?this._animate(e.targetElement,t):e&&"fadeOut"==e.name?this._animateFadeOut():e&&"nothing"==e.name||(this._overlay&&(this._overlay.parentNode||this._overlay.parentElement).removeChild(this._overlay),t&&t({element:e?e.targetElement:null})),this._currentElement=null,this._currentContainer=null,this._startPos=null,this._startElementPos=null,this._overlay=null,this._started=!1,this._mouseOver=null,document.body.classList.remove("drag-enabled"),this._callbacks&&(document.body.removeEventListener("mousemove",this._callbacks[0]),document.body.removeEventListener("mouseup",this._callbacks[1]),this._callbacks=null)},_animate:function(e,t){var i=this._overlay,s=e.getBoundingClientRect(),r=s.left,n=s.top;s=null;var o=function(s){if(!s||"top"==s.propertyName||"left"==s.propertyName){var r=i.parentNode||i.parentElement;r&&(r.removeChild(i),t&&t({element:e}))}}.bind(this);i.classList.add("stopping"),i.style.transitionDuration=this.transitionDuration+"ms",i.style.transitionProperty="left, top",i.style.left=r+"px",i.style.top=n+"px",setTimeout(o,this.transitionDuration)},_animateFadeOut:function(){var e=this._overlay;e.style.transitionProperty="opacity",e.style.transitionDuration=this.transitionDuration+"ms",e.style.opacity="0.0",setTimeout(function(){e.parentNode.removeChild(e)},this.transitionDuration)}};e.exports=i},43:function(e,t,i){"use strict";var s=i(24),r={smilepack:null,smilepackData:null,init:function(){this.smilepack=new s([["categories","category_id","Категории:"]],{editable:!1,container:document.getElementById("smilepack"),selectable:!1});var e=this.smilepackData;this.smilepack.loadData(e);for(var t=0;t<e.categories.length;t++){var i=e.categories[t];this.smilepack.createGroupForCategory(0,i.id);for(var r=0;r<i.smiles.length;r++){var n=i.smiles[r];n.categoryLevel=0,n.categoryId=i.id,this.smilepack.addSmile(n,!1)}}1==e.categories.length&&this.smilepack.selectCategory(0,e.categories[0].id)}};e.exports=r}});