<?xml version="1.0" encoding="utf-8"?>
<?py
from woost import app
from woost.extensions.translationworkflow.utils \
    import object_is_included_in_translation_workflow
?>

<py:overlay
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:py="http://www.whads.com/ns/cocktail/templates"
    py:class="woost.views.BackOfficeFieldsView">

    <?py
    self.add_resource("/resources/scripts/translationworkflow-BackOfficeFieldsViewOverlay.js")
    ?>

    <py:binding>
        <?py
        transition = None

        if object_is_included_in_translation_workflow(self.edited_item):
            for role in app.user.iter_roles():
                if role.translation_workflow_default_transition is not None:
                    transition = role.translation_workflow_default_transition
                break

        self.translation_workflow_default_transition = transition

        if transition is None:
            self.translation_workflow_default_transition_wrapper.visible = False
        ?>
    </py:binding>

    <div py:id="translation_workflow_controls" py:after="self.translations_dropdown">

        <div py:id="translation_workflow_default_transition_wrapper">

            <input
                py:id="translation_workflow_auto_transition_check"
                type="checkbox"
                name="translation_workflow_auto_transition"
                value="true"/>

            <label py:id="translation_workflow_auto_transition_label">
                @{translations("woost.extensions.translationworkflow.BackOfficeEditViewOverlay.translation_workflow_auto_transition_label", transition = self.translation_workflow_default_transition)}
            </label>

            <py:ready>
                <?py
                self.translation_workflow_auto_transition_label["for"] = \
                    self.translation_workflow_auto_transition_check.require_id()
                ?>
            </py:ready>
        </div>

    </div>

</py:overlay>

