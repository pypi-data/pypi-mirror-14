(function(){var e,i,t,l=function(e,i){return function(){return e.apply(i,arguments)}},n=[].indexOf||function(e){for(var i=0,t=this.length;t>i;i++)if(i in this&&this[i]===e)return i;return-1};e=function(){function e(){return["ui.router","ui.bootstrap","common","ngAnimate","guanlecoja.ui","bbData"]}return e}(),t=function(){function e(e,i){var t,l,n;l="console",i.addGroup({name:l,caption:"Console View",icon:"exclamation-circle",order:5}),t={group:l,caption:"Console View"},n={controller:l+"Controller",controllerAs:"c",templateUrl:"console_view/views/"+l+".html",name:l,url:"/"+l,data:t},e.state(n)}return e}(),i=function(){function e(e,i,t,n){this.$scope=e,this.$window=t,this.matchBuildWithChange=l(this.matchBuildWithChange,this),this.onChange=l(this.onChange,this),this.buildLimit=200,this.changeLimit=10,this.dataAccessor=n.open().closeOnDestroy(this.$scope),this.$scope.builders=this.builders=this.dataAccessor.getBuilders(),this.$scope.builders.queryExecutor.isFiltered=function(e){return null==e.masterids||e.masterids.length>0},this.$scope.builds=this.builds=this.dataAccessor.getBuilds({limit:this.buildLimit,order:"-complete_at"}),this.changes=this.dataAccessor.getChanges({limit:this.changeLimit,order:"-when_timestamp"}),this.buildrequests=this.dataAccessor.getBuildrequests({limit:this.buildLimit,order:"-submitted_at"}),this.buildsets=this.dataAccessor.getBuildsets({limit:this.buildLimit,order:"-submitted_at"}),this.loading=!0,this.builds.onChange=this.changes.onChange=this.buildrequests.onChange=this.buildsets.onChange=this.onChange}return e.prototype.onChange=function(e){var i,t,l,n,s,r,o,a,c,d,u;if(0!==this.builds.length&&0!==this.builders.length&&0!==this.changes.length&&0!==this.buildsets.length&&0!==this.buildrequests){for(this.loading=!1,c=this.builds,n=0,o=c.length;o>n;n++)t=c[n],this.matchBuildWithChange(t);for(d=this.changes,s=0,a=d.length;a>s;s++){l=d[s],l.maxbuilds=1,u=l.buildsPerBuilder;for(r in u)i=u[r],i.length>l.maxbuilds&&(l.maxbuilds=i.length)}return this.setWidth(this.$window.innerWidth),angular.element(this.$window).bind("resize",function(e){return function(){return e.setWidth(e.$window.innerWidth),e.$scope.$apply()}}(this))}},e.prototype.matchBuildWithChange=function(e){var i,t,l,s,r,o,a,c;if(i=this.buildrequests.get(e.buildrequestid),null!=i&&(t=this.buildsets.get(i.buildsetid),null!=t&&null!=t.sourcestamps)){for(o=t.sourcestamps,a=[],s=0,r=o.length;r>s;s++)c=o[s],a.push(function(){var i,t,s,r,o,a;for(o=this.changes,a=[],t=0,s=o.length;s>t;t++)l=o[t],l.sourcestamp.ssid===c.ssid?(null==l.buildsPerBuilder&&(l.buildsPerBuilder={}),null==(i=l.buildsPerBuilder)[r=e.builderid]&&(i[r]=[]),n.call(l.buildsPerBuilder[e.builderid],e)<0?a.push(l.buildsPerBuilder[e.builderid].push(e)):a.push(void 0)):a.push(void 0);return a}.call(this));return a}},e.prototype.setWidth=function(e){return this.cellWidth=100/this.builders.length+"%",.85*e/this.builders.length>40?this.width="100%":this.width=40*this.builders.length/.85+"px"},e.prototype.openAll=function(){return this.$scope.$broadcast("showAllInfo",!1)},e.prototype.closeAll=function(){return this.$scope.$broadcast("showAllInfo",!0)},e}(),angular.module("console_view",new e).config(["$stateProvider","glMenuServiceProvider",t]).controller("consoleController",["$scope","$q","$window","dataService",i])}).call(this),function(){var e,i;e=function(){function e(){return{replace:!0,restrict:"EA",scope:{width:"=",cellWidth:"=",builders:"="},templateUrl:"console_view/views/buildersheader.html",controller:"_buildersHeaderController",controllerAs:"bh"}}return e}(),i=function(){function e(e){e.$watch("width",function(e){return function(i){e.width=i}}(this)),e.$watch("cellWidth",function(e){return function(i){e.cellWidth=i}}(this)),e.$watchCollection("builders",function(e){return function(i){e.builders=i}}(this))}return e}(),angular.module("console_view").directive("buildersHeader",[e]).controller("_buildersHeaderController",["$scope",i])}.call(this),function(){var e,i;e=function(){function e(){return{replace:!1,restrict:"EA",scope:{width:"=",cellWidth:"=",change:"=",builders:"="},templateUrl:"console_view/views/changerow.html",controller:"_changeRowController",controllerAs:"cr"}}return e}(),i=function(){function e(e,i,t){this.$modal=t,angular.extend(this,i),this.infoIsCollapsed=!0,e.$on("showAllInfo",function(e){return function(i,t){return e.infoIsCollapsed=t}}(this)),e.$watch("width",function(e){return function(i){e.width=i}}(this)),e.$watch("cellWidth",function(e){return function(i){e.cellWidth=i}}(this)),e.$watch("change",function(e){return function(i){return e.change=i,e.change&&angular.isString(e.change.repository)?e.createLink():void 0}}(this)),e.$watch("builders",function(e){this.builders=e})}return e.prototype.createLink=function(){var e;return e=this.change.repository.replace(".git",""),this.change.link=e+"/commit/"+this.change.revision},e.prototype.selectBuild=function(e){var i;return i=this.$modal.open({templateUrl:"console_view/views/modal.html",controller:"consoleModalController as modal",windowClass:"modal-small",resolve:{selectedBuild:function(){return e}}})},e.prototype.createFileLink=function(e){var i;return i=this.change.repository.replace(".git",""),i+"/blob/"+this.change.revision+"/"+e},e.prototype.toggleInfo=function(){return this.infoIsCollapsed=!this.infoIsCollapsed},e}(),angular.module("console_view").directive("changeRow",[e]).controller("_changeRowController",["$scope","resultsService","$modal",i])}.call(this),function(){var e;e=function(){function e(e,i,t){this.$modalInstance=i,this.selectedBuild=t,e.$on("$stateChangeStart",function(e){return function(){return e.close()}}(this))}return e.prototype.close=function(){return this.$modalInstance.close()},e}(),angular.module("console_view").controller("consoleModalController",["$scope","$modalInstance","selectedBuild",e])}.call(this),angular.module("console_view").run(["$templateCache",function(e){e.put("console_view/views/console.html",'<div class="console"><div ng-show="c.loading" class="load-indicator"><div class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-2x"></i><p>loading</p></div></div><div class="header"><div ng-style="{width: c.width}" class="header-content"><div class="col-15"><div class="buttons"><i ng-click="c.openAll()" tooltip="Open information for all changes" tooltip-placement="right" class="fa fa-plus-circle"></i><i ng-click="c.closeAll()" tooltip="Close information for all changes" tooltip-placement="right" class="fa fa-minus-circle"></i></div><div class="search-field"><input type="text" name="search" ng-model="search" placeholder="search"/></div></div><div class="col-85"><builders-header builders="c.builders" width="c.width" cell-width="c.cellWidth"></builders-header></div></div></div><div class="content"><div ng-style="{width: c.width}" class="change-rows"><change-row ng-repeat="change in c.changes | filter: search | orderBy: \'changeid\':true track by change.changeid" change="change" builders="builders" width="c.width" cell-width="c.cellWidth"></change-row></div></div></div>'),e.put("console_view/views/buildersheader.html",'<div class="builders"><a ng-repeat="builder in bh.builders | orderBy: \'name\' track by builder.builderid" ng-style="{width: bh.cellWidth}" ng-href="#/builders/{{ builder.builderid }}" ng-bind="builder.name" class="builder"></a></div>'),e.put("console_view/views/changerow.html",'<div ng-style="{height: 10 + (cr.change.maxbuilds*20)}" class="change-row"><div class="col-15"><div class="name"><div class="change-avatar"><img ng-src="avatar?email={{cr.change.author_email}}"/></div><i ng-click="cr.toggleInfo()" ng-class="{\'fa-rotate-90\': !cr.infoIsCollapsed}" class="fa fa-chevron-circle-right"></i><span tooltip="{{ cr.change.comments }}" tooltip-placement="top"><a ng-if="cr.change.author_email" ng-href="mailto: {{cr.change.author_email}}" target="_blank"> {{ cr.change.author_name }}</a><span ng-if="!cr.change.author_email"> {{ cr.change.author }}</span></span></div></div><div class="col-85"><div class="builds"><span ng-repeat="builder in builders | orderBy: \'name\' track by builder.builderid" ng-style="{\'width\': cr.cellWidth}" title="{{builder.name}}" class="build"><a ng-repeat="build in cr.change.buildsPerBuilder[builder.builderid] track by $index| orderBy:\'started_at\'"><div ng-if="build.buildid" ng-class="cr.results2class(build, \'pulse\')" ng-click="cr.selectBuild(build)" class="badge-status">{{ build.number }}</div></a></span></div></div><div ng-hide="cr.infoIsCollapsed" class="col info-collapse"><!-- Comment--><div class="info"><i class="fa fa-comment-o"></i><p>{{ cr.change.comments }}</p></div><!-- Link to the change--><div class="info"><i class="fa fa-link"></i><p><a ng-href="{{ cr.change.link }}" target="_blank">{{ cr.change.revision | limitTo: 10 }}</a></p></div><!-- Changed files--><div class="info"><i class="fa fa-file-o"></i><p ng-repeat="file in cr.change.files"><a ng-href="{{ cr.createFileLink(file) }}" target="_blank">{{ file }}</a></p></div></div></div>'),e.put("console_view/views/modal.html",'<!-- Show build summary for the selected build in a modal window--><div class="modal-header"><i ng-click="modal.close()" class="fa fa-times pull-right"></i><h4 class="modal-title">Build summary</h4></div><div class="modal-body"><buildsummary ng-if="modal.selectedBuild" buildid="modal.selectedBuild.buildid"></buildsummary></div>')}]);