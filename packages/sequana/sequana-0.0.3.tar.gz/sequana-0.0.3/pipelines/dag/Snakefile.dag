"""

Author: Thomas Cokelaer
Affiliation: Institut Pasteur
Summary: a rule to create the DAG image from the Snakemake
Data:
Run: snakemake -s Snakefile
Changelog:

"""
from sequoia import version

rule dag:
    output: "dag.svg"
    log: "dag.log"
    version: version
    message: """
    -- Creating DAG in a dot file
    -- Output saved in dag.svg
    """
    run:
        # Create the dot file (graphviz) using snakemake
        shell("snakemake --dag > dag.dot")

        # Annotate the dag with URLs 
        from sequana.snakemake import DOTParser
        d = DOTParser("dag.dot")
        d.add_urls()

        # Now, create the SVG
        shell("dot -Tsvg dag.ann.dot -o dag.svg")

        # cleanup intermediate files
        #shell("rm -f dag.dot")
        #shell("rm -f dag.ann.dot")




