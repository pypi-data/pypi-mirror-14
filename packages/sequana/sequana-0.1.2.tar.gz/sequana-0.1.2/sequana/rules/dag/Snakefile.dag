"""

Author: Thomas Cokelaer
Affiliation: Institut Pasteur
Summary: a rule to create the DAG image from the Snakemake
Data:
Run: snakemake -s Snakefile
Changelog:

"""
from sequana import version


rule dag:
    output: 
        dot="dag.dot",
        svg="dag.svg"
    version: version
    message: """
    -- Creating DAG in a dot file
    -- Output saved in dag.svg
    """
    run:
        # Create the dot file (graphviz) using snakemake
        shell("snakemake --dag > {output.dot}")

        # Annotate the dag with URLs 
        from sequana.snaketools import DOTParser
        d = DOTParser("dag.dot")
        d.add_urls()

        # Now, create the SVG
        shell("dot -Tsvg dag.ann.dot -o dag.svg")


rule dag_cleanup:
    params: cleanup=['dag.dot', 'dag.ann.dot', 'dag.svg']
